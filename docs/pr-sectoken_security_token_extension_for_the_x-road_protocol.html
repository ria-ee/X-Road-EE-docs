<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="github-markdown.css">
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      }
    </style>
    <title>X-Road: 7.3.2</title>
  </head>
  <body>
    <article class="markdown-body">
<h1><a id="security-token-extension-for-the-x-road-message-protocol" class="anchor" aria-hidden="true" tabindex="-1" href="#security-token-extension-for-the-x-road-message-protocol"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security Token Extension for the X-Road Message Protocol</h1>
<p>Version: 1.2<br>
Doc. ID: PR-SECTOKEN</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>Version</th>
<th>Description</th>
<th>Author</th>
</tr>
</thead>
<tbody>
<tr>
<td>20.10.2017</td>
<td>1.0</td>
<td>Initial version</td>
<td>Olli Lindgren</td>
</tr>
<tr>
<td>06.03.2018</td>
<td>1.1</td>
<td>Added terms section, term doc reference and link</td>
<td>Tatu Repo</td>
</tr>
<tr>
<td>17.06.2022</td>
<td>1.2</td>
<td>Update document title</td>
<td>Petteri Kivim√§ki</td>
</tr>
</tbody>
</table>
<h2><a id="table-of-contents" class="anchor" aria-hidden="true" tabindex="-1" href="#table-of-contents"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li><a href="#license">License</a></li>
<li>
<a href="#1-introduction">1 Introduction</a>
<ul>
<li><a href="#11-terms-and-abbreviations">1.1 Terms and abbreviations</a></li>
<li><a href="#12-references">1.2 References</a></li>
</ul>
</li>
<li>
<a href="#2-format-of-messages">2 Format of messages</a>
<ul>
<li><a href="#21-schema-header">2.1 Schema header</a></li>
<li><a href="#22-added-securitytoken-element">2.2 Added <code>securityToken</code> element</a></li>
<li><a href="#23-json-web-tokens-and-the-securitytoken-attribute-tokentype">2.3 JSON Web Tokens and the <code>securityToken</code> attribute <code>tokenType</code></a></li>
<li><a href="#24-message-headers">2.4 Message headers</a></li>
</ul>
</li>
<li><a href="#3-x-road-message-logging-and-the-security-token">3 X-Road message logging and the security token</a></li>
<li><a href="#4-xml-schema-for-the-extension">4 XML Schema for the extension</a></li>
<li>
<a href="#5-examples">5 Examples</a>
<ul>
<li><a href="#51-request">5.1 Request</a></li>
</ul>
</li>
</ul>

<h2><a id="license" class="anchor" aria-hidden="true" tabindex="-1" href="#license"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>
<p>This document is licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License. To view a copy of this license, visit <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="nofollow">http://creativecommons.org/licenses/by-sa/3.0/</a>.</p>
<h2><a id="1-introduction" class="anchor" aria-hidden="true" tabindex="-1" href="#1-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a>1 Introduction</h2>
<p>This specification describes an extension of the X-Road protocol for sending loosely defined security tokens as X-Road header data.
The X-Road message protocol version 4.0 [<a href="#Ref_PR-MESS">PR-MESS</a>] already supports sending arbitrary SOAP headers end-to-end. This
extension just provides a common, defined way to deliver security tokens with the X-Road protocol using the <code>securityToken</code> element.</p>
<p>The motivation for the extension was the need to provide a common way to transfer JSON Web Tokens [<a href="#Ref_JWT-RFC">JWT-RFC</a>] over X-Road.
Examples using JWT as payload in the security token can be found in the <a href="#examples">Examples</a> section.</p>
<h3><a id="11-terms-and-abbreviations" class="anchor" aria-hidden="true" tabindex="-1" href="#11-terms-and-abbreviations"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1 Terms and abbreviations</h3>
<p>See X-Road terms and abbreviations documentation [<a href="#Ref_TERMS">TA-TERMS</a>].</p>
<h3><a id="12-references" class="anchor" aria-hidden="true" tabindex="-1" href="#12-references"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.2 References</h3>
<table>
<thead>
<tr>
<th>Document ID</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a name="Ref_PR-MESS"></a>[PR-MESS]</td>
<td><a href="../pr-mess_x-road_message_protocol.html">X-Road: Message Protocol v4.0</a></td>
</tr>
<tr>
<td>
<a name="Ref_UG-SS"></a>[UG-SS]</td>
<td><a href="../../Manuals/ug-ss_x-road_6_security_server_user_guide.html">Security Server User guide</a></td>
</tr>
<tr>
<td>
<a name="Ref_UG-SYSPAR"></a>[UG-SYSPAR]</td>
<td><a href="../../Manuals/ug-syspar_x-road_v6_system_parameters.html">X-Road: System Parameters User Guide</a></td>
</tr>
<tr>
<td>
<a name="Ref_JWT-RFC"></a>[JWT-RFC]</td>
<td><a href="https://tools.ietf.org/html/rfc7519" rel="nofollow">Internet Engineering Task Force Request for Comments 7516:  JSON Web Token (JWT)</a></td>
</tr>
<tr>
<td>
<a id="Ref_TERMS"></a>[TA-TERMS]</td>
<td><a href="../../terms_x-road_docs.html">X-Road Terms and Abbreviations</a></td>
</tr>
</tbody>
</table>
<h2><a id="2-format-of-messages" class="anchor" aria-hidden="true" tabindex="-1" href="#2-format-of-messages"><span aria-hidden="true" class="octicon octicon-link"></span></a>2 Format of messages</h2>
<p>This section describes the XML format for expressing the security token. The data
structures and elements defined in this section are in the namespace <code>http://x-road.eu/xsd/security-token.xsd</code>. The
schema file can be found at <a href="http://x-road.eu/xsd/security-token.xsd" rel="nofollow"><code>http://x-road.eu/xsd/security-token.xsd</code></a>.
The XML Schema for this extension is also listed in the section <a href="#xml-schema-for-the-extension">XML Schema for the extension</a>.</p>
<p>Note that at the moment, there is no unifying schema that would combine the message protocol and this extension under
the same namespace. That means there is no single schema that would validate an X-Road message with this extension in use.</p>
<h3><a id="21-schema-header" class="anchor" aria-hidden="true" tabindex="-1" href="#21-schema-header"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1 Schema header</h3>
<p>The following listing shows the header of the schema definition</p>
<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">schema</span>
    <span class="pl-e">elementFormDefault</span>=<span class="pl-s"><span class="pl-pds">"</span>qualified<span class="pl-pds">"</span></span>
    <span class="pl-e">targetNamespace</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/security-token.xsd<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/security-token.xsd<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xs</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema<span class="pl-pds">"</span></span>&gt;

&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">schema</span>&gt;
</pre></div>
<h3><a id="22-added-securitytoken-element" class="anchor" aria-hidden="true" tabindex="-1" href="#22-added-securitytoken-element"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.2 Added <code>securityToken</code> element</h3>
<p>A new <code>securityToken</code> element was added to deliver the security token information.</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">element</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>securityToken<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">complexType</span>&gt;
    &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">simpleContent</span>&gt;
      &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">restriction</span> <span class="pl-e">base</span>=<span class="pl-s"><span class="pl-pds">"</span>xs:string<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">attribute</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>tokenType<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>xs:anyURI<span class="pl-pds">"</span></span>/&gt;
      &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">restriction</span>&gt;
    &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">simpleContent</span>&gt;
  &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">complexType</span>&gt;
  &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">annotation</span>&gt;
    &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">documentation</span>&gt;Contains a security token&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">documentation</span>&gt;
  &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">annotation</span>&gt;
&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">element</span>&gt;
</pre></div>
<h3><a id="23-json-web-tokens-and-the-securitytoken-attribute-tokentype" class="anchor" aria-hidden="true" tabindex="-1" href="#23-json-web-tokens-and-the-securitytoken-attribute-tokentype"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.3 JSON Web Tokens and the <code>securityToken</code> attribute <code>tokenType</code>
</h3>
<p>When transferring JSON Web Tokens, the URI attribute <code>tokenType</code> should have the value <code>urn:ietf:params:oauth:token-type:jwt</code>
which is the URI content type for JWT content specified by <a href="https://tools.ietf.org/html/rfc7519#section-10.2.1" rel="nofollow">section 10.2.1.</a>
of the JSON Web Token RFC [<a href="#Ref_JWT-RFC">JWT-RFC</a>]. However, using this value for the <code>tokenType</code> is not enforced in any way. The JWT content is not
currently validated or verified by the security server.</p>
<h3><a id="24-message-headers" class="anchor" aria-hidden="true" tabindex="-1" href="#24-message-headers"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.4 Message headers</h3>
<p>This section describes the additional SOAP headers that are added by this extension.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Mandatory/Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>securityToken</td>
<td>Optional</td>
<td>The security token</td>
</tr>
</tbody>
</table>
<h2><a id="3-x-road-message-logging-and-the-security-token" class="anchor" aria-hidden="true" tabindex="-1" href="#3-x-road-message-logging-and-the-security-token"><span aria-hidden="true" class="octicon octicon-link"></span></a>3 X-Road message logging and the security token</h2>
<p>By default, if the message logging add-on (package <code>xroad-addon-messagelog</code>) is installed on a security server, all X-Road SOAP messages are logged
with all their SOAP headers, including the security token. You can read more about the message logging in <a href="../../Manuals/ug-ss_x-road_6_security_server_user_guide.html#11-message-log">Chapter 11</a>
of the  the Security Server User Guide [<a href="#Ref_UG-SS">UG-SS</a>].</p>
<p>In case the security token contains sensitive data that should not be logged, the message logging can be configured to not log the SOAP body, which also drops the <code>securityToken</code> SOAP header. You can
read more about the SOAP body logging options in the <a href="../../Manuals/ug-syspar_x-road_v6_system_parameters.html#message-log-add-on-parameters-message-log">Message log add-on parameters section</a> of the X-Road System Parameters User
Guide [<a href="#Ref_UG-SYSPAR">UG-SYSPAR</a>].</p>
<h2><a id="4-xml-schema-for-the-extension" class="anchor" aria-hidden="true" tabindex="-1" href="#4-xml-schema-for-the-extension"><span aria-hidden="true" class="octicon octicon-link"></span></a>4 XML Schema for the extension</h2>
<p>The XML Schema for the extension is below. It can also be found at <a href="http://x-road.eu/xsd/security-token.xsd" rel="nofollow"><code>http://x-road.eu/xsd/security-token.xsd</code></a> and locally <a href="./security-token.xsd">here</a>.</p>
<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">schema</span> <span class="pl-e">elementFormDefault</span>=<span class="pl-s"><span class="pl-pds">"</span>qualified<span class="pl-pds">"</span></span>
   <span class="pl-e">targetNamespace</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/security-token.xsd<span class="pl-pds">"</span></span>
   <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/security-token.xsd<span class="pl-pds">"</span></span>
   <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xs</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema<span class="pl-pds">"</span></span>&gt;

<span class="pl-c"><span class="pl-c">&lt;!--</span> Header elements <span class="pl-c">--&gt;</span></span>
&lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">element</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>securityToken<span class="pl-pds">"</span></span>&gt;
 &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">complexType</span>&gt;
   &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">simpleContent</span>&gt;
     &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">restriction</span> <span class="pl-e">base</span>=<span class="pl-s"><span class="pl-pds">"</span>xs:string<span class="pl-pds">"</span></span>&gt;
       &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">attribute</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>tokenType<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>xs:anyURI<span class="pl-pds">"</span></span>/&gt;
     &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">restriction</span>&gt;
   &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">simpleContent</span>&gt;
 &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">complexType</span>&gt;
 &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">annotation</span>&gt;
   &lt;<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">documentation</span>&gt;Contains a security token&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">documentation</span>&gt;
 &lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">annotation</span>&gt;
&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">element</span>&gt;
&lt;/<span class="pl-ent">xs</span><span class="pl-ent">:</span><span class="pl-ent">schema</span>&gt;
</pre></div>
<h2><a id="5-examples" class="anchor" aria-hidden="true" tabindex="-1" href="#5-examples"><span aria-hidden="true" class="octicon octicon-link"></span></a>5 Examples</h2>
<p>Below is an example request using a JSON Web Token as the security token.</p>
<h3><a id="51-request" class="anchor" aria-hidden="true" tabindex="-1" href="#51-request"><span aria-hidden="true" class="octicon octicon-link"></span></a>5.1 Request</h3>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Envelope</span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">soapenv</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xro</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/xroad.xsd<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">iden</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/identifiers<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">prod</span>=<span class="pl-s"><span class="pl-pds">"</span>http://example.org/provider<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">ext</span>=<span class="pl-s"><span class="pl-pds">"</span>http://x-road.eu/xsd/security-token.xsd<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Header</span>&gt;
        &lt;<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">protocolVersion</span>&gt;4.0&lt;/<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">protocolVersion</span>&gt;
        &lt;<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">id</span>&gt;ID11234&lt;/<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">id</span>&gt;
        &lt;<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">client</span> <span class="pl-e">iden</span><span class="pl-e">:</span><span class="pl-e">objectType</span>=<span class="pl-s"><span class="pl-pds">"</span>SUBSYSTEM<span class="pl-pds">"</span></span>&gt;
            ...
        &lt;/<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">client</span>&gt;
        &lt;<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">service</span> <span class="pl-e">iden</span><span class="pl-e">:</span><span class="pl-e">objectType</span>=<span class="pl-s"><span class="pl-pds">"</span>SERVICE<span class="pl-pds">"</span></span>&gt;
            ...
            &lt;<span class="pl-ent">iden</span><span class="pl-ent">:</span><span class="pl-ent">serviceCode</span>&gt;service&lt;/<span class="pl-ent">iden</span><span class="pl-ent">:</span><span class="pl-ent">serviceCode</span>&gt;
        &lt;/<span class="pl-ent">xro</span><span class="pl-ent">:</span><span class="pl-ent">service</span>&gt;
        &lt;<span class="pl-ent">ext</span><span class="pl-ent">:</span><span class="pl-ent">securityToken</span> <span class="pl-e">tokenType</span>=<span class="pl-s"><span class="pl-pds">"</span>urn:ietf:params:oauth:token-type:jwt<span class="pl-pds">"</span></span>&gt;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoiVGVzdCJ9.negHPJEwkKcNcgVC6dNtzPZk_48Kig6IzxnabL9jKsw&lt;/<span class="pl-ent">ext</span><span class="pl-ent">:</span><span class="pl-ent">securityToken</span>&gt;
    &lt;/<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Header</span>&gt;
    &lt;<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Body</span>&gt;
        &lt;<span class="pl-ent">prod</span><span class="pl-ent">:</span><span class="pl-ent">service</span>&gt;
            ...
        &lt;/<span class="pl-ent">prod</span><span class="pl-ent">:</span><span class="pl-ent">service</span>&gt;
    &lt;/<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Body</span>&gt;
&lt;/<span class="pl-ent">soapenv</span><span class="pl-ent">:</span><span class="pl-ent">Envelope</span>&gt;</pre></div>
    </article>
  </body>
</html>
