<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="github-markdown.css">
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      }
    </style>
    <title>X-Road: 7.6.0
</title>
  </head>
  <body>
    <article class="markdown-body">
<div class="markdown-heading"><h1 class="heading-element">SECURITY SERVER USER GUIDE 
</h1><a id="security-server-user-guide-" class="anchor" aria-label="Permalink: SECURITY SERVER USER GUIDE " href="#security-server-user-guide-"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>X-ROAD 7</strong></p>
<p>Version: 2.89<br>
Doc. ID: UG-SS</p>
<hr>
<div class="markdown-heading"><h2 class="heading-element">Version history 
</h2><a id="version-history-" class="anchor" aria-label="Permalink: Version history " href="#version-history-"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<table>
<thead>
<tr>
<th>Date</th>
<th>Version</th>
<th>Description</th>
<th>Author</th>
</tr>
</thead>
<tbody>
<tr>
<td>05.09.2014</td>
<td>0.1</td>
<td>Initial draft</td>
<td></td>
</tr>
<tr>
<td>24.09.2014</td>
<td>0.2</td>
<td>Translation to English</td>
<td></td>
</tr>
<tr>
<td>10.10.2014</td>
<td>0.3</td>
<td>Update</td>
<td></td>
</tr>
<tr>
<td>14.10.2014</td>
<td>0.4</td>
<td>Title page, header, footer added</td>
<td></td>
</tr>
<tr>
<td>16.10.2014</td>
<td>0.5</td>
<td>Minor corrections done</td>
<td></td>
</tr>
<tr>
<td>12.11.2014</td>
<td>0.6</td>
<td>Asynchronous messages section removed. Global Configuration distributors section replaced with Configuration Anchor section (<a href="#102-managing-the-configuration-anchor">10.2</a>). Added Logback information (Chapter <a href="#17-logs-and-system-services">16</a>). A note added about the order of timestamping services (Section <a href="#103-managing-the-timestamping-services">10.3</a>).</td>
<td></td>
</tr>
<tr>
<td>1.12.2014</td>
<td>1.0</td>
<td>Minor corrections done</td>
<td></td>
</tr>
<tr>
<td>19.01.2015</td>
<td>1.1</td>
<td>License information added</td>
<td></td>
</tr>
<tr>
<td>27.01.2015</td>
<td>1.2</td>
<td>Minor corrections done</td>
<td></td>
</tr>
<tr>
<td>30.04.2015</td>
<td>1.3</td>
<td>"sdsb" changed to "xroad"</td>
<td></td>
</tr>
<tr>
<td>29.05.2015</td>
<td>1.4</td>
<td>Message Log chapter added (Chapter <a href="#11-message-log">11</a>)</td>
<td></td>
</tr>
<tr>
<td>30.06.2015</td>
<td>1.5</td>
<td>Minor corrections done</td>
<td></td>
</tr>
<tr>
<td>3.07.2015</td>
<td>1.6</td>
<td>Audit Log chapter added (Chapter <a href="#12-audit-log">12</a>)</td>
<td></td>
</tr>
<tr>
<td>7.09.2015</td>
<td>1.7</td>
<td>Message Log – how to use remote database (Section <a href="#113-using-a-remote-database">11.3</a>)</td>
<td></td>
</tr>
<tr>
<td>14.09.2015</td>
<td>1.8</td>
<td>Reference to the audit log events added</td>
<td></td>
</tr>
<tr>
<td>18.09.2015</td>
<td>1.9</td>
<td>Minor corrections done</td>
<td></td>
</tr>
<tr>
<td>21.09.2015</td>
<td>2.0</td>
<td>References fixed</td>
<td></td>
</tr>
<tr>
<td>07.10.2015</td>
<td>2.1</td>
<td>Default value of the parameter <em>acceptable-timestamp-failure-period</em> set to 14400</td>
<td></td>
</tr>
<tr>
<td>14.10.2015</td>
<td>2.2</td>
<td>Instructions for using an external database for the message log corrected</td>
<td></td>
</tr>
<tr>
<td>05.11.2015</td>
<td>2.3</td>
<td>Updates related to backup and restore (Chapter <a href="#13-back-up-and-restore">13</a>)</td>
<td></td>
</tr>
<tr>
<td>30.11.2015</td>
<td>2.4</td>
<td>X-Road concepts updated (Section <a href="#12-x-road-concepts">1.2</a>). Security server registration updated (Chapter <a href="#3-security-server-registration">3</a>). Security server clients updated (Chapter <a href="#4-security-server-clients">4</a>); only subsystems (and not members) can be registered as Security Server clients and have services or access rights configured. Cross-references fixed. Editorial changes made.</td>
<td></td>
</tr>
<tr>
<td>09.12.2015</td>
<td>2.5</td>
<td>Security server client deletion updated (Section <a href="#452-deleting-a-client">4.5.2</a>). Editorial changes made.</td>
<td></td>
</tr>
<tr>
<td>14.12.2015</td>
<td>2.6</td>
<td>Message log updated (Chapter <a href="#11-message-log">11</a>)</td>
<td></td>
</tr>
<tr>
<td>14.01.2016</td>
<td>2.7</td>
<td>Logs updated (Chapter <a href="#17-logs-and-system-services">16</a>)</td>
<td></td>
</tr>
<tr>
<td>08.02.2016</td>
<td>2.8</td>
<td>Corrections in chapter <a href="#17-logs-and-system-services">16</a>
</td>
<td></td>
</tr>
<tr>
<td>20.05.2016</td>
<td>2.9</td>
<td>Merged changes from xtee6-doc repo. Added Chapter <a href="#14-diagnostics">14</a> Diagnostics and updated content of <a href="#104-changing-the-internal-tls-key-and-certificate">10.4</a> Changing the Internal TLS Key and Certificate.</td>
<td></td>
</tr>
<tr>
<td>29.11.2016</td>
<td>2.10</td>
<td>User Management updated (Chapter <a href="#2-user-management">2</a>). XTE-297: Internal Servers tab is displayed to Security Server owner (Chapter <a href="#9-communication-with-the-client-information-systems">9</a>).</td>
<td></td>
</tr>
<tr>
<td>19.12.2016</td>
<td>2.11</td>
<td>Added Chapter <a href="#15-operational-monitoring">15</a> Operational Monitoring</td>
<td></td>
</tr>
<tr>
<td>20.12.2016</td>
<td>2.12</td>
<td>Minor corrections in Chapter <a href="#15-operational-monitoring">15</a>
</td>
<td></td>
</tr>
<tr>
<td>22.12.2016</td>
<td>2.13</td>
<td>Corrections in Chapter <a href="#1525-configuring-an-external-operational-monitoring-daemon-and-the-corresponding-security-server">15.2.5</a>
</td>
<td></td>
</tr>
<tr>
<td>04.01.2016</td>
<td>2.14</td>
<td>Corrections in Chapter <a href="#1525-configuring-an-external-operational-monitoring-daemon-and-the-corresponding-security-server">15.2.5</a>
</td>
<td></td>
</tr>
<tr>
<td>20.02.2017</td>
<td>2.15</td>
<td>Converted to Github flavoured Markdown, added license text, adjusted tables for better output in PDF</td>
<td>Toomas Mölder</td>
</tr>
<tr>
<td>16.03.2017</td>
<td>2.16</td>
<td>Added observer role to Chapters <a href="#21-user-roles">2.1</a> and <a href="#22-managing-the-users">2.2</a>
</td>
<td>Tatu Repo</td>
</tr>
<tr>
<td>15.06.2017</td>
<td>2.17</td>
<td>Added <a href="#18-federation">Chapter 17</a> on federation</td>
<td>Olli Lindgren</td>
</tr>
<tr>
<td>25.09.2017</td>
<td>2.18</td>
<td>Added chapter <a href="#16-environmental-monitoring">16 Environmental Monitoring</a>
</td>
<td>Tomi Tolvanen</td>
</tr>
<tr>
<td>17.10.2017</td>
<td>2.19</td>
<td>Added section <a href="#163-limiting-environmental-monitoring-remote-data-set">16.3 Limiting environmental monitoring remote data set</a>
</td>
<td>Joni Laurila</td>
</tr>
<tr>
<td>05.03.2018</td>
<td>2.20</td>
<td>Added terms and abbreviations reference, document links, moved concepts to terms and abbreviations.</td>
<td>Tatu Repo</td>
</tr>
<tr>
<td>10.04.2018</td>
<td>2.21</td>
<td>Update internal server certificate documentation.</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>25.05.2018</td>
<td>2.22</td>
<td>Update system parameters documentation.</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>15.11.2018</td>
<td>2.23</td>
<td>Minor updates for Ubuntu 18.04</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>06.02.2019</td>
<td>2.24</td>
<td>Minor updates on Security Server client registration in Chapters <a href="#43-configuring-a-signing-key-and-certificate-for-a-security-server-client">4.3</a> and <a href="#44-registering-a-security-server-client-in-the-x-road-governing-authority">4.4</a>.</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>15.03.2019</td>
<td>2.25</td>
<td>Update documentation to cover REST service usage in chapter [6]</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>26.03.2019</td>
<td>2.26</td>
<td>Added chapter on API keys <a href="#19-management-rest-api">19</a>
</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>16.04.2019</td>
<td>2.27</td>
<td>Minor updates regarding REST services in chapter [6]</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>30.06.2019</td>
<td>2.28</td>
<td>Update the default connection type from HTTP to HTTPS in chapter [9]</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>01.07.2019</td>
<td>2.29</td>
<td>Changing the Security Server Owner chapter added (Chapter <a href="#34-changing-the-security-server-owner">3.4</a>)</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>14.08.2019</td>
<td>2.30</td>
<td>Added automatic backups</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>29.09.2019</td>
<td>2.31</td>
<td>Added chapter <a href="#193-correlation-id-http-header">19.3</a> on REST API correlation id</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>30.09.2019</td>
<td>2.32</td>
<td>Added remote database migration guide</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>15.10.2019</td>
<td>2.33</td>
<td>Updated REST services in chapter [6]</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>04.11.2019</td>
<td>2.34</td>
<td>Added information about REST API request rate and size limits</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>07.11.2019</td>
<td>2.35</td>
<td>Add more information about service descriptions to chapter [6]</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>05.12.2019</td>
<td>2.36</td>
<td>Add information about timestamping failover capabilities in chapter <a href="#103-managing-the-timestamping-services">10.3</a>
</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>24.02.2020</td>
<td>2.37</td>
<td>Updated notes about key caching after changing internal TLS key and certificate <a href="#104-changing-the-internal-tls-key-and-certificate">10.4</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>26.03.2020</td>
<td>2.38</td>
<td>Added chapter on updating API keys <a href="#1913-updating-api-keys">19.1.3</a>
</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>30.03.2020</td>
<td>2.39</td>
<td>Added description of pre-restore backups</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>01.04.2020</td>
<td>2.40</td>
<td>Added notes about IP whitelists for REST API</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>03.06.2020</td>
<td>2.41</td>
<td>Updated audit logging description</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>05.06.2020</td>
<td>2.42</td>
<td>Added chapter about validation errors <a href="#194-validation-errors">19.4</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>25.06.2020</td>
<td>2.43</td>
<td>Update environmental and operational monitoring JMXMP details</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>08.07.2020</td>
<td>2.44</td>
<td>Update chapter on access rights <a href="#7-access-rights">7</a>
</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>30.07.2020</td>
<td>2.45</td>
<td>Added mention about proxy_ui_api.log to <a href="#17-logs-and-system-services">17 Logs and System Services</a>
</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>10.08.2020</td>
<td>2.46</td>
<td>Added mention about unit start rate limits to <a href="#171-system-services">17.1 System Services</a>
</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>21.09.2020</td>
<td>2.47</td>
<td>Added a validation error example to <a href="#194-validation-errors">19.4 Validation errors</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>29.09.2020</td>
<td>2.48</td>
<td>Update chapters <a href="#3-security-server-registration">3</a>, <a href="#4-security-server-clients">4</a>, <a href="#6-x-road-services">6</a>, <a href="#7-access-rights">7</a>, <a href="#8-local-access-right-groups">8</a> and <a href="#13-back-up-and-restore">13</a> to match the new management API</td>
<td>Tapio Jaakkola</td>
</tr>
<tr>
<td>30.09.2020</td>
<td>2.49</td>
<td>Update chapters <a href="#3-security-server-registration">3</a>, <a href="#5-security-tokens-keys-and-certificates">5</a>, <a href="#9-communication-with-the-client-information-systems">9</a>, <a href="#10-system-parameters">10</a>, <a href="#14-diagnostics">14</a> and <a href="#17-logs-and-system-services">17</a> to match the new management API</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>10.10.2020</td>
<td>2.50</td>
<td>Corrections in Chapter <a href="#19-management-rest-api">19 Management REST API</a>
</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>13.10.2020</td>
<td>2.51</td>
<td>Added a section about the warning responses <a href="#195-warning-responses">19.5 Warning responses</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>15.10.2020</td>
<td>2.52</td>
<td>Added chapter <a href="#23-managing-api-keys">2.3 Managing API Keys</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>22.10.2020</td>
<td>2.53</td>
<td>Added reference to management REST API's OpenAPI description</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>01.12.2020</td>
<td>2.54</td>
<td>Added endpoint for getting one API key to <a href="#1912-listing-api-keys">19.1.2 Listing API keys</a>
</td>
<td>Janne Mattila</td>
</tr>
<tr>
<td>25.02.2020</td>
<td>2.55</td>
<td>Added information to find X-Road ID from conf backup file in chapter <a href="#132-restore-from-the-command-line">13.2 Restore from the Command Line</a>
</td>
<td>Karl Talumäe</td>
</tr>
<tr>
<td>31.05.2021</td>
<td>2.56</td>
<td>Added information about backup archive contents and encryption</td>
<td>Andres Allkivi</td>
</tr>
<tr>
<td>23.06.2021</td>
<td>2.57</td>
<td>Fix incorrect link in Chapter <a href="#31-configuring-the-signing-key-and-certificate-for-the-security-server-owner">3.1</a>
</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>11.08.2021</td>
<td>2.58</td>
<td>Minor updates to backup archive contents and encryption</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>13.08.2021</td>
<td>2.59</td>
<td>Add documentation about message log archive grouping and encryption</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>25.08.2021</td>
<td>2.60</td>
<td>Update X-Road references from version 6 to 7</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>31.08.2021</td>
<td>2.61</td>
<td>Describe new messagelog and message archive functionality</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>13.09.2021</td>
<td>2.62</td>
<td>Added a new chapter about custom command line arguments <a href="#21-adding-command-line-arguments">21</a>
</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>22.09.2021</td>
<td>2.63</td>
<td>Update backup encryption instructions</td>
<td>Jarkko Hyöty</td>
</tr>
<tr>
<td>05.10.2021</td>
<td>2.64</td>
<td>Moved the chapter about command line arguments to the system parameters document</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>24.11.2021</td>
<td>2.65</td>
<td>Updated anchors to match correct sections</td>
<td>Raido Kaju</td>
</tr>
<tr>
<td>30.11.2021</td>
<td>2.66</td>
<td>Added chapter about configuring account lockouts</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>09.12.2021</td>
<td>2.67</td>
<td>Added instructions for ensuring user account security</td>
<td>Ilkka Seppälä</td>
</tr>
<tr>
<td>09.12.2021</td>
<td>2.68</td>
<td>Updated chapter <a href="#22-additional-security-hardening">22</a> and added information about password policies</td>
<td>Caro Hautamäki</td>
</tr>
<tr>
<td>13.04.2022</td>
<td>2.69</td>
<td>Updated max loggable body size parameter name to correct one</td>
<td>Raido Kaju</td>
</tr>
<tr>
<td>03.05.2022</td>
<td>2.70</td>
<td>Minor updates to system services</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>17.05.2022</td>
<td>2.71</td>
<td>Updates to Diagnostics section, minor updates to backup encryption, message log database encryption and archive encryption and grouping</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>13.07.2022</td>
<td>2.72</td>
<td>Updated chapter <a href="#21-adding-command-line-arguments">21</a> and added <code>XROAD_MESSAGELOG_ARCHIVER_PARAMS</code> argument</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>09.01.2023</td>
<td>2.73</td>
<td>Improved chapter <a href="#9-communication-with-information-systems">9</a>
</td>
<td>Andres Rosenthal</td>
</tr>
<tr>
<td>30.01.2023</td>
<td>2.74</td>
<td>Updated chapter <a href="#133-automatic-backups">13.3 Automatic Backups</a> to reflect recent configuration changes.</td>
<td>Ričardas Bučiūnas</td>
</tr>
<tr>
<td>01.06.2023</td>
<td>2.75</td>
<td>Update references</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>31.05.2023</td>
<td>2.76</td>
<td>Updated chapter <a href="#1915-api-key-caching">19.1.5 API key caching</a> with additional configuration suggestions.</td>
<td>Ričardas Bučiūnas</td>
</tr>
<tr>
<td>11.07.2023</td>
<td>2.77</td>
<td>Minor updates</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>12.07.2023</td>
<td>2.78</td>
<td>Removed deprecated request.sizelimit.* and ratelimit.requests.* parameters</td>
<td>Justas Samuolis</td>
</tr>
<tr>
<td>20.11.2023</td>
<td>2.79</td>
<td>Added Security Server address change chapter</td>
<td>Justas Samuolis</td>
</tr>
<tr>
<td>08.12.2023</td>
<td>2.80</td>
<td>Add a chapter about configuring a minimum required client Security Server version</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>11.12.2023</td>
<td>2.81</td>
<td>Add a chapter about LDAP over PAM configuration</td>
<td>Ričardas Bučiūnas</td>
</tr>
<tr>
<td>08.12.2023</td>
<td>2.82</td>
<td>Disabled client state</td>
<td>Madis Loitmaa</td>
</tr>
<tr>
<td>26.03.2024</td>
<td>2.83</td>
<td>Passing additional parameters to psql</td>
<td>Ovidijus Narkevicius</td>
</tr>
<tr>
<td>09.06.2024</td>
<td>2.84</td>
<td>Acme related updates</td>
<td>Mikk-Erik Bachmann</td>
</tr>
<tr>
<td>12.06.2024</td>
<td>2.85</td>
<td>Acme related updates</td>
<td>Petteri Kivimäki</td>
</tr>
<tr>
<td>16.09.2024</td>
<td>2.86</td>
<td>Acme automatic renewal related updates</td>
<td>Mikk-Erik Bachmann</td>
</tr>
<tr>
<td>28.10.2024</td>
<td>2.87</td>
<td>Minor updates to remote database migration</td>
<td>Eneli Reimets</td>
</tr>
<tr>
<td>08.11.2024</td>
<td>2.88</td>
<td>Add EC key support for authentication and signing certificates</td>
<td>Ovidijus Narkevicius</td>
</tr>
<tr>
<td>17.12.2024</td>
<td>2.89</td>
<td>Acme related updates</td>
<td>Mikk-Erik Bachmann</td>
</tr>
</tbody>
</table>
<div class="markdown-heading"><h2 class="heading-element">Table of Contents 
</h2><a id="table-of-contents-" class="anchor" aria-label="Permalink: Table of Contents " href="#table-of-contents-"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>


<ul>
<li><a href="#license">License</a></li>
<li>
<a href="#1-introduction">1 Introduction</a>
<ul>
<li><a href="#11-the-x-road-security-server">1.1 The X-Road Security Server</a></li>
<li><a href="#12-terms-and-abbreviations">1.2 Terms and abbreviations</a></li>
<li><a href="#13-references">1.3 References</a></li>
</ul>
</li>
<li>
<a href="#2-user-management">2 User Management</a>
<ul>
<li><a href="#21-user-roles">2.1 User Roles</a></li>
<li>
<a href="#22-managing-the-users">2.2 Managing the Users</a>
<ul>
<li><a href="#221-adding-and-removing-users">2.2.1 Adding and Removing Users</a></li>
</ul>
</li>
<li>
<a href="#23-ldap-user-authentication">2.3 LDAP user authentication</a>
<ul>
<li><a href="#231-setting-up-ldap-user-authentication-for-x-road-security-server-using-sssd">2.3.1 Setting up LDAP User Authentication for X-Road Security Server using SSSD</a></li>
</ul>
</li>
<li>
<a href="#24-managing-api-keys">2.4 Managing API Keys</a>
<ul>
<li><a href="#241-creating-a-new-api-key">2.4.1 Creating a new API key</a></li>
<li><a href="#242-editing-the-roles-of-an-api-key">2.4.2 Editing the roles of an API key</a></li>
<li><a href="#243-revoking-an-api-key">2.4.3 Revoking an API key</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#3-security-server-registration">3 Security Server Registration</a>
<ul>
<li>
<a href="#31-configuring-the-signing-key-and-certificate-for-the-security-server-owner">3.1 Configuring the Signing Key and Certificate for the Security Server Owner</a>
<ul>
<li><a href="#311-generating-a-signing-key-and-certificate-signing-request">3.1.1 Generating a Signing Key and Certificate Signing Request</a></li>
<li><a href="#312-importing-a-certificate-from-the-local-file-system">3.1.2 Importing a Certificate from the Local File System</a></li>
<li><a href="#313-importing-a-certificate-from-a-security-token">3.1.3 Importing a Certificate from a Security Token</a></li>
</ul>
</li>
<li>
<a href="#32-configuring-the-authentication-key-and-certificate-for-the-security-server">3.2 Configuring the Authentication Key and Certificate for the Security Server</a>
<ul>
<li><a href="#321-generating-an-authentication-key">3.2.1 Generating an Authentication Key</a></li>
<li><a href="#322-generating-a-certificate-signing-request-for-an-authentication-key">3.2.2 Generating a Certificate Signing Request for an Authentication Key</a></li>
<li><a href="#323-importing-an-authentication-certificate-from-the-local-file-system">3.2.3 Importing an Authentication Certificate from the Local File System</a></li>
</ul>
</li>
<li>
<a href="#33-registering-the-security-server-in-the-x-road-governing-authority">3.3 Registering the Security Server in the X-Road Governing Authority</a>
<ul>
<li><a href="#331-registering-an-authentication-certificate">3.3.1 Registering an Authentication Certificate</a></li>
</ul>
</li>
<li><a href="#34-changing-the-security-server-owner">3.4 Changing the Security Server Owner</a></li>
</ul>
</li>
<li>
<a href="#4-security-server-clients">4 Security Server Clients</a>
<ul>
<li><a href="#41-security-server-client-states">4.1 Security Server Client States</a></li>
<li><a href="#42-adding-a-security-server-client">4.2 Adding a Security Server Client</a></li>
<li><a href="#43-adding-a-security-server-member-subsystem">4.3 Adding a Security Server Member Subsystem</a></li>
<li><a href="#44-configuring-a-signing-key-and-certificate-for-a-security-server-client">4.4 Configuring a Signing Key and Certificate for a Security Server Client</a></li>
<li>
<a href="#45-registering-a-security-server-client-in-the-x-road-governing-authority">4.5 Registering a Security Server Client in the X-Road Governing Authority</a>
<ul>
<li><a href="#451-registering-a-security-server-client">4.5.1 Registering a Security Server Client</a></li>
</ul>
</li>
<li>
<a href="#46-deleting-a-client-from-the-security-server">4.6 Deleting a Client from the Security Server</a>
<ul>
<li><a href="#461-unregistering-a-client">4.6.1 Unregistering a Client</a></li>
<li><a href="#462-deleting-a-client">4.6.2 Deleting a Client</a></li>
</ul>
</li>
<li>
<a href="#47-disabling-client-subsystem-temporarily">4.7 Disabling Client Subsystem Temporarily</a>
<ul>
<li><a href="#471-disabling-client-subsystem">4.7.1 Disabling Client Subsystem</a></li>
<li><a href="#472-enabling-client-subsystem">4.7.2 Enabling Client Subsystem</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#5-security-tokens-keys-and-certificates">5 Security Tokens, Keys, and Certificates</a>
<ul>
<li><a href="#51-availability-states-of-security-tokens">5.1 Availability States of Security Tokens</a></li>
<li>
<a href="#52-registration-states-of-certificates">5.2 Registration States of Certificates</a>
<ul>
<li><a href="#521-registration-states-of-the-signing-certificate">5.2.1 Registration States of the Signing Certificate</a></li>
<li><a href="#522-registration-states-of-the-authentication-certificate">5.2.2 Registration States of the Authentication Certificate</a></li>
</ul>
</li>
<li><a href="#53-validity-states-of-certificates">5.3 Validity States of Certificates</a></li>
<li><a href="#54-activating-and-disabling-the-certificates">5.4 Activating and Disabling the Certificates</a></li>
<li><a href="#55-configuring-and-registering-an-authentication-key-and-certificate">5.5 Configuring and Registering an Authentication key and Certificate</a></li>
<li>
<a href="#56-deleting-a-certificate">5.6 Deleting a Certificate</a>
<ul>
<li><a href="#561-unregistering-an-authentication-certificate">5.6.1 Unregistering an Authentication Certificate</a></li>
<li><a href="#562-deleting-a-certificate-or-a-certificate-signing-request-notice">5.6.2 Deleting a Certificate or a certificate Signing Request notice</a></li>
</ul>
</li>
<li><a href="#57-deleting-a-key">5.7 Deleting a Key</a></li>
</ul>
</li>
<li>
<a href="#6-x-road-services">6 X-Road Services</a>
<ul>
<li>
<a href="#61-adding-a-service-description">6.1 Adding a service description</a>
<ul>
<li><a href="#611-soap">6.1.1 SOAP</a></li>
<li><a href="#612-rest">6.1.2 REST</a></li>
</ul>
</li>
<li><a href="#62-refreshing-a-service-description">6.2 Refreshing a service description</a></li>
<li><a href="#63-enabling-and-disabling-a-service-description">6.3 Enabling and Disabling a service description</a></li>
<li><a href="#64-changing-the-address-of-a-service-description">6.4 Changing the Address of a service description</a></li>
<li><a href="#65-deleting-a-service-description">6.5 Deleting a service description</a></li>
<li><a href="#66-changing-the-parameters-of-a-service">6.6 Changing the Parameters of a Service</a></li>
<li><a href="#67-managing-rest-endpoints">6.7 Managing REST Endpoints</a></li>
<li><a href="#68-configuring-a-minimum-required-client-security-server-version">6.8 Configuring a Minimum Required Client Security Server Version</a></li>
</ul>
</li>
<li>
<a href="#7-access-rights">7 Access Rights</a>
<ul>
<li><a href="#71-changing-the-access-rights-of-a-service">7.1 Changing the Access Rights of a Service</a></li>
<li><a href="#72-adding-a-service-client">7.2 Adding a Service Client</a></li>
<li><a href="#73-changing-the-access-rights-of-a-service-client">7.3 Changing the Access Rights of a Service Client</a></li>
</ul>
</li>
<li>
<a href="#8-local-access-right-groups">8 Local Access Right Groups</a>
<ul>
<li><a href="#81-adding-a-local-group">8.1 Adding a Local Group</a></li>
<li><a href="#82-displaying-and-changing-the-members-of-a-local-group">8.2 Displaying and Changing the Members of a Local Group</a></li>
<li><a href="#83-changing-the-description-of-a-local-group">8.3 Changing the description of a Local Group</a></li>
<li><a href="#84-deleting-a-local-group">8.4 Deleting a Local Group</a></li>
</ul>
</li>
<li>
<a href="#9-communication-with-information-systems">9 Communication with Information Systems</a>
<ul>
<li><a href="#91-communication-with-service-consumer-information-systems">9.1 Communication with Service Consumer Information Systems</a></li>
<li><a href="#92-communication-with-service-provider-information-systems">9.2 Communication with Service Provider Information Systems</a></li>
<li><a href="#93-managing-information-system-tls-certificates">9.3 Managing Information System TLS Certificates</a></li>
</ul>
</li>
<li>
<a href="#10-system-parameters">10 System Parameters</a>
<ul>
<li><a href="#101-managing-the-security-server-address">10.1 Managing the Security Server address</a></li>
<li><a href="#102-managing-the-configuration-anchor">10.2 Managing the Configuration Anchor</a></li>
<li><a href="#103-managing-the-timestamping-services">10.3 Managing the Timestamping Services</a></li>
<li><a href="#104-changing-the-internal-tls-key-and-certificate">10.4 Changing the Internal TLS Key and Certificate</a></li>
<li><a href="#105-approved-certificate-authorities">10.5 Approved Certificate Authorities</a></li>
</ul>
</li>
<li>
<a href="#11-message-log">11 Message Log</a>
<ul>
<li>
<a href="#111-changing-the-configuration-of-the-message-log">11.1 Changing the Configuration of the Message Log</a>
<ul>
<li><a href="#1111-common-parameters">11.1.1 Common Parameters</a></li>
<li><a href="#1112-logging-parameters">11.1.2 Logging Parameters</a></li>
<li><a href="#1113-message-log-encryption">11.1.3 Message Log Encryption</a></li>
<li><a href="#1114-timestamping-parameters">11.1.4 Timestamping Parameters</a></li>
<li><a href="#1115-archiving-parameters">11.1.5 Archiving Parameters</a></li>
<li><a href="#1116-archive-files">11.1.6 Archive Files</a></li>
<li><a href="#1117-archive-encryption-and-grouping">11.1.7 Archive Encryption and Grouping</a></li>
</ul>
</li>
<li><a href="#112-transferring-the-archive-files-from-the-security-server">11.2 Transferring the Archive Files from the Security Server</a></li>
<li><a href="#113-using-a-remote-database">11.3 Using a Remote Database</a></li>
</ul>
</li>
<li>
<a href="#12-audit-log">12 Audit Log</a>
<ul>
<li><a href="#121-changing-the-configuration-of-the-audit-log">12.1 Changing the Configuration of the Audit Log</a></li>
<li><a href="#122-archiving-the-audit-log">12.2 Archiving the Audit Log</a></li>
</ul>
</li>
<li>
<a href="#13-back-up-and-restore">13 Back up and restore</a>
<ul>
<li><a href="#131-back-up-and-restore-in-the-user-interface">13.1 Back up and Restore in the User Interface</a></li>
<li><a href="#132-restore-from-the-command-line">13.2 Restore from the Command Line</a></li>
<li><a href="#133-automatic-backups">13.3 Automatic Backups</a></li>
<li><a href="#134-backup-encryption-configuration">13.4 Backup Encryption Configuration</a></li>
<li><a href="#135-verifying-backup-archive-consistency">13.5 Verifying Backup Archive Consistency</a></li>
</ul>
</li>
<li>
<a href="#14-diagnostics">14 Diagnostics</a>
<ul>
<li><a href="#141-examine-security-server-services-status-information">14.1 Examine Security Server services status information</a></li>
<li><a href="#142-examine-security-server-java-version-information">14.2 Examine Security Server Java version information</a></li>
<li><a href="#143-examine-security-server-encryption-status-information">14.3 Examine Security Server encryption status information</a></li>
</ul>
</li>
<li>
<a href="#15-operational-monitoring">15 Operational Monitoring</a>
<ul>
<li>
<a href="#151-operational-monitoring-buffer">15.1 Operational Monitoring Buffer</a>
<ul>
<li><a href="#1511-stopping-the-collecting-of-operational-data">15.1.1 Stopping the Collecting of Operational Data</a></li>
</ul>
</li>
<li>
<a href="#152-operational-monitoring-daemon">15.2 Operational Monitoring Daemon</a>
<ul>
<li><a href="#1521-configuring-the-health-statistics-period">15.2.1 Configuring the Health Statistics Period</a></li>
<li><a href="#1522-configuring-the-parameters-related-to-database-cleanup">15.2.2 Configuring the Parameters Related to Database Cleanup</a></li>
<li><a href="#1523-configuring-the-parameters-related-to-the-http-endpoint-of-the-operational-monitoring-daemon">15.2.3 Configuring the Parameters related to the HTTP Endpoint of the Operational Monitoring Daemon</a></li>
<li><a href="#1524-installing-an-external-operational-monitoring-daemon">15.2.4 Installing an External Operational Monitoring Daemon</a></li>
<li><a href="#1525-configuring-an-external-operational-monitoring-daemon-and-the-corresponding-security-server">15.2.5 Configuring an External Operational Monitoring Daemon and the Corresponding Security Server</a></li>
<li><a href="#1526-monitoring-health-data-over-jmxmp">15.2.6 Monitoring Health Data over JMXMP</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#16-environmental-monitoring">16 Environmental Monitoring</a>
<ul>
<li><a href="#161-usage-via-soap-api">16.1 Usage via SOAP API</a></li>
<li><a href="#162-usage-via-jmx-api">16.2 Usage via JMX API</a></li>
<li><a href="#163-limiting-environmental-monitoring-remote-data-set">16.3 Limiting environmental monitoring remote data set</a></li>
</ul>
</li>
<li>
<a href="#17-logs-and-system-services">17 Logs and System Services</a>
<ul>
<li><a href="#171-system-services">17.1 System Services</a></li>
<li><a href="#172-logging-configuration">17.2 Logging configuration</a></li>
<li><a href="#173-fault-detail-uuid">17.3 Fault Detail UUID</a></li>
</ul>
</li>
<li><a href="#18-federation">18 Federation</a></li>
<li>
<a href="#19-management-rest-api">19 Management REST API</a>
<ul>
<li>
<a href="#191-api-key-management-operations">19.1 API key management operations</a>
<ul>
<li><a href="#1911-creating-new-api-keys">19.1.1 Creating new API keys</a></li>
<li><a href="#1912-listing-api-keys">19.1.2 Listing API keys</a></li>
<li><a href="#1913-updating-api-keys">19.1.3 Updating API keys</a></li>
<li><a href="#1914-revoking-api-keys">19.1.4 Revoking API keys</a></li>
<li><a href="#1915-api-key-caching">19.1.5 API key caching</a></li>
</ul>
</li>
<li><a href="#192-executing-rest-calls">19.2 Executing REST calls</a></li>
<li><a href="#193-correlation-id-http-header">19.3 Correlation ID HTTP header</a></li>
<li><a href="#194-validation-errors">19.4 Validation errors</a></li>
<li><a href="#195-warning-responses">19.5 Warning responses</a></li>
</ul>
</li>
<li><a href="#20-migrating-to-remote-database-host">20 Migrating to Remote Database Host</a></li>
<li><a href="#21-adding-command-line-arguments">21 Adding command line arguments</a></li>
<li><a href="#22-additional-security-hardening">22 Additional Security Hardening</a></li>
<li><a href="#23-passing-additional-parameters-to-psql">23 Passing additional parameters to psql</a></li>
<li><a href="#24-configuring-acme">24 Configuring ACME</a></li>
<li>
<a href="#25-migrating-to-ec-based-authentication-and-signing-certificates">25 Migrating to EC Based Authentication and Signing Certificates</a>
<ul>
<li><a href="#251-Steps-to-enable-EC-based-certificates">25.1 Steps to Enable EC Based Certificates</a></li>
<li><a href="#252-Backwards-compatibility">25.2Backwards Compatibility</a></li>
</ul>
</li>
</ul>


<div class="markdown-heading"><h2 class="heading-element">License</h2><a id="license" class="anchor" aria-label="Permalink: License" href="#license"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>This document is licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License. To view a copy of this license, visit <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="nofollow">http://creativecommons.org/licenses/by-sa/3.0/</a></p>
<div class="markdown-heading"><h2 class="heading-element">1 Introduction</h2><a id="1-introduction" class="anchor" aria-label="Permalink: 1 Introduction" href="#1-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>This document describes the management and maintenance of an X-Road version 7 Security Server.</p>
<div class="markdown-heading"><h3 class="heading-element">1.1 The X-Road Security Server</h3><a id="11-the-x-road-security-server" class="anchor" aria-label="Permalink: 1.1 The X-Road Security Server" href="#11-the-x-road-security-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The main function of a Security Server is to mediate requests in a way that preserves their evidential value.</p>
<p>The Security Server is connected to the public Internet from one side and to the information system within the organization's internal network from the other side. In a sense, the Security Server can be seen as a specialized application-level firewall that supports the SOAP and REST protocols; hence, it should be set up in parallel with the organization's firewall, which mediates other protocols.</p>
<p>The Security Server is equipped with the functionality needed to secure the message exchange between a client and a service provider.</p>
<ul>
<li>
<p>Messages transmitted over the public Internet are secured using digital signatures and encryption.</p>
</li>
<li>
<p>The service provider's Security Server applies access control to incoming messages, thus ensuring that only those users that have signed an appropriate agreement with the service provider can access the data.</p>
</li>
</ul>
<p>To increase the availability of the entire system, the service user's and service provider's Security Servers can be set up in a redundant configuration as follows.</p>
<ul>
<li>
<p>One service user can use multiple Security Servers in parallel to perform requests.</p>
</li>
<li>
<p>If a service provider connects multiple Security Servers to the network to provide the same services, the requests are load-balanced between the Security Servers.</p>
</li>
<li>
<p>If one of the service provider's Security Servers goes offline, the requests are automatically redirected to other available Security Servers.</p>
</li>
</ul>
<p>The Security Server also depends on a Central Server, which provides the global configuration.</p>
<div class="markdown-heading"><h3 class="heading-element">1.2 Terms and abbreviations</h3><a id="12-terms-and-abbreviations" class="anchor" aria-label="Permalink: 1.2 Terms and abbreviations" href="#12-terms-and-abbreviations"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>See X-Road terms and abbreviations documentation [<a href="#Ref_TERMS">TA-TERMS</a>].</p>
<div class="markdown-heading"><h3 class="heading-element">1.3 References</h3><a id="13-references" class="anchor" aria-label="Permalink: 1.3 References" href="#13-references"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>
<p><a id="Ref_ASiC"></a>[ASiC] ETSI TS 102 918, Electronic Signatures and Infrastructures (ESI); Associated Signature Containers (ASiC)</p>
</li>
<li>
<p><a id="Ref_CRON"></a>[CRON] Quartz Scheduler CRON expression,<br>
<a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html" rel="nofollow">http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html</a></p>
</li>
<li>
<p><a id="Ref_INI"></a>[INI] INI file,<br>
<a href="http://en.wikipedia.org/wiki/INI_file" rel="nofollow">http://en.wikipedia.org/wiki/INI_file</a></p>
</li>
<li>
<p><a id="Ref_JDBC"></a>[JDBC] Connecting to the Database,<br>
<a href="https://jdbc.postgresql.org/documentation/93/connect.html" rel="nofollow">https://jdbc.postgresql.org/documentation/93/connect.html</a></p>
</li>
<li>
<p><a id="Ref_JSON"></a>[JSON] Introducing JSON,<br>
<a href="http://json.org/" rel="nofollow">http://json.org/</a></p>
</li>
<li>
<p><a id="Ref_PR-MESS"></a>[PR-MESS] X-Road: Message Protocol v4.0. Document ID: <a href="pr-mess_x-road_message_protocol.html">PR-MESS</a></p>
</li>
<li>
<p><a id="Ref_SPEC-AL"></a>[SPEC-AL] X-Road: Audit log events. Document ID: <a href="https://github.com/nordic-institute/X-Road/blob/master/doc/Architecture/spec-al_x-road_audit_log_events.md">SPEC-AL</a></p>
</li>
<li>
<p><a id="Ref_PR-OPMON"></a>[PR-OPMON] X-Road: Operational Monitoring Protocol. Document ID: <a href="pr-opmon_x-road_operational_monitoring_protocol_Y-1096-2.html">PR-OPMON</a></p>
</li>
<li>
<p><a id="Ref_PR-OPMONJMX"></a>[PR-OPMONJMX] X-Road: Operational Monitoring JMX Protocol. Document ID: <a href="pr-opmonjmx_x-road_operational_monitoring_jmx_protocol_Y-1096-3.html">PR-OPMONJMX</a></p>
</li>
<li>
<p><a id="Ref_UG-OPMONSYSPAR"></a>[UG-OPMONSYSPAR] X-Road: Operational Monitoring System Parameters. Document ID: <a href="ug-opmonsyspar_x-road_operational_monitoring_system_parameters_Y-1099-1.html">PR-OPMONSYSPAR</a></p>
</li>
<li>
<p><a id="Ref_IG-SS"></a>[IG-SS] X-Road: Security Server Installation Guide. Document ID: <a href="ig-ss_x-road_v6_security_server_installation_guide.html">IG-SS</a></p>
</li>
<li>
<p><a id="Ref_JMX"></a>[JMX] Monitoring and Management Using JMX Technology,<br>
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html" rel="nofollow">http://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html</a></p>
</li>
<li>
<p><a id="Ref_ZABBIX-GATEWAY"></a>[ZABBIX-GATEWAY] Zabbix Java Gateway,<br>
<a href="https://www.zabbix.com/documentation/3.0/manual/concepts/java" rel="nofollow">https://www.zabbix.com/documentation/3.0/manual/concepts/java</a></p>
</li>
<li>
<p><a id="Ref_ZABBIX-JMX"></a>[ZABBIX-JMX] Zabbix JMX Monitoring,<br>
<a href="https://www.zabbix.com/documentation/3.0/manual/config/items/itemtypes/jmx_monitoring" rel="nofollow">https://www.zabbix.com/documentation/3.0/manual/config/items/itemtypes/jmx_monitoring</a></p>
</li>
<li>
<p><a id="Ref_ZABBIX-API"></a>[ZABBIX-API] Zabbix API,<br>
<a href="https://www.zabbix.com/documentation/3.0/manual/api" rel="nofollow">https://www.zabbix.com/documentation/3.0/manual/api</a></p>
</li>
<li>
<p><a id="Ref_ARC-ENVMON"></a>[ARC-ENVMON] X-Road: Environmental Monitoring Architecture. Document ID: <a href="Monitoring-architecture.html">ARC-ENVMON</a>.</p>
</li>
<li>
<p><a id="Ref_PR-ENVMONMES"></a>[PR-ENVMONMES] X-Road: Environmental Monitoring Messages. Document ID: <a href="Monitoring-messages.html">PR-ENVMONMES</a>.</p>
</li>
<li>
<p><a id="Ref_MONITORING_XSD"></a>[MONITORING_XSD] X-Road XML schema for monitoring extension. <a href="../../src/addons/proxymonitor/common/src/main/resources/monitoring.xsd">monitoring.xsd</a>.</p>
</li>
<li>
<p><a id="Ref_TERMS"></a>[TA-TERMS] X-Road Terms and Abbreviations. Document ID: <a href="terms_x-road_docs.html">TA-TERMS</a>.</p>
</li>
<li>
<p><a id="Ref_PR-META"></a>[PR-META] X-Road: Service Metadata Protocol. Document ID: <a href="pr-meta_x-road_service_metadata_protocol.html">PR-META</a>.</p>
</li>
<li>
<p><a id="Ref_PR-MREST"></a>[PR-MREST] X-Road: Service Metadata Protocol for REST. Document ID: <a href="pr-mrest_x-road_service_metadata_protocol_for_rest.html">PR-MREST</a>.</p>
</li>
<li>
<p><a id="Ref_UG-SYSPAR"></a>[UG-SYSPAR] X-Road: System Parameters User Guide. Document ID: <a href="ug-syspar_x-road_v6_system_parameters.html">UG-SYSPAR</a>.</p>
</li>
<li>
<p><a id="Ref_REST_UI-API"></a>[REST_UI-API] X-Road Security Server Admin API OpenAPI Specification, <a href="https://github.com/nordic-institute/X-Road/blob/develop/src/security-server/openapi-model/src/main/resources/META-INF/openapi-definition.yaml">https://github.com/nordic-institute/X-Road/blob/develop/src/security-server/openapi-model/src/main/resources/META-INF/openapi-definition.yaml</a>.</p>
</li>
<li>
<p><a id="Ref_GnuPG"></a>[GnuPG] The GNU Privacy Guard, <a href="https://gnupg.org" rel="nofollow">https://gnupg.org</a>.</p>
</li>
<li>
<p><a id="Ref_UG-SIGDOC"></a>[UG-SIGDOC] X-Road: Signed Document Download and Verification Manual. Document ID: <a href="ug-sigdoc_x-road_signed_document_download_and_verification_manual.html">UG-SIGDOC</a>.</p>
</li>
<li>
<p><a id="Ref_ACME"></a>[ACME] RFC8555: Automatic Certificate Management Environment (ACME), <a href="https://datatracker.ietf.org/doc/html/rfc8555" rel="nofollow">https://datatracker.ietf.org/doc/html/rfc8555</a></p>
</li>
<li>
<p><a id="Ref_ACME-ARI"></a>[ACME-ARI] draft-ietf-acme-ari-05:  Automated Certificate Management Environment (ACME) Renewal Information (ARI) Extension , <a href="https://datatracker.ietf.org/doc/draft-ietf-acme-ari/" rel="nofollow">https://datatracker.ietf.org/doc/draft-ietf-acme-ari/</a></p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">2 User Management</h2><a id="2-user-management" class="anchor" aria-label="Permalink: 2 User Management" href="#2-user-management"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h3 class="heading-element">2.1 User Roles</h3><a id="21-user-roles" class="anchor" aria-label="Permalink: 2.1 User Roles" href="#21-user-roles"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Security servers support the following user roles:</p>
<ul>
<li>
<p><a id="xroad-security-officer"></a><strong>Security Officer</strong> (<code>xroad-security-officer</code>) is responsible for the application of the security policy and security requirements, including the management of key settings, keys, and certificates.</p>
</li>
<li>
<p><a id="xroad-registration-officer"></a><strong>Registration Officer</strong> (<code>xroad-registration-officer</code>) is responsible for the registration and removal of Security Server clients.</p>
</li>
<li>
<p><a id="xroad-service-administrator"></a><strong>Service Administrator</strong> (<code>xroad-service-administrator</code>) manages the data of and access rights to services</p>
</li>
<li>
<p><a id="xroad-system-administrator"></a><strong>System Administrator</strong> (<code>xroad-system-administrator</code>) is responsible for the installation, configuration, and maintenance of the Security Server.</p>
</li>
<li>
<p><a id="xroad-securityserver-observer"></a><strong>Security Server Observer</strong> (<code>xroad-securityserver-observer</code>) can view the status of the Security Server without having access rights to edit the configuration. This role can be used to offer users read-only access to the Security Server admin user interface.</p>
</li>
</ul>
<p>One user can have multiple roles and multiple users can be in the same role. Each role has a corresponding system group, created upon the installation of the system.</p>
<p>Henceforth each applicable section of the guide indicates, which user role is required to perform a particular action. For example:</p>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>If the logged-in user does not have a permission to carry out a particular task, the button that would initiate the action is hidden (and neither is it possible to run the task using its corresponding keyboard combinations or mouse actions). Only the permitted data and actions are visible and available to the user.</p>
<div class="markdown-heading"><h3 class="heading-element">2.2 Managing the Users</h3><a id="22-managing-the-users" class="anchor" aria-label="Permalink: 2.2 Managing the Users" href="#22-managing-the-users"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>User management is carried out on the command line in root user permissions.</p>
<div class="markdown-heading"><h4 class="heading-element">2.2.1 Adding and Removing Users</h4><a id="221-adding-and-removing-users" class="anchor" aria-label="Permalink: 2.2.1 Adding and Removing Users" href="#221-adding-and-removing-users"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To add a new user, enter the command:</p>
<pre><code>adduser username
</code></pre>
<p>To grant permissions to the user you created, add it to the corresponding system groups, for example:</p>
<pre><code>adduser username xroad-security-officer
adduser username xroad-registration-officer
adduser username xroad-service-administrator
adduser username xroad-system-administrator
adduser username xroad-securityserver-observer
</code></pre>
<p>To remove user permission, remove the user from the corresponding system group, for example:</p>
<pre><code>deluser username xroad-security-officer
</code></pre>
<p>Modified user permissions are applied only after a user does a new login.</p>
<p>To remove a user, enter:</p>
<pre><code>deluser username
</code></pre>
<div class="markdown-heading"><h3 class="heading-element">2.3 LDAP user authentication</h3><a id="23-ldap-user-authentication" class="anchor" aria-label="Permalink: 2.3 LDAP user authentication" href="#23-ldap-user-authentication"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>X-Road leverages PAM (Pluggable Authentication Modules) for user authentication, which facilitates LDAP integration.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>The LDAP server is properly configured and operational.</li>
<li>The LDAP server is reachable from the Security Server.</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element">2.3.1 Setting up LDAP User Authentication for X-Road Security Server using SSSD</h4><a id="231-setting-up-ldap-user-authentication-for-x-road-security-server-using-sssd" class="anchor" aria-label="Permalink: 2.3.1 Setting up LDAP User Authentication for X-Road Security Server using SSSD" href="#231-setting-up-ldap-user-authentication-for-x-road-security-server-using-sssd"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To configure LDAP user authentication on the X-Road Security Server using SSSD, follow these steps:</p>
<ol>
<li>
<p><strong>Install the SSSD Package</strong>:</p>
<ul>
<li>On Ubuntu systems, use the following command:
<div class="highlight highlight-source-shell"><pre>sudo apt-get -y install sssd sssd-ldap</pre></div>
</li>
<li>On RHEL systems, use the following command:
<div class="highlight highlight-source-shell"><pre>sudo yum install -y sssd sssd-ldap</pre></div>
</li>
</ul>
</li>
<li>
<p><strong>Configure SSSD</strong>:</p>
<ul>
<li>Create and edit the <code>/etc/sssd/sssd.conf</code> file to set up the connection to your LDAP server with the following configurations:
<ul>
<li><code>[sssd]</code></li>
<li><code>services = nss, pam</code></li>
<li><code>domains = LDAP</code></li>
<li><code>[domain/LDAP]</code></li>
<li><code>id_provider = ldap</code></li>
<li><code>auth_provider = ldap</code></li>
<li><code>chpass_provider = ldap</code></li>
<li><code>ldap_uri = ldap://&lt;LDAP_SERVER_IP_OR_DNS&gt;/</code></li>
<li><code>ldap_search_base = dc=example,dc=com</code></li>
<li><code>ldap_default_bind_dn = cn=admin,dc=example,dc=com</code></li>
<li><code>ldap_default_authtok_type = password</code></li>
<li><code>ldap_default_authtok = &lt;BIND_PASSWORD&gt;</code></li>
<li>Ensure that the file permissions are secure:
<div class="highlight highlight-source-shell"><pre>sudo chmod 600 /etc/sssd/sssd.conf</pre></div>
</li>
</ul>
</li>
<li>Replace placeholders like <code>&lt;LDAP_SERVER_IP_OR_DNS&gt;</code>, <code>&lt;BIND_PASSWORD&gt;</code>, authentication parameters, etc., with actual values specific to your LDAP setup.</li>
</ul>
</li>
<li>
<p><strong>Modify NSS Configuration</strong>:</p>
<ul>
<li>Update the <code>/etc/nsswitch.conf</code> file to include SSSD as a source for user and group information:
<pre lang="conf"><code>passwd:         sss files
group:          sss files
shadow:         sss files
</code></pre>
</li>
</ul>
<p>Note: This step is typically automated by the installation process.</p>
</li>
<li>
<p><strong>Map LDAP Groups to X-Road Roles</strong> (Optional):</p>
<ul>
<li>If LDAP groups do not align with X-Road's requirements, you can map them accordingly in the <code>/etc/xroad/conf.d/local.ini</code> file:
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[proxy-ui-api.complementary-user-role-mappings]</span>
<span class="pl-k">XROAD_SECURITY_OFFICER</span>=ldap_group1,ldap_group2
<span class="pl-k">XROAD_SERVICE_ADMINISTRATOR</span>=ldap_group3,ldap_group4</pre></div>
</li>
<li>Replace <code>ldap_group1</code>, <code>ldap_group2</code>, etc., with actual LDAP group names that correspond to X-Road roles.</li>
</ul>
</li>
<li>
<p><strong>Enable and Start SSSD Service</strong>:</p>
<ul>
<li>Enable and start the SSSD service to apply the changes:
<div class="highlight highlight-source-shell"><pre>sudo systemctl <span class="pl-c1">enable</span> sssd
sudo systemctl start sssd</pre></div>
</li>
</ul>
</li>
<li>
<p><strong>Restart X-Road Services</strong>:</p>
<ul>
<li>Restart the <code>xroad-proxy-ui</code> service to apply the changes:
<div class="highlight highlight-source-shell"><pre>sudo systemctl restart xroad-proxy-ui</pre></div>
</li>
</ul>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">2.4 Managing API Keys</h3><a id="24-managing-api-keys" class="anchor" aria-label="Permalink: 2.4 Managing API Keys" href="#24-managing-api-keys"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>API keys are used to authenticate API calls to Security Server's management REST API. API keys are associated with roles that define the permissions granted to the API key. If the API key is lost, it can be revoked.</p>
<div class="markdown-heading"><h4 class="heading-element">2.4.1 Creating a new API key</h4><a id="241-creating-a-new-api-key" class="anchor" aria-label="Permalink: 2.4.1 Creating a new API key" href="#241-creating-a-new-api-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>All activities: <a href="#xroad-system-administrator">System Administrator</a>
</li>
</ul>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>In the opening view, select <strong>API KEYS</strong> tab.</p>
</li>
<li>
<p>In the opening view, click <strong>CREATE API KEY</strong>. In the wizard that opens</p>
<ol>
<li>
<p>Select the roles you want to be associated with the API key. Click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Click <strong>CREATE KEY</strong>. The API key, API key id and assigned roles will be displayed in the view. <strong>The API key will only be displayed this once so save it in a secure location</strong>.</p>
</li>
<li>
<p>Click <strong>FINISH</strong>.</p>
</li>
</ol>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">2.4.2 Editing the roles of an API key</h4><a id="242-editing-the-roles-of-an-api-key" class="anchor" aria-label="Permalink: 2.4.2 Editing the roles of an API key" href="#242-editing-the-roles-of-an-api-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>All activities: <a href="#xroad-system-administrator">System Administrator</a>
</li>
</ul>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>In the opening view, select <strong>API KEYS</strong> tab.</p>
</li>
<li>
<p>In the opening view, in the API key list, locate the API key you want to edit and click <strong>Edit</strong> at the end of the API key row. In the popup that opens</p>
<ol>
<li>Select the roles you want to be associated with the API key. Click <strong>SAVE</strong>.</li>
</ol>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">2.4.3 Revoking an API key</h4><a id="243-revoking-an-api-key" class="anchor" aria-label="Permalink: 2.4.3 Revoking an API key" href="#243-revoking-an-api-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>All activities: <a href="#xroad-system-administrator">System Administrator</a>
</li>
</ul>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>In the opening view, select <strong>API KEYS</strong> tab.</p>
</li>
<li>
<p>In the opening view, in the API key list, locate the API key you want to revoke and click <strong>Revoke Key</strong> at the end of the API key row. In the dialog that opens click <strong>YES</strong>.</p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">3 Security Server Registration</h2><a id="3-security-server-registration" class="anchor" aria-label="Permalink: 3 Security Server Registration" href="#3-security-server-registration"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To use a Security Server for mediating (exchanging) messages, the Security Server and its owner must be certified by a certification service provider approved by the X-Road governing authority, and the Security Server has to be registered in the X-Road governing authority.</p>
<div class="markdown-heading"><h3 class="heading-element">3.1 Configuring the Signing Key and Certificate for the Security Server Owner</h3><a id="31-configuring-the-signing-key-and-certificate-for-the-security-server-owner" class="anchor" aria-label="Permalink: 3.1 Configuring the Signing Key and Certificate for the Security Server Owner" href="#31-configuring-the-signing-key-and-certificate-for-the-security-server-owner"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The signing keys used by the Security Servers for signing X-Road messages can be stored on software or hardware based (a Hardware Security Module or a smartcard) security tokens, according to the security policy of the X-Road instance.</p>
<p>Depending on the certification policy, the signing keys are generated either in the Security Server or by the certification service provider. Sections <a href="#311-generating-a-signing-key-and-certificate-signing-request">3.1.1</a> and <a href="#312-importing-a-certificate-from-the-local-file-system">3.1.2</a> describe the actions necessary to configure the signing key and certificate in case the key is generated in the Security Server. Section <a href="#313-importing-a-certificate-from-a-security-token">3.1.3</a> describes the importing of the signing key and certificate in case the key is generated by the certification service provider.</p>
<p>The <strong>background colors</strong> of the devices, keys and certificate are explained in Section <a href="#51-availability-states-of-security-tokens">5.1</a>.</p>
<div class="markdown-heading"><h4 class="heading-element">3.1.1 Generating a Signing Key and Certificate Signing Request</h4><a id="311-generating-a-signing-key-and-certificate-signing-request" class="anchor" aria-label="Permalink: 3.1.1 Generating a Signing Key and Certificate Signing Request" href="#311-generating-a-signing-key-and-certificate-signing-request"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong></p>
<ul>
<li>
<p>All activities: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>All activities except logging into the key device: <a href="#xroad-registration-officer">Registration Officer</a></p>
</li>
<li>
<p>Logging in to the key device: <a href="#xroad-system-administrator">System Administrator</a></p>
</li>
</ul>
<p>To generate a Signing key and a Certificate Signing Request, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>If you are using a hardware security token, ensure that the device is connected to the Security Server. The device information must be displayed in the <strong>SIGN AND AUTH KEYS</strong> table.</p>
</li>
<li>
<p>To log in to the token, click <strong>LOG IN</strong> on the token's row in the table and enter the PIN code. Once the correct PIN is entered, the <strong>LOG IN</strong> button changes to <strong>LOG OUT</strong>.</p>
</li>
<li>
<p>To generate a signing key and CSR for it, expand the token's information by clicking the caret next to the token name and click <strong>ADD KEY</strong>. In the wizard that opens</p>
<ol>
<li>
<p>Define a label for the newly created signing key (not mandatory) and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>In the dialog page that opens</p>
<ol>
<li>
<p>Select the certificate usage policy from the <strong>Usage</strong> drop down list (SIGNING for signing certificates)</p>
</li>
<li>
<p>Select the X-Road member the certificate will be issued for from the <strong>Client</strong> drop-down list</p>
</li>
<li>
<p>Select the issuer of the certificate from the <strong>Certification Service</strong> drop-down list</p>
</li>
<li>
<p>Select the format of the certificate signing request (PEM or DER) from the <strong>CSR Format</strong> drop-down list, according to the certification service provider's requirements</p>
</li>
<li>
<p>Click <strong>CONTINUE</strong></p>
</li>
</ol>
</li>
<li>
<p>In the dialog that opens</p>
<ol>
<li>
<p>Review the certificate owner's information that will be included in the CSR and fill in the empty fields, if needed</p>
</li>
<li>
<p>Click <strong>GENERATE CSR</strong></p>
</li>
<li>
<p>Click <strong>DONE</strong></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>After the generation of the CSR, a "Request" record is added under the key's row in the table, indicating that a certificate signing request has been created for this key. The record is added even if the request file was not saved to the local file system.</p>
<p><strong>To certify the signing key, transmit the certificate signing request to the approved certification service provider and accept the signing certificate created from the certificate signing request.</strong></p>
<div class="markdown-heading"><h4 class="heading-element">3.1.2 Importing a Certificate from the Local File System</h4><a id="312-importing-a-certificate-from-the-local-file-system" class="anchor" aria-label="Permalink: 3.1.2 Importing a Certificate from the Local File System" href="#312-importing-a-certificate-from-the-local-file-system"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>To import the signing certificate to the Security Server, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click <strong>IMPORT CERT.</strong>.</p>
</li>
<li>
<p>Locate the certificate file from the local file system and click <strong>OK</strong>. After importing the certificate, the "Request" record under the signing key's row is replaced with the information from the imported certificate. By default, the signing certificate is imported in the "Registered" state.</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">3.1.3 Importing a Certificate from a Security Token</h4><a id="313-importing-a-certificate-from-a-security-token" class="anchor" aria-label="Permalink: 3.1.3 Importing a Certificate from a Security Token" href="#313-importing-a-certificate-from-a-security-token"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>To import a certificate from a security token, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Make sure that a key device containing the signing key and the signing certificate is connected to the Security Server. The device and the keys and certificates stored on the device must be displayed in the <strong>SIGN AND AUTH KEYS</strong> view.</p>
</li>
<li>
<p>To log in to the security token, click <strong>LOG IN</strong> on the token's row in the table and enter the PIN. Once the correct PIN is entered, the <strong>LOG IN</strong> button changes to <strong>LOG OUT</strong>.</p>
</li>
<li>
<p>Click the <strong>Import</strong> button on the row of the certificate. By default, the certificate is imported in the "Registered" state.</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">3.1.4 Ordering the Signing Certificate from the ACME server</h4><a id="314-ordering-the-signing-certificate-from-the-acme-server" class="anchor" aria-label="Permalink: 3.1.4 Ordering the Signing Certificate from the ACME server" href="#314-ordering-the-signing-certificate-from-the-acme-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>If an approved CA supports ACME, then an alternative to creating the CSR, sending it to be signed by the CA by some outside means and later importing it manually, is to order the certificate from the ACME server of the CA. In this case all these steps are done automatically. To do this:</p>
<ol>
<li>
<p>Start the same way as in Section <a href="#331-registering-an-authentication-certificate">3.1.1</a></p>
</li>
<li>
<p>In step 4.ii.d choose a <strong>Certification Service</strong> that supports ACME.</p>
</li>
<li>
<p>Some Certification Services require their ACME Server account to be bound to an external account for added security. If that is the case, the chosen <strong>Client</strong> in step 4.ii.b needs to have external accounts credentials configured in <code>/etc/xroad/conf.d/acme.yml</code> (more info on how to configure ACME can be found in section <a href="#24-configuring-acme">24. Configuring ACME</a>).</p>
</li>
<li>
<p>In step 4.iii make sure the <strong>SAN</strong> field has the correct DNS name. This is used by the ACME server to check that the member owns the domain the certificate is ordered for.</p>
</li>
<li>
<p>Press the <strong>Order certificate</strong> button. This will generate the CSR similarly to the <strong>Generate CSR</strong> button and also order the certificate from the ACME Server. When the order is successful, then certificate is returned and imported to the new key automatically.</p>
</li>
</ol>
<p>Signing Certificate can also be ordered with an already existing CSR. For that follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>Keys and Certificates</strong></p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>On the row of the desired signing key, click <strong>Order Certificate</strong>. This link is only shown if the CSR has been generated beforehand and there are Certificate Authorities available that support ACME and use the same Certificate Profile that the CSR was created with.</p>
</li>
<li>
<p>In the dialog that opens select the issuer of the certificate from the <strong>Certification Service</strong> drop-down list.</p>
</li>
<li>
<p>Click <strong>Order</strong>. When the order succeeds, the certificate is downloaded and imported to the chosen key automatically.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">3.2 Configuring the Authentication Key and Certificate for the Security Server</h3><a id="32-configuring-the-authentication-key-and-certificate-for-the-security-server" class="anchor" aria-label="Permalink: 3.2 Configuring the Authentication Key and Certificate for the Security Server" href="#32-configuring-the-authentication-key-and-certificate-for-the-security-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The <strong>background colors</strong> of the devices, keys and certificate are explained in Section <a href="#51-availability-states-of-security-tokens">5.1</a>.</p>
<div class="markdown-heading"><h4 class="heading-element">3.2.1 Generating an Authentication Key</h4><a id="321-generating-an-authentication-key" class="anchor" aria-label="Permalink: 3.2.1 Generating an Authentication Key" href="#321-generating-an-authentication-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>
<p>All activities: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>Logging in to the key device: <a href="#xroad-system-administrator">System Administrator</a></p>
</li>
</ul>
<p><strong>The Security Server's authentication keys can only be generated on software security tokens.</strong></p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>To log in to the software token, click <strong>LOG IN</strong> on the token's row in the table and enter the token's PIN code. Once the correct PIN is entered, the <strong>LOG IN</strong> button changes to <strong>LOG OUT</strong>.</p>
</li>
<li>
<p>Show more details about the token by clicking the caret next to the token name.</p>
</li>
<li>
<p>To generate an authentication key and CSR for it, click the <strong>ADD KEY</strong> button below the token row. In the wizard that opens</p>
<ol>
<li>
<p>Define a label for the newly created authentication key (not mandatory) and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>In the dialog page that opens</p>
<ol>
<li>
<p>Select the certificate usage policy from the <strong>Usage</strong> drop down list (AUTHENTICATION for authentication certificates)</p>
</li>
<li>
<p>Select the issuer of the certificate from the <strong>Certification Service</strong> drop-down list</p>
</li>
<li>
<p>Select the format of the certificate signing request (PEM or DER) from the <strong>CSR Format</strong> drop-down list, according to the certification service provider's requirements</p>
</li>
<li>
<p>Click <strong>CONTINUE</strong></p>
</li>
</ol>
</li>
<li>
<p>In the dialog that opens</p>
<ol>
<li>
<p>Review the certificate owner's information that will be included in the CSR and fill in the empty fields, if needed</p>
</li>
<li>
<p>Click <strong>GENERATE CSR</strong></p>
</li>
<li>
<p>Click <strong>DONE</strong></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">3.2.2 Generating a Certificate Signing Request for an Authentication Key</h4><a id="322-generating-a-certificate-signing-request-for-an-authentication-key" class="anchor" aria-label="Permalink: 3.2.2 Generating a Certificate Signing Request for an Authentication Key" href="#322-generating-a-certificate-signing-request-for-an-authentication-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>To generate a certificate signing request (CSR) for the authentication key, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>On the row of the desired key, click <strong>Generate CSR</strong>. In the dialog that opens</p>
<p>2.1  Select the certificate usage policy from the <strong>Usage</strong> drop down list (AUTH for authentication certificates);</p>
<p>2.2  select the issuer of the certificate from the <strong>Certification Service</strong> drop-down list;</p>
<p>2.3  select the format of the certificate signing request (PEM or DER), according to the certification service provider's requirements</p>
<p>2.4  click <strong>CONTINUE</strong>;</p>
</li>
<li>
<p>In the form that opens, review the information that will be included in the CSR and fill in the empty fields, if needed.</p>
</li>
<li>
<p>Click <strong>GENERATE CSR</strong> to complete the generation of the CSR and save the prompted file to the local file system.</p>
<ol>
<li>Or click <strong>ORDER CERTIFICATE</strong> to also use the CSR to immediately make an order to the ACME server if the chosen Certification Service supports it.</li>
</ol>
</li>
<li>
<p>Click <strong>DONE</strong></p>
</li>
</ol>
<p>After the generation of the CSR, a "Request" record is added under the key's row in the table, indicating that a certificate signing request has been created for this key. The record is added even if the request file was not saved to the local file system. (In case of a successful ACME order, the certificate will also be imported to the Security Server and be shown under the key's row instead of the CSR.)</p>
<p><strong>To certify the authentication key, transmit the certificate signing request to the approved certification service provider and accept the authentication certificate created from the certificate signing request.</strong></p>
<div class="markdown-heading"><h4 class="heading-element">3.2.3 Importing an Authentication Certificate from the Local File System</h4><a id="323-importing-an-authentication-certificate-from-the-local-file-system" class="anchor" aria-label="Permalink: 3.2.3 Importing an Authentication Certificate from the Local File System" href="#323-importing-an-authentication-certificate-from-the-local-file-system"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>To import the authentication certificate to the Security Server, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select Keys and Certificates.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click <strong>Import certificate</strong>.</p>
</li>
<li>
<p>Locate the certificate file from the local file system and click <strong>OK</strong>. After importing the certificate, the "Request" record under the authentication key's row is replaced with the information from the imported certificate. By default, the certificate is imported in the "Saved" (see Section <a href="#522-registration-states-of-the-authentication-certificate">5.2.2</a>) and "Disabled" states (see Section <a href="#53-validity-states-of-certificates">5.3</a>).</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">3.2.4 Ordering the Authentication Certificate from the ACME server</h4><a id="324-ordering-the-authentication-certificate-from-the-acme-server" class="anchor" aria-label="Permalink: 3.2.4 Ordering the Authentication Certificate from the ACME server" href="#324-ordering-the-authentication-certificate-from-the-acme-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>If an approved CA supports ACME, then an alternative to creating the CSR, sending it to be signed by the CA by some outside means and later importing it manually, is to order the certificate from the ACME server of the CA. In this case all these steps are done automatically. To do this:</p>
<ol>
<li>
<p>Start the same way as in Section <a href="#321-generating-an-authentication-key">3.2.1</a> or <a href="#322-generating-a-certificate-signing-request-for-an-authentication-key">3.2.2</a>.</p>
</li>
<li>
<p>Choose a <strong>Certification Service</strong> that supports ACME.</p>
</li>
<li>
<p>Some Certification Services require their ACME Server account to be bound an external account for added security. If that is the case, the Security Server owner needs to have external accounts credentials configured in <code>/etc/xroad/conf.d/acme.yml</code> (more info on how to configure ACME can be found in section <a href="#24-configuring-acme">24. Configuring ACME</a>).</p>
</li>
<li>
<p>On the CSR fields page make sure the <strong>CN</strong> field (and <strong>SAN</strong> if present) field has the correct DNS name. This is used by the ACME server to check that the member owns the domain the certificate is ordered for.</p>
</li>
<li>
<p>Press the <strong>Order certificate</strong> button. This will generate the CSR similarly to the <strong>Generate CSR</strong> button and also order the certificate from the ACME Server. When the order is successful, then certificate is returned and imported to the new key automatically.</p>
</li>
</ol>
<p>Authentication Certificate can also be ordered with an already existing CSR. For that follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>Keys and Certificates</strong></p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>On the row of the desired authentication key, click <strong>Order Certificate</strong>. This link is only shown if the CSR has been generated beforehand and there are Certificate Authorities available that support ACME and use the same Certificate Profile that the CSR was created with.</p>
</li>
<li>
<p>In the dialog that opens select the issuer of the certificate from the <strong>Certification Service</strong> drop-down list.</p>
</li>
<li>
<p>Click <strong>Order</strong>. When the order succeeds, the certificate is downloaded and imported to the chosen key automatically.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">3.3 Registering the Security Server in the X-Road Governing Authority</h3><a id="33-registering-the-security-server-in-the-x-road-governing-authority" class="anchor" aria-label="Permalink: 3.3 Registering the Security Server in the X-Road Governing Authority" href="#33-registering-the-security-server-in-the-x-road-governing-authority"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To register the Security Server in the X-Road governing authority, the following actions must be completed.</p>
<ul>
<li>
<p>The authentication certificate registration request must be submitted from the Security Server (see <a href="#331-registering-an-authentication-certificate">3.3.1</a>).</p>
</li>
<li>
<p>A request for registering the Security Server must be submitted to the X-Road governing authority according to the organizational procedures of the X-Road instance.</p>
</li>
<li>
<p>The registration request must be approved by the X-Road governing authority.</p>
</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element">3.3.1 Registering an Authentication Certificate</h4><a id="331-registering-an-authentication-certificate" class="anchor" aria-label="Permalink: 3.3.1 Registering an Authentication Certificate" href="#331-registering-an-authentication-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>The Security Server's registration request is signed in the Security Server with the server owner's signing key and the server's authentication key. Therefore, ensure that the corresponding certificates are imported to the Security Server and are in a usable state (the tokens holding the keys are in logged in state and the OCSP status of the certificates is "good").</p>
<p>To submit an authentication certificate registration request, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click <strong>Register</strong> at the end of the desired certificate row. Note that the certificate must be in "Saved" state.</p>
</li>
<li>
<p>In the dialog that opens, enter the Security Server's public DNS name or its external IP address and click <strong>ADD</strong>.</p>
</li>
</ol>
<p>On submitting the request, the message "Certificate registration request successful" is displayed, and the authentication certificate's state is set to "Registration in process".</p>
<p>After the X-Road governing authority has accepted the registration, the registration state of the authentication certificate is set to "Registered" and the registration process is completed.</p>
<div class="markdown-heading"><h3 class="heading-element">3.4 Changing the Security Server Owner</h3><a id="34-changing-the-security-server-owner" class="anchor" aria-label="Permalink: 3.4 Changing the Security Server Owner" href="#34-changing-the-security-server-owner"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>To change the Security Server owner, two registered Owner members must be available. If a registered member is already available, jump directly to step 3.</p>
<p>To add a new member and change it to Owner member, the following actions must be completed.</p>
<ol>
<li>
<p>Add a new Owner member to the Security Server</p>
<p>1.1 On the <strong>CLIENTS</strong> view, select <strong>ADD MEMBER</strong>.</p>
<p>1.2 In the opening wizard, Select the new Owner member from the list of Security Server clients</p>
<p>1.3 Add the selected member</p>
<p>Note: Signing Key and Certificate must be configured for the new Owner member. If needed, the wizard will automatically show the dedicated steps for Key and Certificate configuration to collect the needed information.</p>
</li>
<li>
<p>Register the new member</p>
<p>2.1 On the <strong>CLIENTS</strong> view, locate the new member in the Clients list and click <strong>Register</strong> in the corresponding row</p>
<p>2.2 In the opening dialog, click <strong>Register</strong>. A registeration request is sent to the X-Road Governing Authority</p>
<p>Note: Once the request is approved, the new member appears as "Registered" - it can be set as Owner member.</p>
</li>
<li>
<p>Request a change of the Security Server owner</p>
<p>3.1 On the <strong>CLIENTS</strong> view, locate the new member and click its name to open the member's detail view</p>
<p>3.2 In the detail view, click <strong>MAKE OWNER</strong></p>
<p>1.3 In the opening dialog, click <strong>MAKE OWNER</strong>. An owner change request is sent to the X-Road Governing Authority</p>
</li>
</ol>
<p>Once the owner change request is approved, the new member will be automatically shown as the Security Server Owner member.</p>
<ul>
<li>
<p>A new member must be added to the Security Server (see <a href="#42-adding-a-security-server-client">4.2</a>). If needed, specify the token on which the member is configured</p>
</li>
<li>
<p>If not yet available, a Signing Key and Certificate must be configured for the new member (see <a href="#44-configuring-a-signing-key-and-certificate-for-a-security-server-client">4.4</a>).</p>
</li>
<li>
<p>The new member must be registered in the X-Road Governing Authority (see <a href="#45-registering-a-security-server-client-in-the-x-road-governing-authority">4.5</a>).</p>
</li>
<li>
<p>The Security Server owner change request must be submitted from the Security Server. To submit an owner change request follow these steps.</p>
<ol>
<li>
<p>In the <strong>Member Detail view</strong> click <strong>MAKE OWNER</strong>.</p>
</li>
<li>
<p>Click <strong>MAKE OWNER</strong> to submit a change request.</p>
</li>
</ol>
</li>
<li>
<p>The change request is sent to the X-Road governing authority according to the organizational procedures of the X-Road instance.</p>
</li>
<li>
<p>Once the owner change request is approved by the X-Road governing authority, the member will automatically become the Owner Member.</p>
</li>
<li>
<p>New Authentication Key and Certificate should be configured for the new Security Server owner (see <a href="#32-configuring-the-authentication-key-and-certificate-for-the-security-server">3.2</a>).</p>
</li>
</ul>
<div class="markdown-heading"><h2 class="heading-element">4 Security Server Clients</h2><a id="4-security-server-clients" class="anchor" aria-label="Permalink: 4 Security Server Clients" href="#4-security-server-clients"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Important: to use or provide X-Road services, a Security Server client needs to be certified by a certification service provider approved by the X-Road governing authority, and the association between the client and the Security Server used by the client must be registered at the X-Road governing authority.</strong></p>
<p><strong>This section does not address managing the owner to a Security Server.</strong> The owner's information has been already added to the Security Server upon the installation, and registered upon the Security Server's registration. The owner's registration status can be looked up by selecting <strong>CLIENTS</strong> on the main menu. In the list the item with text "(Owner)" after the name is Security Server's owner. Before the registration of the Security Server, the owner is in the "Saved" state and after the completion of the registration process, in the "Registered" state.</p>
<p>The registration of the Security Server's owner does not extend to the owner's subsystems. The subsystems must be registered as individual clients.</p>
<div class="markdown-heading"><h3 class="heading-element">4.1 Security Server Client States</h3><a id="41-security-server-client-states" class="anchor" aria-label="Permalink: 4.1 Security Server Client States" href="#41-security-server-client-states"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The Security Server distinguishes between the following client states.</p>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_saved.svg"><img src="img/ug-ss_saved.svg" alt="" style="max-width: 100%;"></a> <strong>Saved</strong> – the client's information has been entered and saved into the Security Server's configuration (see <a href="#42-adding-a-security-server-client">4.2</a>), but the association between the client and the Security Server is not registered in the X-Road governing authority. (If the association is registered in the Central Server prior to the entry of data, the client will move to the "Registered" state upon data entry.) From this state, the client can move to the following states:</p>
<ul>
<li>
<p>"Registration in progress", if a registration request for the client is submitted from the Security Server (see <a href="#451-registering-a-security-server-client">4.5.1</a>);</p>
</li>
<li>
<p>"Deleted", if the client's information is deleted from the Security Server configuration (see <a href="#462-deleting-a-client">4.6.2</a>).</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_registration_in_progress.svg"><img src="img/ug-ss_registration_in_progress.svg" alt="" style="max-width: 100%;"></a> <strong>Registration in progress</strong> – a registration request for the client is submitted from the Security Server to the Central Server, but the association between the client and the Security Server is not yet approved by the X-Road governing authority. From this state, the client can move to the following states:</p>
<ul>
<li>
<p>"Registered", if the association between the client and the Security Server is approved by the X-Road governing authority (see <a href="#441-registering-a-security-server-client">4.4.1</a>);</p>
</li>
<li>
<p>"Deletion in progress", if a client deletion request is submitted from the Security Server (see <a href="#461-unregistering-a-client">4.6.1</a>).</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_registered.svg"><img src="img/ug-ss_registered.svg" alt="" style="max-width: 100%;"></a> <strong>Registered</strong> – the association between the client and the Security Server has been approved in the X-Road governing authority. In this state, the client can provide and use X-Road services (assuming all other prerequisites are fulfilled). From this state, the client can move to the following states:</p>
<ul>
<li>
<p>"Global error", if the association between the client and the Security Server has been revoked by the X-Road governing authority;</p>
</li>
<li>
<p>"Deletion in progress", if a client deletion request is submitted from the Security Server (see <a href="#461-unregistering-a-client">4.6.1</a>).</p>
</li>
<li>
<p>"Disabling in progress", if a client disabling request is submitted from the Security Server (see <a href="#471-disabling-client-substystem">4.7.1</a>)</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_disabled.svg"><img src="img/ug-ss_disabled.svg" alt="" style="max-width: 100%;"></a> <strong>Disabled</strong> - The association between the client and the Security server is disabled temporarily (see <a href="#47-disabling-client-subsystem-temporarily">4.7</a>). From this state the client can move to the following states:</p>
<ul>
<li>"Enabling in progress", if client enabling request is submitted from the Security Server (see <a href="#472-enabling-client-subsystem">4.7.2</a>)</li>
<li>"Deletion in progress", if a client deletion request is submitted from the Security Server (see <a href="#461-unregistering-a-client">4.6.1</a>).</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_disabling_in_progress.svg"><img src="img/ug-ss_disabling_in_progress.svg" alt="" style="max-width: 100%;"></a> <strong>Disabling in progress</strong> - a request is made from Security Server to disable client subsystem temporarily, but it has not propagated yet through global configuration. Once the configuration is propagated, client enters the "Disabled" state.</p>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_enabling_in_progress.svg"><img src="img/ug-ss_enabling_in_progress.svg" alt="" style="max-width: 100%;"></a>  <strong>Enabling in progress</strong> - a request is made from Security Server to enable client subsystem, but it has not propagated yet through global configuration. Once the configuration is propagated, client returns to "Registered" state.</p>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_global_error.svg"><img src="img/ug-ss_global_error.svg" alt="" style="max-width: 100%;"></a> <strong>Global error</strong> – the association between the client and the Security Server has been revoked in the Central Server. From this state, the client can move to the following states:</p>
<ul>
<li>
<p>"Registered", if the association between the client and the Security Server has been restored in the Central Server (e.g., the association between the client and the Security Server was lost due to an error);</p>
</li>
<li>
<p>"Deleted", if the client's information is deleted from the Security Server's configuration (see <a href="#452-deleting-a-client">4.6.2</a>).</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="img/ug-ss_deletion_in_progress.svg"><img src="img/ug-ss_deletion_in_progress.svg" alt="" style="max-width: 100%;"></a> <strong>Deletion in progress</strong> – a client deletion request has been submitted from the Security Server. From this state, the client can move to the following state:</p>
<ul>
<li>"Deleted", if the client's information is deleted from the Security Server's configuration (see <a href="#452-deleting-a-client">4.6.2</a>).</li>
</ul>
<p><strong>Deleted</strong> – the client's information has been deleted from the Security Server's configuration.</p>
<div class="markdown-heading"><h3 class="heading-element">4.2 Adding a Security Server Client</h3><a id="42-adding-a-security-server-client" class="anchor" aria-label="Permalink: 4.2 Adding a Security Server Client" href="#42-adding-a-security-server-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>Follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view, click <strong>ADD CLIENT</strong>.</p>
</li>
<li>
<p>In the wizard that opens</p>
<ol>
<li>
<p>Client details page: Select an existing client from the Global list by pressing <strong>SELECT CLIENT</strong> or specify the details of the Client to be added manually and click <strong>NEXT</strong></p>
</li>
<li>
<p>Token page: Select the token where you want to add the SIGN key for the new Client. Click <strong>NEXT</strong></p>
</li>
<li>
<p>Sign key page: Define a label (optional) for the newly created SIGN key and click <strong>NEXT</strong></p>
</li>
<li>
<p>CSR details page: Select the Certification Authority (CA) that will issue the certificate in <strong>Certification Service</strong> field and format of the certificate signing request according to the CA's requirements in the <strong>CSR Format</strong> field. Click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Generate CSR page: Fill in empty CSR fields as needed (like <strong>Organization Name (O)</strong> and <strong>Subject Alternative Name (SAN)</strong>) that are based on the certificate profile that the chosen CA uses, and click <strong>NEXT</strong></p>
<ol>
<li>If the CA supports it, an ACME certificate order can be made with the generated CSR by checking the "<strong>Order certificate from ACME Server with the generated CSR and import the returned certificate to the token.</strong>" checkbox.</li>
</ol>
</li>
<li>
<p>Finish page: click <strong>SUBMIT</strong> and the new client will be added to the Clients list and the new key and CSR (or certificate in case of ACME) will appear in the Keys and Certificates view.</p>
</li>
</ol>
</li>
</ol>
<p>The new client is added to the list of Security Server clients in the "Saved" state.</p>
<div class="markdown-heading"><h3 class="heading-element">4.3 Adding a Security Server Member Subsystem</h3><a id="43-adding-a-security-server-member-subsystem" class="anchor" aria-label="Permalink: 4.3 Adding a Security Server Member Subsystem" href="#43-adding-a-security-server-member-subsystem"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>Follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view in the client list, locate the X-Road member you want to add a subsystem to and click <strong>Add Subsystem</strong> at the end of the row.</p>
</li>
<li>
<p>In the wizard that opens</p>
<p>2.1. Select an existing subsystem from the Global list by pressing <strong>SELECT SUBSYSTEM</strong> or specify the <strong>Subsystem Code</strong> manually</p>
<p>2.2. If you wish to register the new subsystem immediately, check the <strong>Register subsystem</strong> checkbox and then click <strong>ADD SUBSYSTEM</strong>.</p>
<p>(2.3.) If you checked the <strong>Register subsystem</strong> checkbox, a popup will appear asking whether you wish to register the subsystem immediately. In the popup, click <strong>YES</strong>.</p>
</li>
</ol>
<p>The new subsystem is added to the list of Security Server clients in the "Saved" state.</p>
<div class="markdown-heading"><h3 class="heading-element">4.4 Configuring a Signing Key and Certificate for a Security Server Client</h3><a id="44-configuring-a-signing-key-and-certificate-for-a-security-server-client" class="anchor" aria-label="Permalink: 4.4 Configuring a Signing Key and Certificate for a Security Server Client" href="#44-configuring-a-signing-key-and-certificate-for-a-security-server-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A signing key and certificate must be configured for the Security Server client to sign messages exchanged over the X-Road. In addition, a signing key and certificate are required for registering a Security Server client.</p>
<p>Certificates are not issued to subsystems; therefore, the certificate of the subsystem's owner (that is, an X-Road member) is used for the subsystem.</p>
<p>All particular X-Road member's subsystems that are registered in the same Security Server use the same signing certificate for signing messages. Hence, if the Security Server already contains the member's signing certificate, it is not necessary to configure a new signing key and/or certificate when adding a subsystem of that member.</p>
<p>The process of configuring the signing key and certificate for a Security Server client is the same as for the Security Server owner. The process is described in Section <a href="#31-configuring-the-signing-key-and-certificate-for-the-security-server-owner">3.1</a>.</p>
<div class="markdown-heading"><h3 class="heading-element">4.5 Registering a Security Server Client in the X-Road Governing Authority</h3><a id="45-registering-a-security-server-client-in-the-x-road-governing-authority" class="anchor" aria-label="Permalink: 4.5 Registering a Security Server Client in the X-Road Governing Authority" href="#45-registering-a-security-server-client-in-the-x-road-governing-authority"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To register a Security Server client in the X-Road governing authority, the following actions must be completed.</p>
<ul>
<li>
<p>A signing key and certificate must be configured for the member that owns the subsystem to be registered as a the Security Server client (see <a href="#44-configuring-a-signing-key-and-certificate-for-a-security-server-client">4.4</a>).</p>
</li>
<li>
<p>The Security Server client registration request must be submitted from the Security Server (see <a href="#451-registering-a-security-server-client">4.5.1</a>).</p>
</li>
<li>
<p>A request for registering the client must be submitted to the X-Road governing authority according to the organizational procedures of the X-Road instance.</p>
</li>
<li>
<p>The registration request must be approved by the X-Road governing authority.</p>
</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element">4.5.1 Registering a Security Server Client</h4><a id="451-registering-a-security-server-client" class="anchor" aria-label="Permalink: 4.5.1 Registering a Security Server Client" href="#451-registering-a-security-server-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>To submit a client registration request follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view.</p>
</li>
<li>
<p>Click <strong>Register</strong> button on the row that contains the client you wish to register.</p>
</li>
<li>
<p>Click <strong>YES</strong> to submit the request.</p>
</li>
</ol>
<p>On submitting the request, the message "Request sent" is displayed, and the client's state is set to "Registration in process".</p>
<p>After the X-Road governing authority has accepted the registration, the state of the client is set to "Registered" and the registration process is completed.</p>
<div class="markdown-heading"><h3 class="heading-element">4.6 Deleting a Client from the Security Server</h3><a id="46-deleting-a-client-from-the-security-server" class="anchor" aria-label="Permalink: 4.6 Deleting a Client from the Security Server" href="#46-deleting-a-client-from-the-security-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>If a client is deleted from the Security Server, all the information related to the client is deleted from the server as well – that is, the WSDLs, services, access rights, and, if necessary, the certificates.</p>
<p>When one of the clients is deleted, it is not advisable to delete the signing certificate if the certificate is used by other clients registered to the Security Server, e.g., other subsystems belonging the same X-Road member as the deleted subsystem.</p>
<p>A client registered or submitted for registration in the X-Road governing authority (indicated by the "Registered", "Registration in progress" or "Disabled" state) must be unregistered before it can be deleted. The unregistering event sends a Security Server client deletion request from the Security Server to the Central Server.</p>
<div class="markdown-heading"><h4 class="heading-element">4.6.1 Unregistering a Client</h4><a id="461-unregistering-a-client" class="anchor" aria-label="Permalink: 4.6.1 Unregistering a Client" href="#461-unregistering-a-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>To unregister a client, follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view click the name of client that you wish to remove from the server</p>
</li>
<li>
<p>In the window that opens, click <strong>UNREGISTER</strong> and then click <strong>YES</strong>. The Security Server automatically sends a client deletion request to the X-Road Central Server, upon the receipt of which the association between the Security Server and the client is revoked.</p>
</li>
<li>
<p>Next, a notification is displayed about unregistering client. Now the client is moved to the "Deletion in progress" state, wherein the client cannot mediate messages and cannot be registered again in the X-Road governing authority.</p>
</li>
</ol>
<p><em>Note:</em> It is possible to unregister a registered client from the Central Server without sending a deletion request through the Security Server. In this case, the Security Server's administrator responsible for the client must transmit a request containing information about the client to be unregistered to the Central Server's administrator. If the client has been deleted from the Central Server without a prior deletion request from the Security Server, the client is shown in the "Global error" state in the Security Server.</p>
<div class="markdown-heading"><h4 class="heading-element">4.6.2 Deleting a Client</h4><a id="462-deleting-a-client" class="anchor" aria-label="Permalink: 4.6.2 Deleting a Client" href="#462-deleting-a-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>A Security Server client can be deleted if its state is "Saved", "Global error" or "Deletion in progress". Clients that are in states "Registered" or "Registration in progress" need to be unregistered before they can be deleted (see Section <a href="#461-unregistering-a-client">4.6.1</a>).</p>
<p>To delete a client, follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view click the name of the client you wish to remove from the Security Server.</p>
</li>
<li>
<p>In the window that opens, click <strong>DELETE</strong> and then click <strong>YES</strong>. If there are no users for the signature key nor for the certificate associated then an option is presented to delete the client's certificates. To delete the certificates, click <strong>YES</strong> again.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">4.7 Disabling Client Subsystem Temporarily</h3><a id="47-disabling-client-subsystem-temporarily" class="anchor" aria-label="Permalink: 4.7 Disabling Client Subsystem Temporarily" href="#47-disabling-client-subsystem-temporarily"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Security Server client subsystem in "Registered" state may be disabled temporarily for maintenance purposes.</p>
<p>When client subsystem is disabled in Security Server it first enters "Disabling in progress" state. Once the state change is propagated through the global configuration, client subsystem enters the "Disabled" state.</p>
<p>Client subsystem in "Disabled" state may be enabled again. When it is enabled in the Security Server it first enters "Enabling in progress" state.</p>
<p>Subsystem can use and provide X-Road services only in "Registered" state. Subsystem cannot be used while in "Disabled", "Disabling in progress" or "Enabling in progress" states.</p>
<div class="markdown-heading"><h4 class="heading-element">4.7.1 Disabling Client Subsystem</h4><a id="471-disabling-client-subsystem" class="anchor" aria-label="Permalink: 4.7.1 Disabling Client Subsystem" href="#471-disabling-client-subsystem"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>Security Server client subsystem can be disabled only in "Registered" state.</p>
<p>To disable client subsystem, follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view click the name of the client you wish to disable.</p>
</li>
<li>
<p>In the window that opens, click <strong>DISABLE</strong> and then click <strong>YES</strong> in the confirmation dialog.</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">4.7.2 Enabling Client Subsystem</h4><a id="472-enabling-client-subsystem" class="anchor" aria-label="Permalink: 4.7.2 Enabling Client Subsystem" href="#472-enabling-client-subsystem"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a></p>
<p>Security Server client subsystem can be enabled only in "Disabled" state.</p>
<p>To enable client subsystem, follow these steps.</p>
<ol>
<li>
<p>In the <strong>CLIENTS</strong> view click the name of the client you wish to enable.</p>
</li>
<li>
<p>In the window that opens, click <strong>ENABLE</strong> and then click <strong>YES</strong> in the confirmation dialog.</p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">5 Security Tokens, Keys, and Certificates</h2><a id="5-security-tokens-keys-and-certificates" class="anchor" aria-label="Permalink: 5 Security Tokens, Keys, and Certificates" href="#5-security-tokens-keys-and-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h3 class="heading-element">5.1 Availability States of Security Tokens</h3><a id="51-availability-states-of-security-tokens" class="anchor" aria-label="Permalink: 5.1 Availability States of Security Tokens" href="#51-availability-states-of-security-tokens"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Notice that the colors were introduced in version 6.25.0</strong></p>
<p>To display the availability of tokens, the following colors and labels are used in the "Keys and Certificates" view.</p>
<ul>
<li>
<p><strong>Red</strong> text and a label <strong>Not saved</strong> – the token is available to the Security Server, but it's information has not been saved to the Security Server configuration. For example, a smartcard could be connected to the server, but the certificates on the smartcard may not have been imported to the server. The user cannot interact with the token or it's content.</p>
</li>
<li>
<p><strong>Red</strong> text and a label <strong>Blocked</strong> – the token is available to the Security Server and it's information has been saved to the Security Server's configuration but the token is unavailable. The user cannot interact with the token or it's content.</p>
</li>
<li>
<p><strong>Gray</strong> text and a label <strong>Inactive</strong> – the token is not available for the Security Server. The user cannot interact with the token or it's content.</p>
</li>
<li>
<p><strong>Black</strong> text and a <strong>LOG IN</strong> button – the token is logged out. The user must log in the token before interacting the content.</p>
</li>
<li>
<p><strong>Black</strong> text and a <strong>LOG OUT</strong> button – the token is logged in. The user can interact with the token and it's content.</p>
</li>
</ul>
<p><strong>Caution:</strong> The key device's and key's information is automatically saved to the configuration when a certificate associated with either of them is imported to the Security Server, or when a certificate signing request is generated for the key. Similarly, the key device's and key's information is deleted from the Security Server configuration automatically upon the deletion of the last associated certificate and/or certificate signing request.</p>
<div class="markdown-heading"><h3 class="heading-element">5.2 Registration States of Certificates</h3><a id="52-registration-states-of-certificates" class="anchor" aria-label="Permalink: 5.2 Registration States of Certificates" href="#52-registration-states-of-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Registration states indicate if and how a certificate can be used in the X-Road system. In the "Keys and Certificates" view, a certificate's registration states (except "Deleted"  for certificates stored on soft token key) are displayed in the "Status" column.</p>
<div class="markdown-heading"><h4 class="heading-element">5.2.1 Registration States of the Signing Certificate</h4><a id="521-registration-states-of-the-signing-certificate" class="anchor" aria-label="Permalink: 5.2.1 Registration States of the Signing Certificate" href="#521-registration-states-of-the-signing-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A Security Server signing certificate can be in one of the following registration states.</p>
<ul>
<li>
<p><strong>Registered</strong> – the certificate has been imported to the Security Server and saved to its configuration. A signing certificate in a "Registered" state can be used for signing X-Road messages.</p>
</li>
<li>
<p><strong>Deleted</strong> – the certificate has been deleted from the server configuration. If the certificate is in the "Deleted" state and stored on a soft token key, the certificate will not be displayed in the table. If the certificate is in the "Deleted" state and stored on a hardware key device connected to the Security Server, the certificate status will be displayed with a <strong>red circle</strong> and a text <strong>ONLY IN TOKEN</strong>.</p>
</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element">5.2.2 Registration States of the Authentication Certificate</h4><a id="522-registration-states-of-the-authentication-certificate" class="anchor" aria-label="Permalink: 5.2.2 Registration States of the Authentication Certificate" href="#522-registration-states-of-the-authentication-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A Security Server authentication certificate can be in one of the following registration states.</p>
<p><strong>Saved</strong> – the certificate has been imported to the Security Server and saved to its configuration, but the certificate has not been submitted for registration. From this state, the certificate can move to the following states:</p>
<ul>
<li>
<p>"Registration in progress", if the authentication certificate registration request is sent from the Security Server to the Central Server (see <a href="#331-registering-an-authentication-certificate">3.3.1</a>);</p>
</li>
<li>
<p>"Deleted", if the authentication certificate's information is deleted from the Security Server configuration (see Section <a href="#56-deleting-a-certificate">5.6</a>). Notice that after the certificate is deleted, it will not be displayed in the table anymore.</p>
</li>
</ul>
<p><strong>Registration in progress</strong> – an authentication certificate registration request has been created and sent to the Central Server, but the association between the certificate and the Security Server has not yet been approved. From this state, the certificate can move to the following states:</p>
<ul>
<li>
<p>"Registered", if the association between the authentication certificate and the Security Server is approved by the X-Road governing authority (see <a href="#33-registering-the-security-server-in-the-x-road-governing-authority">3.3</a>);</p>
</li>
<li>
<p>"Deletion in progress", if the certificate deletion request has been submitted to the Central Server (see <a href="#561-unregistering-an-authentication-certificate">5.6.1</a>). The user can force this state transition even if the sending of the authentication certificate deletion request fails.</p>
</li>
</ul>
<p><strong>Registered</strong> – the association between the authentication certificate and the Security Server has been approved in the Central Server. An authentication certificate in this state can be used to establish a secure data exchange channel for exchanging X-Road messages. From this state, the certificate can move to the following states:</p>
<ul>
<li>
<p>"Global error", if the association between the authentication certificate and the Security Server has been revoked in the Central Server;</p>
</li>
<li>
<p>"Deletion in progress", if the certificate deletion request has been transmitted to the Central Server (see <a href="#561-unregistering-an-authentication-certificate">5.6.1</a>). The user can force this state transition even if the sending of the authentication certificate deletion request fails.</p>
</li>
</ul>
<p><strong>Global error</strong> – the association between the authentication certificate and the Security Server has been revoked in the Central Server. From this state, the certificate can move to the following states:</p>
<ul>
<li>
<p>"Registered", if the association between the authentication certificate and the Security Server has been restored in the Central Server (e.g., the association between the client and the Security Server was lost due to an error);</p>
</li>
<li>
<p>"Deleted", if the authentication certificate's information is deleted from the Security Server configuration (see <a href="#56-deleting-a-certificate">5.6</a>). Notice that after the certificate is deleted, it will not be displayed in the table anymore.</p>
</li>
</ul>
<p><strong>Deletion in progress</strong> – an authentication certificate registration request has been created for the certificate and sent to the Central Server. From this state, the certificate can be deleted. If the certificate has been deleted from the Security Server configuration, it will not be displayed in the table anymore.</p>
<div class="markdown-heading"><h3 class="heading-element">5.3 Validity States of Certificates</h3><a id="53-validity-states-of-certificates" class="anchor" aria-label="Permalink: 5.3 Validity States of Certificates" href="#53-validity-states-of-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Validity states indicate if and how a certificate can be used independent of the X-Road system. In the "Keys and Certificates" view, the certificate's validity states are displayed in the "OCSP" column. Validity states (except "Disabled") are displayed for certificates that are in the "Registered" registration state.</p>
<p>A Security Server certificate can be in one of the following validity states.</p>
<ul>
<li>
<p><strong>Unknown</strong> (validity information missing) – the certificate does not have a valid OCSP response (the OCSP response validity period is set by the X-Road governing authority) or the last OCSP response was either "unknown" (the responder doesn't know about the certificate being requested) or an error.</p>
</li>
<li>
<p><strong>Suspended</strong> – the last OCSP response about the certificate was "suspended".</p>
</li>
<li>
<p><strong>Good</strong> (valid) – the last OCSP response about the certificate was "good". Only certificates in the "good" (valid) state can be used to sign messages or establish a connection between Security Servers.</p>
</li>
<li>
<p><strong>Expired</strong> – the certificate's validity end date has passed. The certificate is not active and OCSP queries are not performed about it.</p>
</li>
<li>
<p><strong>Revoked</strong> – the last OCSP response about the certificate was "revoked". The certificate is not active and OCSP queries are not performed about it.</p>
</li>
<li>
<p><strong>Disabled</strong> – the user has marked the certificate as disabled. The certificate is not active and OCSP queries are not performed about it.</p>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">5.4 Activating and Disabling the Certificates</h3><a id="54-activating-and-disabling-the-certificates" class="anchor" aria-label="Permalink: 5.4 Activating and Disabling the Certificates" href="#54-activating-and-disabling-the-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>
<p>For authentication certificates: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>For signing certificates: <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
</li>
</ul>
<p>Disabled certificates are not used for signing messages or for establishing secure channels between Security Servers (authentication). If a certificate is disabled, its status in the "OCSP" column in the "Keys and Certificates" table is "Disabled".</p>
<p>To activate or disable a certificate, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>To activate a certificate, click on the desired certificate's name.</p>
<p>3.1 In the opening <strong>Certificate</strong> dialog, click <strong>Activate</strong>. To deactivate a certificate, click <strong>DISABLE</strong> in the <strong>Certificate</strong> dialog.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">5.5 Configuring and Registering an Authentication key and Certificate</h3><a id="55-configuring-and-registering-an-authentication-key-and-certificate" class="anchor" aria-label="Permalink: 5.5 Configuring and Registering an Authentication key and Certificate" href="#55-configuring-and-registering-an-authentication-key-and-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A Security server can have multiple authentication keys and certificates (e.g., during authentication key change).</p>
<p>The process of configuring another authentication key and certificate is described in Section <a href="#32-configuring-the-authentication-key-and-certificate-for-the-security-server">3.2</a>.</p>
<p>The process of registering an authentication certificate is described in Section <a href="#331-registering-an-authentication-certificate">3.3.1</a>.</p>
<div class="markdown-heading"><h3 class="heading-element">5.6 Deleting a Certificate</h3><a id="56-deleting-a-certificate" class="anchor" aria-label="Permalink: 5.6 Deleting a Certificate" href="#56-deleting-a-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>An authentication certificate registered or submitted for registration in the X-Road governing authority (indicated by the "Registered" or "Registration in progress" state) must be unregistered before it can be deleted. The unregistering event sends an authentication certificate deletion request from the Security Server to the Central Server.</p>
<div class="markdown-heading"><h4 class="heading-element">5.6.1 Unregistering an Authentication Certificate</h4><a id="561-unregistering-an-authentication-certificate" class="anchor" aria-label="Permalink: 5.6.1 Unregistering an Authentication Certificate" href="#561-unregistering-an-authentication-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>To unregister an authentication certificate, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click on an authentication certificate that is in the state "Registered" or "Registration in progress".</p>
<p>3.1 In the opening <strong>Certificate</strong> dialog, click <strong>UNREGISTER</strong>.</p>
<p>Next, an authentication certificate deletion request is automatically sent to the X-Road Central Server, upon the receipt of which the associated authentication certificate is deleted from the Central Server. If the request was successfully sent, the message "Certificate unregistration request sent successfully" is displayed and the authentication certificate is moved to the "Deletion in progress" state.</p>
</li>
</ol>
<p>A registered authentication certificate can be deleted from the Central Server without sending a deletion request through the Security Server. In this case, the Security Server's administrator must transmit a request containing information about the authentication certificate to be deleted to the Central Server's administrator. If the authentication certificate has been deleted from the Central Server without a deletion request from the Security Server, the certificate is shown in the "Global error" state in the Security Server.</p>
<div class="markdown-heading"><h4 class="heading-element">5.6.2 Deleting a Certificate or a certificate Signing Request notice</h4><a id="562-deleting-a-certificate-or-a-certificate-signing-request-notice" class="anchor" aria-label="Permalink: 5.6.2 Deleting a Certificate or a certificate Signing Request notice" href="#562-deleting-a-certificate-or-a-certificate-signing-request-notice"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>
<p>For authentication certificates: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>For signing certificates: <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
</li>
</ul>
<p>An authentication certificate saved in the system configuration can be deleted if its state is "Saved", "Global error" or "Deletion in progress". The signing certificate and request notices can always be deleted from the system configuration.</p>
<p><strong>If a certificate is stored on a hardware security token, then the deletion works on two levels:</strong></p>
<ul>
<li>
<p>if the certificate is saved in the server configuration, then the deletion <strong>deletes the certificate from server configuration</strong>, but not from the security token;</p>
</li>
<li>
<p>if the certificate is not saved in the server configuration (certificate's status has a red circle and status is "STORED IN TOKEN"), then the deletion deletes the certificate from the security token (assuming the token supports this operation).</p>
</li>
</ul>
<p><strong>To delete a certificate, follow these steps.</strong></p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click on the certificate that you want to delete.</p>
<p>3.1 In the opening <strong>Certificate</strong> dialog, click <strong>DELETE</strong>. Confirm the deletion by clicking <strong>YES</strong>.</p>
</li>
</ol>
<p><strong>To delete a certificate signing request notice (CSR), follow these steps.</strong></p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>At the end of the desired CSR row click <strong>Delete CSR</strong>. Confirm the deletion by clicking <strong>YES</strong>.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">5.7 Deleting a Key</h3><a id="57-deleting-a-key" class="anchor" aria-label="Permalink: 5.7 Deleting a Key" href="#57-deleting-a-key"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Warning:</strong> Deleting a key from the server configuration also deletes all certificates (and certificate signing request notices) associated with the key.</p>
<p><strong>Access rights</strong></p>
<ul>
<li>
<p>For authentication keys: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>For signing keys: <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
</li>
<li>
<p>For keys without a role: <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-registration-officer">Registration Officer</a></p>
</li>
</ul>
<p>To delete a key, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong>.</p>
</li>
<li>
<p>Show more details about a token by clicking the caret next to the token name.</p>
</li>
<li>
<p>Click on the desired Key.</p>
<p>3.1 In the opening <strong>Key</strong> dialog, click <strong>DELETE</strong>. Confirm the deletion of the key (and its associated certificates) by clicking <strong>YES</strong>.</p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">6 X-Road Services</h2><a id="6-x-road-services" class="anchor" aria-label="Permalink: 6 X-Road Services" href="#6-x-road-services"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>X-Road supports both SOAP and REST services. The services are managed on two levels:</p>
<ul>
<li>
<p>the addition, deletion, and deactivation of services is carried out on the WSDL / REST API / OpenAPI 3 level;</p>
</li>
<li>
<p>the service address, internal network connection method, and the service timeout values are configured at the service level for SOAP services and at the API level for REST / OpenAPI 3 services. In addition, for SOAP / WSDL, it is easy to extend the configuration of one service to all the other services.</p>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">6.1 Adding a service description</h3><a id="61-adding-a-service-description" class="anchor" aria-label="Permalink: 6.1 Adding a service description" href="#61-adding-a-service-description"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<div class="markdown-heading"><h4 class="heading-element">6.1.1 SOAP</h4><a id="611-soap" class="anchor" aria-label="Permalink: 6.1.1 SOAP" href="#611-soap"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>When a new WSDL file is added, the Security Server reads service information from it and displays the information in the table of services. The service code, title and address are read from the WSDL.</p>
<p><strong>To add a WSDL</strong>, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client for which you wish to add WSDL to and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click <strong>ADD WSDL</strong>, enter the WSDL address in the dialog that opens and click <strong>ADD</strong>. Once the window is closed, the WSDL and the information about the services it contains are added to the client. By default, the WSDL is added in disabled state (see <a href="#63-enabling-and-disabling-a-service-description">6.3</a>).</p>
</li>
</ol>
<p><strong>To see a list of services contained in the WSDL</strong></p>
<ul>
<li>click the caret next to the WSDL service url to expand the list.</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element">6.1.2 REST</h4><a id="612-rest" class="anchor" aria-label="Permalink: 6.1.2 REST" href="#612-rest"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>After a new REST service is added, the Security Server displays text "REST" and url for that service.</p>
<p><strong>To add a REST service</strong>, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client for which you wish to add REST service to and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click <strong>ADD REST</strong>. Select whether the URL type is "REST API Base Path" or "OpenAPI 3 Description". Enter the url and service code in the window that opens and click <strong>ADD</strong>.</p>
</li>
<li>
<p>Once the window is closed, the url and the service code are added to the service list. If the added URL type was OpenAPI 3 description, the service description is parsed and endpoints are added under the service. By default, the REST service is added in disabled state (see <a href="#63-enabling-and-disabling-a-service-description">6.3</a>).</p>
</li>
</ol>
<p><strong>To see the service details under the REST service</strong></p>
<ul>
<li>click the caret on the REST service description row to expand the service details.</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">6.2 Refreshing a service description</h3><a id="62-refreshing-a-service-description" class="anchor" aria-label="Permalink: 6.2 Refreshing a service description" href="#62-refreshing-a-service-description"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>Upon refreshing, the Security Server reloads the service description file from the service description URL to the Security Server and checks the service information in the reloaded file against existing services. If the composition of services in the new service description has changed compared to the current version, a warning is displayed and you can either continue with the refresh or cancel.</p>
<p>To refresh the service description, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to refresh and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the arrow symbol in front of the WSDL or REST to be refreshed and click the <strong>Refresh</strong> button.</p>
</li>
<li>
<p>If the new service description contains changes compared to the current service description in the Security Server, a warning is displayed. To proceed with the refresh, click <strong>CONTINUE</strong>.</p>
</li>
</ol>
<p>When the service description is refreshed, the existing services' settings are not overwritten.</p>
<div class="markdown-heading"><h3 class="heading-element">6.3 Enabling and Disabling a service description</h3><a id="63-enabling-and-disabling-a-service-description" class="anchor" aria-label="Permalink: 6.3 Enabling and Disabling a service description" href="#63-enabling-and-disabling-a-service-description"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>A disabled service description is displayed in the services' list with a disabled switch icon on the same row.</p>
<p>Services described by a disabled service description cannot be accessed by the service clients – if an attempt is made to access the service, an error message is returned, containing the information entered by the Security Server's administrator when the service description was disabled.</p>
<p>If a service description is enabled, the services described there become accessible to users. Therefore it is necessary to ensure that before enabling the service description, the parameters of all its services are correctly configured (see <a href="#66-changing-the-parameters-of-a-service">6.6</a>).</p>
<p>To <strong>enable</strong> or <strong>disable</strong> a service description, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the switch icon on the same row with service WSDL or REST service you wish to enable or disable</p>
</li>
</ol>
<p>(3.) If the service was disabled a popup will appear. In the popup, enter a Disable notice which is shown to clients who try to access any of the services in the service description, and click <strong>OK</strong>.</p>
<div class="markdown-heading"><h3 class="heading-element">6.4 Changing the Address of a service description</h3><a id="64-changing-the-address-of-a-service-description" class="anchor" aria-label="Permalink: 6.4 Changing the Address of a service description" href="#64-changing-the-address-of-a-service-description"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To change the service description address, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the link text containing the type of the service and its url in paranthesis</p>
</li>
<li>
<p>In the dialog that opens you can edit the URL for all types of services and for REST services the service code can also be changed. Click <strong>SAVE</strong>. The service information updates accordingly (see section <a href="#62-refreshing-a-service-description">6.2</a>).</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">6.5 Deleting a service description</h3><a id="65-deleting-a-service-description" class="anchor" aria-label="Permalink: 6.5 Deleting a service description" href="#65-deleting-a-service-description"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>When a service description is deleted, all information related to the services described in the service description, including access rights, are deleted.</p>
<p>To delete a service description, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the link text containing the type of the service and its url in paranthesis.</p>
</li>
<li>
<p>Click <strong>DELETE</strong> and confirm the deletion by clicking <strong>YES</strong> in the dialog that opens.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">6.6 Changing the Parameters of a Service</h3><a id="66-changing-the-parameters-of-a-service" class="anchor" aria-label="Permalink: 6.6 Changing the Parameters of a Service" href="#66-changing-the-parameters-of-a-service"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>Service parameters are</p>
<ul>
<li>
<p>"Service URL" – the URL where requests targeted at the service are directed;</p>
</li>
<li>
<p>"Timeout (s)" – the maximum duration of a request to the database, in seconds;</p>
</li>
<li>
<p>"Verify TLS certificate" – toggles the verification of the certificate when a TLS connection is established. This option is used for two different scenarios:</p>
<ul>
<li>Between Security Server and service endpoint.</li>
<li>Between Security Server and service description URL, when metaservices getWsdl or getOpenAPI are used for this subsystem and service. See [<a href="#Ref_PR-META">PR-META</a>] and [<a href="#Ref_PR-MREST">PR-MREST</a>].</li>
</ul>
</li>
</ul>
<p>To change service parameters, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the arrow symbol in front of a REST or WSDL service and in the list that is displayed click the service code which you wish to edit.</p>
</li>
<li>
<p>In the view that opens, configure the service parameters. To apply the selected parameter to all services described in the same service description, select the checkbox adjacent to this parameter in the <strong>Apply to All in WSDL</strong> column. To apply the configured parameters, click <strong>SAVE</strong>.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">6.7 Managing REST Endpoints</h3><a id="67-managing-rest-endpoints" class="anchor" aria-label="Permalink: 6.7 Managing REST Endpoints" href="#67-managing-rest-endpoints"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>REST type service descriptions can contain API endpoints. The purpose of the endpoints is more fine-grained access control. More about that in chapter <a href="#7-access-rights">7 Access Rights</a>.</p>
<p>When URL type of the REST service is an OpenAPI 3 description, endpoints are parsed from the service description automatically. These endpoints cannot be manually updated or deleted. Additionally manual endpoints can be added as needed. When URL type is REST API base path, all the endpoints need to be created manually. Manually created endpoints can also be edited and deleted as needed.</p>
<p>To create API endpoint manually, follow these steps</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the arrow symbol in front of a REST service and click the service code that is displayed.</p>
</li>
<li>
<p>Click the <strong>ENDPOINTS</strong> tab and in the following view click <strong>ADD ENDPOINTS</strong>.</p>
</li>
<li>
<p>In the dialog that opens fill in the HTTP Request method and path for the endpoint and click <strong>ADD</strong></p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">6.8 Configuring a Minimum Required Client Security Server Version</h3><a id="68-configuring-a-minimum-required-client-security-server-version" class="anchor" aria-label="Permalink: 6.8 Configuring a Minimum Required Client Security Server Version" href="#68-configuring-a-minimum-required-client-security-server-version"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Service providers can configure a minimum required X-Road software version for client Security Servers. It means that client Security Servers older than the configured version cannot access the services.</p>
<p>Service providers can configure the required minimum version in the <code>/etc/xroad/conf.d/local.ini</code> configuration file using the <code>proxy.server-min-supported-client-version</code> system property. For example:</p>
<pre><code>[proxy]
server-min-supported-client-version=7.0.0
</code></pre>
<p>The property has no value by default, meaning a minimum version hasn't been set. Instead, when the value is set, all the minor and patch versions starting from the configured version are approved.</p>
<div class="markdown-heading"><h2 class="heading-element">7 Access Rights</h2><a id="7-access-rights" class="anchor" aria-label="Permalink: 7 Access Rights" href="#7-access-rights"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Access rights can be granted to the following access right subjects.</p>
<ul>
<li>
<p><strong>An X-Road member's subsystem.</strong></p>
</li>
<li>
<p><strong>A global access rights group.</strong> Global groups are created in the X-Road governing authority. If a group is granted an access right, it extends to all group members.</p>
</li>
<li>
<p><strong>A local access rights group.</strong> To simplify access rights management, each client in the Security Server can create local access rights groups (see section <a href="#8-local-access-right-groups">8</a>). If a group is granted an access right, it extends to all group members.</p>
</li>
</ul>
<p>There are two options for managing access rights in a Security Server.</p>
<ul>
<li>
<p>Service-based access rights management – if a single service needs to be opened/closed to multiple service clients (see <a href="#71-changing-the-access-rights-of-a-service">7.1</a>).</p>
</li>
<li>
<p>Service client-based access rights management – if a single service client needs multiple services opened/closed (see <a href="#72-adding-a-service-client">7.2</a>).</p>
</li>
</ul>
<p>It is possible to define access rights on two levels for REST services:</p>
<ul>
<li>REST service level</li>
<li>endpoint level</li>
</ul>
<p>In general, a REST service usually has multiple endpoints. When access rights are defined on the service level, they apply to all the endpoints of the REST service. Instead, defining access rights on the endpoint level gives access to specific endpoint(s) only. The service level access rights support both service-based and service client-based access rights management. The endpoint level access rights support only service based access rights management.</p>
<div class="markdown-heading"><h3 class="heading-element">7.1 Changing the Access Rights of a Service</h3><a id="71-changing-the-access-rights-of-a-service" class="anchor" aria-label="Permalink: 7.1 Changing the Access Rights of a Service" href="#71-changing-the-access-rights-of-a-service"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To change the access rights to a <strong>service</strong>, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the arrow symbol in front of a service and click the service code that is displayed.</p>
</li>
<li>
<p>In the window that opens, the access rights table displays information about all X-Road subsystems and groups that have access to the selected service.</p>
</li>
<li>
<p>To add one or more access right subjects to the service, click <strong>ADD SUBJECTS</strong>. The subject search window appears. You can search among    all subsystems and global groups registered in the X-Road governing authority and among the Security Server client's local groups. Fill in optional filters for subjects and click <strong>SEARCH</strong>. Select one or more subjects from the list and click <strong>ADD SELECTED</strong>.</p>
</li>
<li>
<p>To remove service access rights subjects, click <strong>Remove</strong> button on the respective row in the access rights table. To clear the access rights list (that is, remove all subjects), click <strong>REMOVE ALL</strong>.</p>
</li>
</ol>
<p>To change access rights to an <strong>endpoint</strong>, follow there steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the arrow symbol in front of a REST service and click the service code that is displayed.</p>
</li>
<li>
<p>Click the <strong>ENDPOINTS</strong> tab and in the following views endpoints list click <strong>Access Rights</strong> on the respective row of an endpoint.</p>
</li>
<li>
<p>To add one or more access right subjects to the endpoint, click <strong>ADD SUBJECTS</strong>. The subject search window appears. You can search among all subsystems and global groups registered in the X-Road governing authority and among the Security Server client's local groups. Fill in optional filters for subjects and click <strong>SEARCH</strong>. Select one or more subjects from the list and click <strong>ADD SELECTED</strong>.</p>
</li>
<li>
<p>To remove endpoint access rights subjects, click <strong>Remove</strong> button on the respective row in the access rights table and click <strong>YES</strong> in the confirmation dialog. To clear the access rights list (that is, remove all subjects), click <strong>REMOVE ALL</strong> and click <strong>YES</strong> in the confirmation dialog.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">7.2 Adding a Service Client</h3><a id="72-adding-a-service-client" class="anchor" aria-label="Permalink: 7.2 Adding a Service Client" href="#72-adding-a-service-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>The service client view (<strong>CLIENTS</strong> -&gt; <strong>SERVICE CLIENTS</strong>) displays all the service level access rights subjects of the services mediated by this Security Server client. In other words, if an X-Road subsystem or group has been granted a service level access right to a service of this client, then the subject is shown in this view. Subjects that have been granted an endpoint level access right to a REST service, are not shown in the view.</p>
<p>To add a service client, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICE CLIENTS</strong> tab.</p>
</li>
<li>
<p>Click <strong>ADD SUBJECT</strong>. In the following wizard that opens</p>
<ol>
<li>
<p>Select a subject (a subsystem, or a local or global group) to which you want to grant access rights to and click <strong>NEXT</strong></p>
</li>
<li>
<p>Select service(s) whose access rights you want to grant to the selected subject. Click <strong>ADD SELECTED</strong> to grant access rights to the selected services to this subject. Note that access rights to REST API endpoints can not be added using this view, those need to be added on <strong>SERVICES</strong> tab as described in <a href="#71-changing-the-access-rights-of-a-service">7.1</a>.</p>
</li>
</ol>
</li>
</ol>
<p>The subject is added to the list of service clients, after which the service clients view is displayed.</p>
<div class="markdown-heading"><h3 class="heading-element">7.3 Changing the Access Rights of a Service Client</h3><a id="73-changing-the-access-rights-of-a-service-client" class="anchor" aria-label="Permalink: 7.3 Changing the Access Rights of a Service Client" href="#73-changing-the-access-rights-of-a-service-client"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To change the service client's access rights, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client containing service you wish to view and click the <strong>SERVICE CLIENTS</strong> tab.</p>
</li>
<li>
<p>In the view that opens click the name of a subject (a subsystem, or a local or global group) whose access rights you want to change</p>
</li>
<li>
<p>In the window that opens, a list of services opened in the Security Server to the selected subject is displayed.</p>
<ul>
<li>
<p>To add access rights to a service client, start by clicking <strong>ADD SERVICE</strong>. In the window that opens, select the service(s) that you wish to grant to the subject and click <strong>ADD</strong>. Note that access rights to REST API endpoints can not be added using this view, those need to be added on <strong>SERVICES</strong> tab as described in <a href="#71-changing-the-access-rights-of-a-service">7.1</a>.</p>
</li>
<li>
<p>To remove a single access right to a service from the service client click <strong>Remove</strong> button on the corresponding row and click <strong>YES</strong> in the confirmation dialog.</p>
</li>
<li>
<p>To remove all access rights to a service from the service client click <strong>REMOVE ALL</strong> and click <strong>YES</strong> in the confirmation dialog.</p>
</li>
<li>
<p>Removing service level access rights from the service client also removes all REST API endpoint level access rights to the endpoints of the service. In other words, removing access rights from the service client removes all access rights to a service and its endpoints.</p>
</li>
</ul>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">8 Local Access Right Groups</h2><a id="8-local-access-right-groups" class="anchor" aria-label="Permalink: 8 Local Access Right Groups" href="#8-local-access-right-groups"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A local access rights group can be created for a Security Server client in order to facilitate the management of service access rights for a group of X-Road subsystems that use the same services. The access rights granted for a group apply for all the members of the group. Local groups are client-based, that is, a local group can only be used to manage the service access rights of one Security Server client in one Security Server.</p>
<div class="markdown-heading"><h3 class="heading-element">8.1 Adding a Local Group</h3><a id="81-adding-a-local-group" class="anchor" aria-label="Permalink: 8.1 Adding a Local Group" href="#81-adding-a-local-group"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To create a local group for a Security Server client, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client and click the <strong>LOCAL GROUPS</strong> tab. In the view that opens, a list of the client's local groups is displayed.</p>
</li>
<li>
<p>To create a new group, click <strong>ADD GROUP</strong>. In the view that opens, enter the code and description for the new group and click <strong>ADD</strong>.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">8.2 Displaying and Changing the Members of a Local Group</h3><a id="82-displaying-and-changing-the-members-of-a-local-group" class="anchor" aria-label="Permalink: 8.2 Displaying and Changing the Members of a Local Group" href="#82-displaying-and-changing-the-members-of-a-local-group"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To <strong>view the members</strong> of a local group, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client and click the <strong>LOCAL GROUPS</strong> tab.</p>
</li>
<li>
<p>In the view that opens click the code of the group you wish to edit.</p>
</li>
</ol>
<p>To <strong>add one or more members</strong> to a local group, follow these steps in the group's detail view.</p>
<ol>
<li>
<p>Click <strong>ADD MEMBERS</strong>.</p>
</li>
<li>
<p>In the window that opens add optional filters to your members search and click <strong>SEARCH</strong>. Select the subsystems that you wish to add to the group and click <strong>ADD SELECTED</strong>.</p>
</li>
</ol>
<p>To <strong>remove members</strong> from a local group, click <strong>Remove</strong> on the corresponding row on group you wish to be deleted in the group's detail view and then click <strong>YES</strong> in the confirmation dialog. To remove all group members from the group, click <strong>REMOVE ALL</strong> and then click <strong>YES</strong> in the confirmation dialog.</p>
<div class="markdown-heading"><h3 class="heading-element">8.3 Changing the description of a Local Group</h3><a id="83-changing-the-description-of-a-local-group" class="anchor" aria-label="Permalink: 8.3 Changing the description of a Local Group" href="#83-changing-the-description-of-a-local-group"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p>To change the description of a local group, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client and click the <strong>LOCAL GROUPS</strong> tab.</p>
</li>
<li>
<p>In the view that opens click the code of the group you wish to edit.</p>
</li>
<li>
<p>In the group´s detail view change the description. The description is saved when the input field loses focus.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">8.4 Deleting a Local Group</h3><a id="84-deleting-a-local-group" class="anchor" aria-label="Permalink: 8.4 Deleting a Local Group" href="#84-deleting-a-local-group"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-service-administrator">Service Administrator</a></p>
<p><strong>Warning:</strong> When a local group is deleted, all the group members' access rights, which were granted through belonging to the group, are revoked.</p>
<p>To delete a local group, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>CLIENTS</strong> tab, click the name of the client and click the <strong>LOCAL GROUPS</strong> tab.</p>
</li>
<li>
<p>In the view that opens click the code of the group you wish to delete.</p>
</li>
<li>
<p>In the group detail view, click <strong>DELETE</strong> and confirm the deletion by clicking <strong>YES</strong> in the dialog that opens.</p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">9 Communication with Information Systems</h2><a id="9-communication-with-information-systems" class="anchor" aria-label="Permalink: 9 Communication with Information Systems" href="#9-communication-with-information-systems"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-registration-officer">Registration Officer</a>, <a href="#xroad-service-administrator">Service Administrator</a></p>
<div class="markdown-heading"><h3 class="heading-element">9.1 Communication with Service Consumer Information Systems</h3><a id="91-communication-with-service-consumer-information-systems" class="anchor" aria-label="Permalink: 9.1 Communication with Service Consumer Information Systems" href="#91-communication-with-service-consumer-information-systems"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A Security Server can be configured to require either the HTTP, HTTPS, or HTTPS with Client Authentication (i.e. HTTP over mTLS) protocol from the consumer role information systems for communication.</p>
<ul>
<li>
<p>HTTP protocol should be used if the consumer information system and the Security Server communicate in a private network segment where no other computers are connected to. Furthermore, the information system must not allow interactive log-in.</p>
</li>
<li>
<p>HTTPS NOAUTH - a.k.a plain HTTPS protocol should be used if it is not possible to provide a separate network segment for the communication between the information system and the Security Server. In that case, cryptographic methods are used to protect their communication against potential eavesdropping and interception.</p>
</li>
<li>
<p>HTTPS - a.k.a. HTTPS with Client Authentication protocol (<strong>default for new clients</strong>) should be used to protect against unauthorised communication in addition to potential eavesdropping and interception. Before HTTPS can be used, internal TLS certificates must be created for the information systems and uploaded to the Security Server.</p>
</li>
</ul>
<p><strong>By default the connection type for all the Security Server clients is set to HTTPS to prevent unauthorised use of the clients.</strong></p>
<p><strong>It is strongly recommended to keep the connection type of the Security Server owner as HTTPS to prevent Security Server clients from making operational monitoring data requests as a Security Server owner.</strong></p>
<p>To set the connection method for information systems in the <strong>service consumer role</strong>, follow these steps:</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table</p>
</li>
<li>
<p>In the view that opens, select the <strong>INTERNAL SERVERS</strong> tab</p>
</li>
<li>
<p>On the <strong>Connection type</strong> drop-down, select the connection method between HTTP, HTTPS NOAUTH or HTTPS. The changes will be saved immediately on selecting the new method and a "Connection type updated" message is displayed.</p>
<p><strong>Note:</strong> If the HTTP connection method is selected, but the information system connects to the Security Server over HTTPS, then the connection is accepted, but the client's internal TLS certificate is not verified (same behavior as with HTTPS NOAUTH).</p>
<p><strong>Note:</strong> If HTTPS NOAUTH method is selected keep in mind that the consumer information system must trust the Security Server's TLS certificate. This can be achieved by exporting Security Server's internal TLS certificate into information system's truststore (see section <a href="#93-managing-information-system-tls-certificates">9.3</a>).</p>
<p><strong>Note:</strong> If HTTPS method is selected then additionally the client information system's TLS certificate must be trusted. In order to accomplish that the certificate must be added into Security Server's <strong>Information System TLS certificate</strong> list (see section <a href="#93-managing-information-system-tls-certificates">9.3</a>).</p>
</li>
</ol>
<p>Depending on the configured connection method, the request URL for information system is <strong><code>http://SECURITYSERVER/</code></strong> or <strong><code>https://SECURITYSERVER/</code></strong>. When making the request, the address <code>SECURITYSERVER</code> must be replaced with the actual address of the Security Server.</p>
<div class="markdown-heading"><h3 class="heading-element">9.2 Communication with Service Provider Information Systems</h3><a id="92-communication-with-service-provider-information-systems" class="anchor" aria-label="Permalink: 9.2 Communication with Service Provider Information Systems" href="#92-communication-with-service-provider-information-systems"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The connection method for information systems in the <strong>service provider role</strong> is determined by the protocol in the URL. To change the connection method, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table.</p>
</li>
<li>
<p>In the view that opens, select the <strong>SERVICES</strong> tab.</p>
</li>
<li>
<p>Click the caret next to the desired service description to show all services related to it.</p>
</li>
<li>
<p>Click on a service code in the table.</p>
</li>
<li>
<p>In the view that opens, change the protocol (a.k.a. scheme) part in the Service URL to either <strong>http://</strong> or <strong>https://</strong>.</p>
</li>
</ol>
<ul>
<li>
<p>HTTP – the service/adapter URL begins with "<strong>http:</strong>//...".</p>
</li>
<li>
<p>HTTPS – the service/adapter URL begins with "<strong>https</strong>://".</p>
<ul>
<li>If <strong>Verify TLS certificate</strong> checkbox is left unchecked it means that service provider information system's TLS certificate is not verified and trusted by default.</li>
<li>If <strong>Verify TLS certificate</strong> checkbox is checked it means that service provider information system's TLS certificate is verified. In order to make the information system's TLS certificate trusted, it must be added into Security Server's <strong>Information System TLS certificate</strong> list (see section <a href="#93-managing-information-system-tls-certificates">9.3</a>).</li>
<li>When the service provider information system needs to verify the Security Server's internal TLS certificate, the certificate must be first exported and then imported into the service provider information system's truststore (see section <a href="#93-managing-information-system-tls-certificates">9.3</a>).</li>
</ul>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">9.3 Managing Information System TLS Certificates</h3><a id="93-managing-information-system-tls-certificates" class="anchor" aria-label="Permalink: 9.3 Managing Information System TLS Certificates" href="#93-managing-information-system-tls-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To add an internal TLS certificate for a Security Server owner or Security Server client (for HTTPS connections), follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table</p>
</li>
<li>
<p>In the view that opens, select the <strong>INTERNAL SERVERS</strong> tab</p>
</li>
<li>
<p>To add a certificate, click <strong>ADD</strong> in the <strong>Information System TLS certificate</strong> section, select a certificate file from the local file system and click <strong>OK</strong>. The certificate fingerprint appears in the "Information System TLS certificate" table.</p>
</li>
</ol>
<p>To display the detailed information of an internal TLS certificate, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table</p>
</li>
<li>
<p>In the view that opens, select the <strong>INTERNAL SERVERS</strong> tab</p>
</li>
<li>
<p>Click on a certificate in the "Information System TLS certificate".</p>
</li>
</ol>
<p>To delete an internal TLS certificate, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table</p>
</li>
<li>
<p>In the view that opens, select the <strong>INTERNAL SERVERS</strong> tab</p>
</li>
<li>
<p>Click on a certificate in the "Information System TLS certificate".</p>
</li>
<li>
<p>In the <strong>Certificate</strong> view that opens, click <strong>DELETE</strong>. Confirm deletion by clicking <strong>YES</strong>.</p>
</li>
</ol>
<p>To export the Security Server's internal TLS certificate, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>CLIENTS</strong>, select a Security Server owner or a client from the table</p>
</li>
<li>
<p>In the view that opens, select the <strong>INTERNAL SERVERS</strong> tab</p>
</li>
<li>
<p>Click <strong>Export</strong> at the end of a certificate row in the "Security Server certificate" table and save the prompted file to the local file system.</p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">10 System Parameters</h2><a id="10-system-parameters" class="anchor" aria-label="Permalink: 10 System Parameters" href="#10-system-parameters"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The Security Server system parameters are:</p>
<ul>
<li>
<p><strong>Security Server address.</strong> The Security Server address.</p>
</li>
<li>
<p><strong>Configuration anchor's information.</strong> The configuration anchor contains data that is used to periodically download signed configuration from the Central Server and to verify the signature of the downloaded configuration.</p>
</li>
<li>
<p><strong>Timestamping service information.</strong> Timestamping is used to preserve the evidential value of messages exchanged over X-Road.</p>
</li>
<li>
<p><strong>Approved Certificate Authorities.</strong> A read-only list of approved certificate authorities (defined in the global configuration). The Security Server trusts authentication and signing certificates signed by the listed authorities.</p>
</li>
<li>
<p><strong>The internal TLS key and certificate.</strong> The internal TLS certificate is used to establish a TLS connection with the Security Server client's information system if the "HTTPS" connection method is chosen for the client's servers.</p>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">10.1 Managing the Security Server address</h3><a id="101-managing-the-security-server-address" class="anchor" aria-label="Permalink: 10.1 Managing the Security Server address" href="#101-managing-the-security-server-address"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> System Administrator](#xroad-system-administrator)</p>
<p>To change the Security Server address, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab.</p>
</li>
<li>
<p>In the <strong>Security Server</strong> section, click <strong>EDIT</strong> at the end of a row.</p>
</li>
<li>
<p>Enter the new Security Server address and click <strong>SAVE</strong>.</p>
</li>
</ol>
<p><em>Note</em>: The updated Security Server address will come into effect after the global configuration refresh.</p>
<div class="markdown-heading"><h3 class="heading-element">10.2 Managing the Configuration Anchor</h3><a id="102-managing-the-configuration-anchor" class="anchor" aria-label="Permalink: 10.2 Managing the Configuration Anchor" href="#102-managing-the-configuration-anchor"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights</strong></p>
<ul>
<li>
<p>For uploading the configuration anchor: <a href="#xroad-security-officer">Security Officer</a></p>
</li>
<li>
<p>For downloading the configuration anchor: <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-system-administrator">System Administrator</a></p>
</li>
</ul>
<p>To upload the configuration anchor, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab.</p>
</li>
<li>
<p>In the <strong>Configuration Anchor</strong> section, click <strong>UPLOAD</strong>.</p>
</li>
<li>
<p>Find the anchor file from the local file system and click <strong>Open</strong>.</p>
</li>
<li>
<p>Ensure that the anchor file you are uploading is valid by comparing the hash value of the uploaded file with the hash value of the currently valid anchor published by the X-Road governing authority. If the hash values match, confirm the upload by clicking <strong>CONFIRM</strong>.</p>
</li>
</ol>
<p>To download the configuration anchor, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab.</p>
</li>
<li>
<p>On the <strong>Configuration Anchor</strong> section, click <strong>DOWNLOAD</strong> and save the prompted file.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">10.3 Managing the Timestamping Services</h3><a id="103-managing-the-timestamping-services" class="anchor" aria-label="Permalink: 10.3 Managing the Timestamping Services" href="#103-managing-the-timestamping-services"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a></p>
<p>To add a timestamping service, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab.</p>
</li>
<li>
<p>In the <strong>Timestamping Services</strong> section, click <strong>ADD</strong>.</p>
</li>
<li>
<p>In the dialog that opens, select a service and click <strong>ADD</strong>.</p>
</li>
</ol>
<p>To delete a timestamping service, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab.</p>
</li>
<li>
<p>In the <strong>Timestamping Services</strong> section, click <strong>DELETE</strong> at the end of the row of the service you wish to delete.</p>
</li>
</ol>
<p><em>Note</em>: If more than one timestamping service is configured, the Security Server will try to get a timestamp from the topmost service in the table, moving down to the next service if the try was unsuccessful. The failover covers both connection and timestamp response verification issues. For example, Security Server is not able to establish a connection to a timestamping service because of a misconfigured firewall, or verification of a timestamp response fails because of the sign certificate of the timestamping service is changed.</p>
<div class="markdown-heading"><h3 class="heading-element">10.4 Changing the Internal TLS Key and Certificate</h3><a id="104-changing-the-internal-tls-key-and-certificate" class="anchor" aria-label="Permalink: 10.4 Changing the Internal TLS Key and Certificate" href="#104-changing-the-internal-tls-key-and-certificate"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-security-officer">Security Officer</a>, <a href="#xroad-system-administrator">System Administrator</a></p>
<p><em>To change the Security Server's internal TLS key and certificate</em>, follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>Keys and Certificates</strong></p>
</li>
<li>
<p>In the opening view, select <strong>SECURITY SERVER TLS KEY</strong> tab</p>
</li>
<li>
<p>In the opening view, click <strong>GENERATE KEY</strong> and in the dialog that opens, click <strong>CONFIRM</strong>.</p>
<p>The Security Server generates a key used for communication with the client information systems, and the corresponding self-signed certificate. The Security Server's certificate fingerprint will also change. The Security Server's domain name is saved to the certificate's <strong>Common Name</strong> field, and the internal IP address to the <strong>subjectAltName</strong> extension field.</p>
</li>
</ol>
<p><em>To generate a new certificate request</em>, follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong></p>
</li>
<li>
<p>In the opening view, select <strong>SECURITY SERVER TLS KEY</strong> tab</p>
</li>
<li>
<p>In the "TLS Key and Certificate" section, at the end of the key row, click <strong>Generate CSR</strong></p>
</li>
<li>
<p>In the opening view, input the <strong>Distinguished Name</strong> and click <strong>GENERATE CSR</strong>. Save the certificate request file to the local file system and click <strong>DONE</strong>.</p>
<p>The Security Server generates a certificate request using the current key and the provided <strong>Distinguished Name</strong>.</p>
</li>
</ol>
<p><em>To import a new TLS certificate</em>, follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong></p>
</li>
<li>
<p>In the opening view, select <strong>SECURITY SERVER TLS KEY</strong> tab</p>
</li>
<li>
<p>In the opening view, click <strong>IMPORT CERT.</strong> and point to the file to be imported.</p>
<p>The imported certificate must be in PEM-format to be accepted. Certificate chains are supported; concatenate possible intermediate certificate(s) to the server certificate before importing the file.</p>
</li>
</ol>
<p><em>To export the Security Server's internal TLS certificate</em>, follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>KEYS AND CERTIFICATES</strong></p>
</li>
<li>
<p>In the opening view, select <strong>SECURITY SERVER TLS KEY</strong> tab</p>
</li>
<li>
<p>In the opening view, click <strong>EXPORT CERT.</strong> and save the prompted file to the local file system.</p>
<p>Note that only the internal server certificate is exported, not the possible intermediate certificates.</p>
</li>
</ol>
<p><em>To view the detailed information of the Security Server's internal TLS certificate</em>, follow these steps.</p>
<ol>
<li>
<p>On the <strong>Navigation tabs</strong>, select <strong>Keys and Certificates</strong></p>
</li>
<li>
<p>In the opening view, select <strong>SECURITY SERVER TLS KEY</strong> tab</p>
</li>
<li>
<p>In the "TLS Key and Certificate" section, click on the certificate hash.</p>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">10.5 Approved Certificate Authorities</h3><a id="105-approved-certificate-authorities" class="anchor" aria-label="Permalink: 10.5 Approved Certificate Authorities" href="#105-approved-certificate-authorities"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><em>To list the approved certificate authorities</em>, follow these steps.</p>
<ol>
<li>
<p>In the <strong>Navigation tabs</strong>, select <strong>SETTINGS</strong>.</p>
</li>
<li>
<p>In the opening view select <strong>SYSTEM PARAMETERS</strong> tab. Approved certificate authorities are listed in the "Approved Certificate Authorities" section.</p>
</li>
</ol>
<p>Lists approved certificate authorities. The listing contains the following information:</p>
<ul>
<li>CA certificate subject distinguished name. Top-level CAs are <strong>emphasized</strong>.</li>
<li>OCSP response status (not applicable to top-level CAs, shown as N/A). See <a href="#53-validity-states-of-certificates">5.3 Validity States of Certificates</a> for explanation, with the following exceptions:
<ul>
<li>Disabled status is not used</li>
<li>Additional status "not available" if the OCSP response is not available at all, e.g. due to an error.</li>
</ul>
</li>
<li>Certificate expiration date.</li>
</ul>
<div class="markdown-heading"><h2 class="heading-element">11 Message Log</h2><a id="11-message-log" class="anchor" aria-label="Permalink: 11 Message Log" href="#11-message-log"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The purpose of the message log is to provide means to prove the reception of a regular request or response message to a third party. The Security Server supports three options for configuring message log:</p>
<ul>
<li>Full logging
<ul>
<li>The whole message including both message body and metadata is logged. The log records can be verified afterwards and they can be used as evidence.</li>
</ul>
</li>
<li>Metadata logging
<ul>
<li>Only metadata is logged while message body is not logged. Verifying the log records afterwards is not possible and they cannot be used as evidence.</li>
</ul>
</li>
<li>No message logging
<ul>
<li>Message logging is fully disabled, neither message body nor metadata is logged. No log records are generated.</li>
</ul>
</li>
</ul>
<p>Full logging and metadata logging can be configured on Security Server and subsystem level. When the Security Server level configuration is used, the same configuration is applied to all the subsystems. Instead, when the subsystem level configuration is used, the configuration is applied to specific subsystems only. In addition, combining the Security Server and subsystem level configurations is also possible, e.g., set metadata logging on the Security Server level and enable full logging for specific subsystems only. Instead, message logging is fully disabled on a Security Server level. Therefore, a subsystem that requires full or metadata logging should not be registered on the same Security Server with a subsystem that requires fully disabling message logging.</p>
<p>Regardless of how logging is configured, messages exchanged between Security Servers are always signed and encrypted. Also, when full logging or metadata logging is enabled, the Security Server produces a signed and timestamped document (Associated Signature Container [ASiC]) for regular requests and responses.</p>
<p>Message log data is stored to the database of the Security Server during message exchange. When storing messages to the database, the message body can be optionally encrypted, but by default the encryption is switched off. According to the configuration (<a href="#1114-timestamping-parameters">11.1.4 Timestamping Parameters</a>), the timestamping of the signatures of the exchanged messages is either synchronous to the message exchange process or is done asynchronously using the time period set by the X-Road governing agency. In case message logging is fully disabled, timestamping doesn't occur at all.</p>
<p>In case of synchronous timestamping, the timestamping is an integral part of the message exchange process (one timestamp is taken for the request and another for the response). If the timestamping fails, the message exchange fails as well and the Security Server responds with an error message.</p>
<p>In case of asynchronous timestamping, all the messages (maximum limit is determined in the configuration, see <a href="#1114-timestamping-parameters">11.1.4 Timestamping Parameters</a>) stored in the message log since the last periodical timestamping event are timestamped with a single (batch) timestamp. By default, the Security Server uses asynchronous timestamping for better performance and availability.</p>
<p>The Security Server periodically composes signed (and timestamped) documents from the (optionally encrypted) message log data and archives them in the local file system. Archive files are ZIP containers containing one or more signed documents and a special linking information file for additional integrity verification purpose. Message log archive encryption and grouping can be enabled and configured separately. By default, both are disabled. Message grouping can be configured by member or subsystem. By default, all archive files go to the same default group. Grouping and encryption are enabled/disabled on a Security Server level - they are either enabled or disabled for all the members and subsystems. It's not possible to enable/disable neither of them for selected members or subsystems only.</p>
<div class="markdown-heading"><h3 class="heading-element">11.1 Changing the Configuration of the Message Log</h3><a id="111-changing-the-configuration-of-the-message-log" class="anchor" aria-label="Permalink: 11.1 Changing the Configuration of the Message Log" href="#111-changing-the-configuration-of-the-message-log"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Configuration parameters are defined in INI files [<a href="#Ref_INI">INI</a>], where each section contains the parameters for a particular Security Server component. The default message log configuration is located in the file</p>
<pre><code>/etc/xroad/conf.d/addons/message-log.ini
</code></pre>
<p>In order to override default values, create or edit the file</p>
<pre><code>/etc/xroad/conf.d/local.ini
</code></pre>
<p>Create the <code>[message-log]</code> section (if not present) in the file. Below the start of the section, list the values of the parameters, one per line.</p>
<p>For example, to configure the parameters <code>archive-path</code> and <code>archive-max-filesize</code>, the following lines must be added to the configuration file:</p>
<pre><code>[message-log]
archive-path=/my/archive/path/
archive-max-filesize=67108864
</code></pre>
<div class="markdown-heading"><h4 class="heading-element">11.1.1 Common Parameters</h4><a id="1111-common-parameters" class="anchor" aria-label="Permalink: 11.1.1 Common Parameters" href="#1111-common-parameters"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>
<code>hash-algo-id</code> – the hash algorithm that is used for hashing in the message log. Possible choices are <code>SHA-256</code>, <code>SHA-384</code>, <code>SHA-512</code>. Defaults to <code>SHA-512</code>.</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">11.1.2 Logging Parameters</h4><a id="1112-logging-parameters" class="anchor" aria-label="Permalink: 11.1.2 Logging Parameters" href="#1112-logging-parameters"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>
<p><code>message-body-logging</code> - if set to true, the messages are logged in their original form. If false, the message body is emptied of its contents.</p>
</li>
<li>
<p><code>enabled-body-logging-local-producer-subsystems</code> - when message-body-logging is set to false, this field contains the overrides for the local producer subsystems.</p>
</li>
<li>
<p><code>enabled-body-logging-remote-producer-subsystems</code> - when message-body-logging is set to false, this field contains the overrides for the remote producer subsystems.</p>
</li>
<li>
<p><code>disabled-body-logging-local-producer-subsystems</code> - when message-body-logging is set to true, this field contains the overrides for the local producer subsystems.</p>
</li>
<li>
<p><code>disabled-body-logging-remote-producer-subsystems</code> - when message-body-logging is set to true, this field contains the overrides for the remote producer subsystems.</p>
</li>
<li>
<p><code>max-loggable-message-body-size</code> - the maximum REST message body size that will be written to the messagelog.</p>
</li>
<li>
<p><code>truncated-body-allowed</code> - if the REST message body size exceeds the max-loggable-message-body-size truncate the body (true) or reject the message (false)</p>
</li>
<li>
<p><code>messagelog-encryption-enabled</code> - if set to true, the message bodies are written to the database in an encrypted format</p>
</li>
<li>
<p><code>messagelog-keystore</code> - path to the messagelog keystore</p>
</li>
<li>
<p><code>messagelog-keystore-password</code> - messagelog keystore password</p>
</li>
<li>
<p><code>messagelog-key-id</code> - messagelog keystore key id</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">11.1.3 Message Log Encryption</h4><a id="1113-message-log-encryption" class="anchor" aria-label="Permalink: 11.1.3 Message Log Encryption" href="#1113-message-log-encryption"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The message bodies can be encrypted (<code>messagelog-encryption-enabled = true</code>) when stored to the database. By default, the encryption is disabled. Also, the encryption is fully transparent to all the external interfaces, e.g., the signed document download service. The encryption is symmetric, the used cipher is AES-CTR, and the encryption is performed using Java code.</p>
<p>In the message log database, there are two separate columns for plaintext (<code>message</code>) and encrypted (<code>ciphermessage</code>) message body. The message body is always stored in one of the two columns depending on the configuration. Instead, the other column that is not used is left empty. When message log database encryption is enabled/disabled, the change doesn't affect already existing records in the database. For example, when message log database encryption is enabled, all the records created after the configuration change will be encrypted and stored in the <code>ciphermessage</code> column. Instead, all the records stored before the change will remain in plaintext in the <code>message</code> column.</p>
<p>When encryption is switched on, the implementation expects to find the keystore in the location pointed by <code>messagelog-keystore</code>. The keystore should contain an encryption key with the identifier/alias specified in <code>messagelog-key-id</code>. The keystore password is specified in <code>messagelog-keystore-password</code>.</p>
<p>For example, add the following to <code>/etc/xroad/conf.d/local.ini</code>:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[message-log]</span>
<span class="pl-k">messagelog-encryption-enabled</span>=true
<span class="pl-k">messagelog-keystore</span>=/etc/xroad/messagelog/messagelog.p12
<span class="pl-k">messagelog-keystore-password</span>=somepassword
<span class="pl-k">messagelog-key-id</span>=key1</pre></div>
<p>Create the password store and import a key:</p>
<div class="highlight highlight-source-shell"><pre>keytool -keystore /etc/xroad/messagelog/messagelog.p12 -storetype pkcs12 -importpassword -alias key1</pre></div>
<p>Finally, restart <code>xroad-proxy</code> service.</p>
<p>To view the encrypted messages at some later stage, use the ASIC web service documented in [<a href="#Ref_UG-SIGDOC">UG-SIGDOC</a>]. The web service performs automatic decryption, where needed.</p>
<div class="markdown-heading"><h4 class="heading-element">11.1.4 Timestamping Parameters</h4><a id="1114-timestamping-parameters" class="anchor" aria-label="Permalink: 11.1.4 Timestamping Parameters" href="#1114-timestamping-parameters"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>
<p><code>timestamp-immediately</code> – if set to true, the timestamps are created synchronously with the message exchange, i.e., one timestamp is created for a request and another for a response. This is a security policy to guarantee the timestamp at the time of logging the message, but if the timestamping fails, the message exchange fails as well, and if load to the Security Server increases, then the load to the timestamping service increases as well. The value of this parameter defaults to false for better performance and availability. In case the value of the parameter is false then the timestamping is performed as a periodic background process (the time period is determined in the X-Road governing agency and propagated to the Security Servers by global configuration) and signatures stored during the time period (see parameter <code>timestamp-records-limit</code>) are timestamped in one batch.</p>
</li>
<li>
<p><code>timestamp-records-limit</code> – maximum number of signed messages that can be timestamped in one batch. The message exchanging load (messages per minute) and the timestamping interval of the Security Server must be taken into account when changing the default value of this parameter. Do not modify this parameter without a good reason. Defaults to <code>10000</code>.</p>
</li>
<li>
<p><code>acceptable-timestamp-failure-period</code> – time period in seconds, for how long the asynchronous timestamping is allowed to fail before message exchange between Security Servers is stopped. Set to <code>0</code> to disable this check. Defaults to <code>14400</code>.</p>
</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">11.1.5 Archiving Parameters</h4><a id="1115-archiving-parameters" class="anchor" aria-label="Permalink: 11.1.5 Archiving Parameters" href="#1115-archiving-parameters"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>
<code>keep-records-for</code> – time in days for which to keep timestamped and archived records in the database. Defaults to <code>30</code>.</li>
<li>
<code>archive-max-filesize</code> – maximum size for archived files in bytes. Reaching the maximum value triggers the file rotation. Defaults to <code>33554432</code> (32 MB).</li>
<li>
<code>archive-interval</code> – time interval as Cron expression [<a href="#Ref_CRON">CRON</a>] for archiving timestamped records. Defaults to <code>0 0 0/6 1/1 * ? *</code> (fire every 6 hours).</li>
<li>
<code>archive-path</code> – the directory where the timestamped log records are archived. Defaults to <code>/var/lib/xroad/</code>.</li>
<li>
<code>clean-interval</code> – time interval as Cron expression [<a href="#Ref_CRON">CRON</a>] for cleaning archived records from the database. Defaults to <code>0 0 0/12 1/1 * ? *</code> (fire every 12 hours).</li>
<li>
<code>archive-transfer-command</code> – the command executed after the (periodic) archiving process. This enables one to configure an external script to transfer archive files automatically from the Security Server. Defaults to no operation.</li>
<li>
<code>archive-grouping</code> - archive file grouping; <code>none</code> (default), by <code>member</code> or, by <code>subsystem</code>.</li>
<li>
<code>archive-encryption-enabled</code> - archive file encryption enabled: false (default) or true.</li>
<li>
<code>archive-gpg-home-directory</code> - GPG home directory for archive file signing and encryption keyring (default <code>/etc/xroad/gpghome</code>).</li>
<li>
<code>archive-encryption-keys-config</code> - Configuration file for member gpg keys.</li>
<li>
<code>archive-default-encryption-key</code> - Default archive encryption key id.</li>
</ol>
<div class="markdown-heading"><h4 class="heading-element">11.1.6 Archive Files</h4><a id="1116-archive-files" class="anchor" aria-label="Permalink: 11.1.6 Archive Files" href="#1116-archive-files"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Archive files (ZIP containers) are located in the directory specified by the configuration parameter <code>archive-path</code>. File names are in the format <code>mlog[-grouping]-X-Y-Z.zip[.gpg]</code>, where X is the timestamp (UTC time in the format <code>YYYYMMDDHHmmss</code>) of the first message log record, Y is the timestamp of the last message log record (records are processed in chronological order) and Z is the first 16 characters of the last linking info digest entry. If grouping is enabled, [-grouping] is a (possibly truncated and filename safe) member identifier. If encryption is enabled, the <code>[.gpg]</code> suffix is added. Creating archive files is deterministic -- given the same input (grouping, message records, previous archive linking info digest), the output (file name and contents) is the same after possible encryption is removed.</p>
<p>The most basic example of an archive file name when the encryption and grouping are switched off:</p>
<pre><code>mlog-20210901100858-20210901100905-95b1f27097524105.zip
</code></pre>
<p>When the archive encryption switched on:</p>
<pre><code>mlog-20210901101923-20210901101926-95b1f27097524105.zip.gpg
</code></pre>
<p>Switching on archive grouping by member produces the following:</p>
<pre><code>mlog-INSTANCE_CLASS_CODE-20210901102251-20210901102254-95b1f27097524105.zip.gpg
</code></pre>
<p>Finally, switching to archive grouping by subsystem gives:</p>
<pre><code>mlog-INSTANCE_CLASS_CODE_CONSUMERSUBSYSTEM-20210901102521-20210901102524-95b1f27097524105.zip.gpg
mlog-INSTANCE_CLASS_CODE_PROVIDERSUBSYSTEM-20210901102521-20210901102524-b1f27097524105ac.zip.gpg
</code></pre>
<div class="markdown-heading"><h4 class="heading-element">11.1.7 Archive Encryption and Grouping</h4><a id="1117-archive-encryption-and-grouping" class="anchor" aria-label="Permalink: 11.1.7 Archive Encryption and Grouping" href="#1117-archive-encryption-and-grouping"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Archive files can be encrypted (when <code>archive-encryption-enabled = true</code>) using GnuPG ("gpg") which implements the OpenPGP (RFC 4880) specification. Please see e.g. <a href="https://www.ietf.org/rfc/rfc4880.txt" rel="nofollow">RFC 4880</a> and <a href="https://gnupg.org/" rel="nofollow">GnuPG</a> for more infomation. The encryption is enabled/disabled on a Security Server level - it's not possible to enable/disable it for specific subsystems only.</p>
<p>By default, the produced archive files contain messages from all the Security Server's members, but it's possible to group the archives by member or by subsystem if needed. The grouping is controlled by the setting <code>archive-grouping</code>. The grouping is enabled/disabled on a Security Server level - it is either enabled or disabled for all the members and subsystems.</p>
<p>Message log archive encryption and grouping can be configured separately. For example, the archives can be encrypted but not grouped (or vice versa). By default, both features are disabled.</p>
<p>When encryption is enabled, the archiving process expects to find a GnuPG keyring containing the server signing keypair in <code>archive-gpg-home-directory</code> (by default <code>/etc/xroad/gpghome</code>). When the default value is used the server signing keypair is the same as the backup signing and encryption keypair. This keypair is used to sign the generated archive files, and as a fallback encryption key if no other keys are configured.</p>
<p>The <code>archive-default-encryption-key</code> can be used to override the default encryption key id, which is used when <code>archive-grouping</code> is <code>none</code> or no member gpg key is defined. Changing this parameter requires restarting the xroad-addon-messagelog service.</p>
<p>In case <code>archive-grouping</code> is <code>member</code> or <code>subsystem</code>, gpg keys defined in file <code>archive-encryption-keys-config</code> are used (if no key is defined for the member, the default encryption key is used). This file maps member identifiers to gpg key identifiers and has the following format:</p>
<pre><code># This is a comment (ignored)
# One mapping per line (leading, trailing, and around `=` white space is ignored)
&lt;member identifier&gt; = &lt;key id&gt;

# Escaping (applies only to the member identifier):
## Member: test/member=class/\=code
   test/member\=class/\\=code = ABCD....
## Member #42/CLASS/#123 has two keys:
   \#42/CLASS/\#123 = ABCD....
   \#42/CLASS/\#123 = EF12....
</code></pre>
<ul>
<li>There can be several mappings (keys) per member (one mapping per line)</li>
<li>Lines <em>starting with</em> <code>#</code> are ignored</li>
<li>Escaping special characters in the <em>member identifier</em> part:
<ul>
<li>
<code>=</code> is written as <code>\=</code> (a literal <code>\=</code> becomes <code>\\=</code>)</li>
<li>
<code>#</code> is written as <code>\#</code> (a literal <code>\#</code> becomes <code>\\#</code>)</li>
</ul>
</li>
</ul>
<p>Warning. The archiving process fails if a required key is not present in the gpg keyring. Therefore, it is important to verify that the mappings are correct.</p>
<p><strong>Configuration example</strong></p>
<p>Generate a keypair for encryption with defaults and no expiration and export the public key:</p>
<div class="highlight highlight-source-shell"><pre>gpg [--homedir <span class="pl-k">&lt;</span>member gpghome<span class="pl-k">&gt;</span>] --quick-generate-key INSTANCE/memberClass/memberCode default default never
gpg [--homedir <span class="pl-k">&lt;</span>member gpghome<span class="pl-k">&gt;</span>] --export INSTANCE/memberClass/memberCode <span class="pl-k">&gt;</span>INSTANCE-memberClass-memberCode.pgp</pre></div>
<p>Import the public key to the gpg keyring in <code>archive-gpg-home-directory</code> and take note of the key id.</p>
<div class="highlight highlight-source-shell"><pre>gpg --homedir <span class="pl-k">&lt;</span>archive-gpg-home-directory<span class="pl-k">&gt;</span> --import INSTANCE-memberClass-memberCode.pgp</pre></div>
<p>Edit the key and add ultimate trust.</p>
<div class="highlight highlight-source-shell"><pre>gpg --homedir <span class="pl-k">&lt;</span>archive-gpg-home-directory<span class="pl-k">&gt;</span> --edit-key <span class="pl-k">&lt;</span>key id<span class="pl-k">&gt;</span></pre></div>
<p>At the <code>gpg&gt;</code> prompt, type <code>trust</code>, then type <code>5</code> for ultimate trust, then <code>y</code> to confirm, then <code>quit</code>.</p>
<p>Add the mapping to <code>archive-encryption-keys-config</code> file (mappings can be edited without restarting X-Road services), e.g.:</p>
<div class="highlight highlight-source-shell"><pre>INSTANCE/memberClass/memberCode = 96F20FF6578A5EF90DFBA18D8C003019508B5637</pre></div>
<p>Add the mapping file location (<code>archive-encryption-keys-config</code>) and grouping level (<code>archive-grouping</code>) to <code>/etc/xroad/conf.d/local.ini</code> file (editing the file requires restarting X-Road services), e.g.:</p>
<div class="highlight highlight-source-shell"><pre>[message-log]
archive-encryption-enabled = <span class="pl-c1">true</span>
archive-grouping = member
archive-encryption-keys-config = /etc/xroad/messagelog/archive-encryption-mapping.ini</pre></div>
<p>To decrypt the encrypted archives, use the following syntax:</p>
<div class="highlight highlight-source-shell"><pre>gpg [--homedir <span class="pl-k">&lt;</span>gpghome<span class="pl-k">&gt;</span>] --decrypt <span class="pl-k">&lt;</span>archive name<span class="pl-k">&gt;</span> --output <span class="pl-k">&lt;</span>output file name<span class="pl-k">&gt;</span></pre></div>
<div class="markdown-heading"><h3 class="heading-element">11.2 Transferring the Archive Files from the Security Server</h3><a id="112-transferring-the-archive-files-from-the-security-server" class="anchor" aria-label="Permalink: 11.2 Transferring the Archive Files from the Security Server" href="#112-transferring-the-archive-files-from-the-security-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>In order to save hard disk space, it is recommended to transfer archive files periodically from the Security Server (manually or automatically) to an external location.</p>
<p>The message log package provides a helper script <code>/usr/share/xroad/scripts/archive-http-transporter.sh</code> for transferring archive files. This script uses the HTTP/HTTPS protocol (the POST method, the form name is file) to transfer archive files to an archiving server.</p>
<p>Usage of the script:</p>
<table>
<thead>
<tr>
<th>Options:</th>
<th> </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d, --dir DIR</code></td>
<td>Archive directory. Defaults to '/var/lib/xroad'</td>
</tr>
<tr>
<td><code>-r, --remove</code></td>
<td>Remove successfully transported files form the archive directory.</td>
</tr>
<tr>
<td><code>-k, --key KEY</code></td>
<td>Private key file name in PEM format (TLS). Defaults to '/etc/xroad/ssl/internal.key'</td>
</tr>
<tr>
<td><code>-c, --cert CERT</code></td>
<td>Client certificate file in PEM format (TLS). Defaults to '/etc/xroad/ssl/internal.crt'</td>
</tr>
<tr>
<td><code>-cacert FILE</code></td>
<td>CA certificate file to verify the peer (TLS). The file may contain multiple CA certificates. The certificate(s) must be in PEM format.</td>
</tr>
<tr>
<td><code>-h, --help</code></td>
<td>This help text.</td>
</tr>
</tbody>
</table>
<p>The archive file has been successfully transferred when the archiving server returns the HTTP status code <code>200</code>.</p>
<p>Override the configuration parameter archive-transfer-command (create or edit the file <code>etc/xroad/conf.d/local.ini</code>) to set up a transferring script. For example:</p>
<pre><code>[message-log]
archive-transfer-command=/usr/share/xroad/scripts/archive-http-transporter.sh -r http://my-archiving-server/cgi-bin/upload
</code></pre>
<p>The message log package contains the CGI script <code>/usr/share/doc/xroad-addon-messagelog/archive-server/demo-upload.pl</code> for a demo archiving server for the purpose of testing or development.</p>
<div class="markdown-heading"><h3 class="heading-element">11.3 Using a Remote Database</h3><a id="113-using-a-remote-database" class="anchor" aria-label="Permalink: 11.3 Using a Remote Database" href="#113-using-a-remote-database"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The message log database can be located outside of the Security Server. The following guide describes how to configure and populate a remote database schema for the message log. It is assumed that access to the database from the Security Server has been configured. For detailed information about the configuration of database connections, refer to [<a href="#Ref_JDBC">JDBC</a>].</p>
<ol>
<li>
<p>Create a database user at remote database host:</p>
<pre><code>postgres@db_host:~$ createuser -P messagelog_user
Enter password for new role: &lt;messagelog_password&gt;
Enter it again: &lt;messagelog_password&gt;
</code></pre>
</li>
<li>
<p>Create a database owned by the message log user at remote database host:</p>
<pre><code>postgres@db_host:~$ createdb messagelog_dbname -O messagelog_user -E UTF-8
</code></pre>
</li>
<li>
<p>Verify connectivity from Security Server to the remote database:</p>
<pre><code>user@security_server:~$ psql -h db_host -U messagelog_user messagelog_dbname
Password for user messagelog_user: &lt;messagelog_password&gt;
psql (9.3.9)
SSL connection (cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256)
Type "help" for help.
messagelog_dbname=&gt;
</code></pre>
</li>
<li>
<p>Stop xroad-proxy service for reconfiguration:</p>
<pre><code>root@security_server:~# service xroad-proxy stop
</code></pre>
</li>
<li>
<p>Configure the database connection parameters to achieve encrypted connections, in <code>/etc/xroad/db.properties</code>:</p>
<pre><code>messagelog.hibernate.jdbc.use_streams_for_binary = true
messagelog.hibernate.dialect = ee.ria.xroad.common.db.CustomPostgreSQLDialect
messagelog.hibernate.connection.driver_class = org.postgresql.Driver
messagelog.hibernate.connection.url = jdbc:postgresql://db_host:5432/messagelog_dbname?ssl=true&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory
messagelog.hibernate.connection.username = messagelog_user
messagelog.hibernate.connection.password = messagelog_password
</code></pre>
</li>
<li>
<p>Populate database schema by reinstalling messagelog addon package and start xroad-proxy</p>
<p>Ubuntu: <code>apt-get install --reinstall xroad-addon-messagelog</code><br>
RHEL: <code>yum reinstall xroad-addon-messagelog</code></p>
<p><code>service xroad-proxy start</code></p>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">12 Audit Log</h2><a id="12-audit-log" class="anchor" aria-label="Permalink: 12 Audit Log" href="#12-audit-log"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The Security Server keeps an audit log. The audit log events are generated by the user interface and the management REST API when the user changes the system's state or configuration. The user actions are logged regardless of whether the outcome was a success or a failure. The complete list of the audit log events is described in [<a href="#Ref_SPEC-AL">SPEC-AL</a>].</p>
<p>Actions that change the system state or configuration but are not carried out using the user interface or the management REST API are not logged (for example, X-Road software installation and upgrade, user creation and permission granting, and changing the configuration files).</p>
<p>An audit log record contains correlation-id, which can be used to link the record to other log messages about the same request.</p>
<p>An audit log record also contains:</p>
<ul>
<li>
<p>the description of the user action,</p>
</li>
<li>
<p>the date and time of the event,</p>
</li>
<li>
<p>the username of the user performing the action</p>
</li>
<li>
<p>the authentication type used for this request (Session, ApiKey or HttpBasicPam)</p>
<ul>
<li>
<code>Session</code> – session based authentication (web application)</li>
<li>
<code>ApiKey</code> - direct API call using API key authentication</li>
<li>
<code>HttpBasicPam</code> – HTTP basic authentication with PAM login (for api key management API operations)</li>
</ul>
</li>
<li>
<p>the API url for this request, and</p>
</li>
<li>
<p>the data related to the event.</p>
</li>
</ul>
<p>For example, registering a new client in the Security Server produces the following log record:</p>
<p><code>2020-06-03T11:00:51+00:00 my-security-server-host correlation-id: [24b47d04dc6e1c49] INFO  [X-Road Proxy Admin REST API] 2020-06-03T11:00:51.944Z - {"event":"Register client","user":"admin1","auth":"Session","url":"/api/v1/clients/LXD:GOV:M1:audit-test/register","data":{"clientIdentifier":{"xRoadInstance":"LXD","memberClass":"GOV","memberCode":"M1","subsystemCode":"audit-test","clientStatus":"registration in progress"}}}</code></p>
<p>The event is present in JSON [<a href="#Ref_JSON">JSON</a>] format, in order to ensure machine processability.
The field event represents the description of the event, the field user represents the user name of the performer, and the field data represents data related with the event.
Field auth represents the authentication type, and url represents the API url.
The failed action event record contains additional fields reason for the error message, and boolean warning to document whether failure was due to an unhandled warning.
For example:</p>
<p><code>2020-06-03T10:57:46+00:00 my-security-server-host correlation-id: [49458d51a0bbe9ed] INFO  [X-Road Proxy Admin REST API] 2020-06-03T10:57:46.417Z - {"event":"Log in to token failed","user":"admin1","reason":"org.niis.xroad.restapi.service.TokenService$PinIncorrectException: Signer.PinIncorrect: PIN incorrect","warning":false,"auth":"Session","url":"/api/v1/tokens/0/login","data":{"tokenId":"0","tokenSerialNumber":null,"tokenFriendlyName":"softToken-0"}}</code></p>
<p>By default, audit log is located in the file</p>
<pre><code>/var/log/xroad/audit.log
</code></pre>
<div class="markdown-heading"><h3 class="heading-element">12.1 Changing the Configuration of the Audit Log</h3><a id="121-changing-the-configuration-of-the-audit-log" class="anchor" aria-label="Permalink: 12.1 Changing the Configuration of the Audit Log" href="#121-changing-the-configuration-of-the-audit-log"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The X-Road software writes the audit log to the <em>syslog</em> (<em>rsyslog</em>) using UDP interface (default port is 514). Corresponding configuration is located in the file</p>
<pre><code>/etc/rsyslog.d/90-udp.conf
</code></pre>
<p>The audit log records are written with level INFO and facility LOCAL0. By default, log records of that level and facility are saved to the X-Road audit log file</p>
<pre><code>/var/log/xroad/audit.log
</code></pre>
<p>The default behavior can be changed by editing the <em>rsyslog</em> configuration file</p>
<pre><code>/etc/rsyslog.d/40-xroad.conf
</code></pre>
<p>Restart the <em>rsyslog</em> service to apply the changes made to the configuration file</p>
<pre><code>service rsyslog restart
</code></pre>
<p>The audit log is rotated monthly by <em>logrotate</em>. To configure the audit log rotation, edit the <em>logrotate</em> configuration file</p>
<pre><code>/etc/logrotate.d/xroad-proxy
</code></pre>
<div class="markdown-heading"><h3 class="heading-element">12.2 Archiving the Audit Log</h3><a id="122-archiving-the-audit-log" class="anchor" aria-label="Permalink: 12.2 Archiving the Audit Log" href="#122-archiving-the-audit-log"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>In order to save hard disk space and avoid loss of the audit log records during Security Server crash, it is recommended to archive the audit log files periodically to an external storage or a log server.</p>
<p>The X-Road software does not offer special tools for archiving the audit log. The <code>rsyslog</code> can be configured to redirect the audit log to an external location.</p>
<div class="markdown-heading"><h2 class="heading-element">13 Back up and restore</h2><a id="13-back-up-and-restore" class="anchor" aria-label="Permalink: 13 Back up and restore" href="#13-back-up-and-restore"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>It is possible to back up and later restore Security Server configuration. A backup archive file contains the
following configuration:</p>
<ul>
<li>copy of serverconf database</li>
<li>user modifiable configuration files</li>
<li>keys and certificates
<ul>
<li>Security Server's auth key and certificate</li>
<li>members' sign keys and certificates (that are stored in soft token)</li>
<li>Security Server's internal TLS key and certificate</li>
<li>Security Server's UI key and certificate</li>
</ul>
</li>
<li>database credentials</li>
</ul>
<p>Notice that starting from X-Road v7.0, the backup archive file no longer contains the local override file <code>/etc/xroad/services/local.conf</code>, but instead <code>/etc/xroad/services/local.properties</code> file will be included.</p>
<p><strong>N.B.</strong> Message log database encryption keys, and message log archives encryption and signing keys are included in the backups only if they are stored under the <code>/etc/xroad</code> directory. However, they should not be stored in the <code>/etc/xroad/gpghome</code> subdirectory since it is excluded from the backups.</p>
<p>Backups contain sensitive information that must be kept secret (for example, private keys and database credentials).
In other words, leaking this information could easily lead to full compromise of Security Server. Therefore, it is
highly recommended that backup archives are encrypted and stored securely. Should the information still leak for whatever
reason the Security Server should be considered as compromised and reinstalled from scratch.</p>
<p>Security server backups are signed and optionally encrypted. The GNU Privacy Guard [GnuPG] is used for encryption and signing.
Security server's backup encryption key is generated during Security Server initialisation. In addition to the
automatically generated backup encryption key, additional public keys can be used to encrypt backups.</p>
<div class="markdown-heading"><h3 class="heading-element">13.1 Back up and Restore in the User Interface</h3><a id="131-back-up-and-restore-in-the-user-interface" class="anchor" aria-label="Permalink: 13.1 Back up and Restore in the User Interface" href="#131-back-up-and-restore-in-the-user-interface"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-system-administrator">System Administrator</a></p>
<p>The backup and restore view can be accessed from the <strong>Navigation tabs</strong> by selecting <strong>Back Up and Restore</strong>.</p>
<p>To <strong>back up configuration</strong>, follow these steps.</p>
<ol>
<li>
<p>Navigate to <strong>SETTINGS</strong> tab and in the view that opens click <strong>BACKUP AND RESTORE</strong> tab.</p>
</li>
<li>
<p>Click <strong>BACK UP CONFIG.</strong></p>
</li>
<li>
<p>The configuration backup file appears in the list of configuration backup files.</p>
</li>
<li>
<p>To save the configuration backup file to the local file system, click <strong>DOWNLOAD</strong> on the configuration file's row.</p>
</li>
</ol>
<p>To <strong>restore configuration</strong>, follow these steps.</p>
<ol>
<li>
<p>Click <strong>Restore</strong> on the appropriate row in the list of configuration backup files and click <strong>YES</strong>.</p>
</li>
<li>
<p>A popup notification shows after the restore whether the restoring was successful or not.</p>
</li>
</ol>
<p>If something goes wrong while restoring the configuration it is possible to revert back to the old configuration.
Security Server stores so called pre-restore configuration automatically to <code>/var/lib/xroad/conf_prerestore_backup.tar</code>. Either move it to <code>/var/lib/xroad/backup/</code> folder and utilize the user interface to restore it or use the command line interaface described in the next chapter.</p>
<p>To <strong>delete a configuration backup file</strong>, click <strong>Delete</strong> on the appropriate row in the configuration backup file list and then click <strong>YES</strong>.</p>
<p>To <strong>upload a configuration backup file</strong> from the local file system to the Security Server, click <strong>UPLOAD BACKUP</strong>,
select a file and click <strong>YES</strong>. The uploaded configuration file appears in the list of configuration files. Bear in mind
that only files signed with current Security Server encryption key can be restored via user interface. All other archives
can be restored only from command line.</p>
<p>As long as original keypair is intact no additional steps are needed even when backup encryption is turned on.</p>
<div class="markdown-heading"><h3 class="heading-element">13.2 Restore from the Command Line</h3><a id="132-restore-from-the-command-line" class="anchor" aria-label="Permalink: 13.2 Restore from the Command Line" href="#132-restore-from-the-command-line"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To restore configuration from the command line, the following data must be available:</p>
<ul>
<li>The X-Road ID of the Security Server</li>
</ul>
<p>To find the X-Road ID of the Security Server, the following command can be used:</p>
<pre><code>cat /etc/xroad/gpghome/openpgp-revocs.d/&lt;file-name&gt;.rev | grep uid
</code></pre>
<p>It is expected that the restore command is run by the xroad user.</p>
<p>In order to restore configuration, the following command should be used:</p>
<pre><code>/usr/share/xroad/scripts/restore_xroad_proxy_configuration.sh \
-s &lt;Security Server ID&gt; -f &lt;path + filename&gt; [-P -N]
</code></pre>
<p>For example (all on one line):</p>
<pre><code>/usr/share/xroad/scripts/restore_xroad_proxy_configuration.sh \
-s AA/GOV/TS1OWNER/TS1 \
–f /var/lib/xroad/backup/conf_backup_20140703-110438.gpg
</code></pre>
<p>In case original backup encryption and signing key is lost additional parameters can be specified to skip decryption and/or
signature verification. Use <code>-P</code> command line switch when backup archive is already decrypted externally and <code>-N</code> switch to
skip checking archive signature.</p>
<p>If a backup is restored on a new uninitialized (the initial configuration hasn't been completed) Security Server, the
Security Server's gpg key must be manually created before restoring the backup:</p>
<pre><code>/usr/share/xroad/scripts/generate_gpg_keypair.sh /etc/xroad/gpghome &lt;Security Server ID&gt;
</code></pre>
<p>If it is absolutely necessary to restore the system from a backup made on a different Security Server, the forced mode
of the restore command can be used with the –F option together with unencrypted backup archive flags. For example (all on one line):</p>
<pre><code>/usr/share/xroad/scripts/restore_xroad_proxy_configuration.sh \
-F -P –f /var/lib/xroad/backup/conf_backup_20140703-110438.tar
</code></pre>
<p>In case backup archives were encrypted they have to be first unencrypted in external safe environment and then securely
transported to Security Server filesystem.</p>
<div class="markdown-heading"><h3 class="heading-element">13.3 Automatic Backups</h3><a id="133-automatic-backups" class="anchor" aria-label="Permalink: 13.3 Automatic Backups" href="#133-automatic-backups"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>By default the Security Server backs up its configuration automatically once every day. Backups older than 30 days are
automatically removed from the server. If needed, backup removal policies can be adjusted by editing the
<code>/etc/cron.d/xroad-proxy</code> file.</p>
<p>Automatic backup schedule can be adjusted  in the file <code>/etc/xroad/conf.d/local.ini</code>,
in the <code>[configuration-client]</code> section (add or edit this section).</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">proxy-configuration-backup-cron</span>=0 15 3 * * ?</pre></div>
<p><strong>Note:</strong> In cases where automatic backup is not required (ex: extensions which rely on configuration-client)
it is suggested to disable it by using cron expression that will never trigger. For example <code>* * * * * ? 2099</code></p>
<div class="markdown-heading"><h3 class="heading-element">13.4 Backup Encryption Configuration</h3><a id="134-backup-encryption-configuration" class="anchor" aria-label="Permalink: 13.4 Backup Encryption Configuration" href="#134-backup-encryption-configuration"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Backups are always signed, but backup encryption is initially turned off. To turn encryption on, please override the
default configuration in the file <code>/etc/xroad/conf.d/local.ini</code>, in the <code>[proxy]</code> section (add or edit this section).</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[proxy]</span>

<span class="pl-k">backup-encryption-enabled</span> = true
<span class="pl-k">backup-encryption-keyids</span> = &lt;keyid1&gt;, &lt;keyid2&gt;, ...</pre></div>
<p>To turn backup encryption on, change the <code>backup-encryption-enabled</code> property to true. Additional
encryption keys can be imported in the <code>/etc/xroad/gpghome</code> keyring and key identifiers listed using the <code>backup-encryption-keyids</code> parameter. It is recommended to set up at least one additional key, otherwise the backups will be unusable in case Security Servers private key is lost. It is up to Security Servers administrator to check that keys used are sufficiently strong, there are no automatic checks.</p>
<p>Warning. All keys listed in <code>backup-encryption-keyids</code> must be present in the gpg keyring or backup fails.</p>
<p>Additional keys for backup encryption should be generated and stored outside Security Server in a secure environment.
After gpg keypair has been generated, public key can be exported to a file (<a href="mailto:backupadmin@example.org">backupadmin@example.org</a> is the name of the
key being exported) using this command:</p>
<pre><code>gpg --output backupadmin.publickey --armor --export backupadmin@example.org
</code></pre>
<p>Resulting file <code>backupadmin.publickey</code> should be moved to Security Server and imported to backup gpg keyring. Administrator should make sure that the key has not been changed during transfer, for example by validating the key fingerprint.</p>
<p>Private keys corresponding to additional backup encryption public keys must be handled safely and kept in secret. Any of
them can be used to decrypt backups and thus mount attacks on the Security Servers.</p>
<p><strong>Configuration example</strong></p>
<p>Generate a keypair for encryption with defaults and no expiration and export the public key:</p>
<div class="highlight highlight-source-shell"><pre>gpg [--homedir <span class="pl-k">&lt;</span>admin gpghome<span class="pl-k">&gt;</span>] --quick-generate-key backupadmin@example.org default default never
gpg [--homedir <span class="pl-k">&lt;</span>admin gpghome<span class="pl-k">&gt;</span>] --export backupadmin@example.org <span class="pl-k">&gt;</span>backupadmin@example.org.pgp</pre></div>
<p>Import the public key to the gpg keyring in <code>/etc/xroad/gpghome</code> directory and take note of the key id.</p>
<div class="highlight highlight-source-shell"><pre>gpg --homedir /etc/xroad/gpghome --import backupadmin@example.org.pgp</pre></div>
<p>Edit the key and add ultimate trust.</p>
<div class="highlight highlight-source-shell"><pre>gpg --homedir /etc/xroad/gpghome/ --edit-key <span class="pl-k">&lt;</span>key id<span class="pl-k">&gt;</span></pre></div>
<p>At the <code>gpg&gt;</code> prompt, type <code>trust</code>, then type <code>5</code> for ultimate trust, then <code>y</code> to confirm, then <code>quit</code>.</p>
<p>Add the key id to <code>/etc/xroad/conf.d/local.ini</code> file (editing the file requires restarting X-Road services), e.g.:</p>
<div class="highlight highlight-source-shell"><pre>[proxy]
backup-encryption-enabled = <span class="pl-c1">true</span>
backup-encryption-keyids = 96F20FF6578A5EF90DFBA18D8C003019508B5637</pre></div>
<p>To decrypt the encrypted backups, use the following syntax:</p>
<div class="highlight highlight-source-shell"><pre>gpg --homedir /etc/xroad/gpghome --decrypt <span class="pl-k">&lt;</span>backup name<span class="pl-k">&gt;</span> --output <span class="pl-k">&lt;</span>output file name<span class="pl-k">&gt;</span> </pre></div>
<div class="markdown-heading"><h3 class="heading-element">13.5 Verifying Backup Archive Consistency</h3><a id="135-verifying-backup-archive-consistency" class="anchor" aria-label="Permalink: 13.5 Verifying Backup Archive Consistency" href="#135-verifying-backup-archive-consistency"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>During restore Security Server verifies consistency of backup archives automatically, archives are not checked during upload.
Also, it is possible to verify the consistency of the archives externally. For verifying the consistency externally,
Security Server's public key is needed. When backups are encrypted, then a private key for decrypting archive is also needed.
GPG uses "sign then encrypt" scheme, so it is not possible to verify encrypted archives without decrypting them.</p>
<p>Automatic backup verification is only possible when original Security Server keypair is available. Should keypair on the
Security Server be lost for whatever reason, automatic verification is no longer possible. Therefore, it is recommended
to export backup encryption public key and import it into separate secure environment. If backups are encrypted,
Security Server public key should be imported to keyrings holding additional encryption keys, so that backups can be
decrypted and verified in these separate environments.</p>
<p>To export Security Servers backup encryption public key use the following command:</p>
<pre><code>gpg --homedir /etc/xroad/gpghome --armor --output server-public-key.gpg --export &lt;instanceIdentifier&gt;/&lt;memberClass&gt;/&lt;memberCode&gt;/&lt;serverCode&gt;
</code></pre>
<p>where <code>&lt;instanceIdentifier&gt;/&lt;memberClass&gt;/&lt;memberCode&gt;/&lt;serverCode&gt;</code> is the Security Server id,
for example, <code>AA/GOV/TS1OWNER/TS1</code>.</p>
<p>Resulting file (<code>server-public-key.gpg</code>) should then be exported from Security Server and imported to GPG keystore used
for backup archive consistency verification.</p>
<div class="markdown-heading"><h2 class="heading-element">14 Diagnostics</h2><a id="14-diagnostics" class="anchor" aria-label="Permalink: 14 Diagnostics" href="#14-diagnostics"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-system-administrator">System Administrator</a></p>
<p>Click on <strong>DIAGNOSTICS</strong> in the <strong>Navigation tabs</strong>.</p>
<p>On the Diagnostics page you can view the status information of:</p>
<ul>
<li>Security Server services;
<ul>
<li>global configuration client;</li>
<li>timestamping operation;</li>
<li>downloading OCSP responses from the OCSP-responder;</li>
</ul>
</li>
<li>Security Server Java version;</li>
<li>Security Server encryption configuration;
<ul>
<li>backup encryption;</li>
<li>message log archive encryption and grouping;</li>
<li>message log database encryption.</li>
</ul>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">14.1 Examine Security Server services status information</h3><a id="141-examine-security-server-services-status-information" class="anchor" aria-label="Permalink: 14.1 Examine Security Server services status information" href="#141-examine-security-server-services-status-information"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Security server services status information covers the following services:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Status</th>
<th>Message</th>
<th>Previous Update</th>
<th>Next Update</th>
</tr>
</thead>
<tbody>
<tr>
<td>Global configuration</td>
<td>Green/yellow/red</td>
<td>Status message</td>
<td>The time of the global configuration client's last run</td>
<td>The estimated time of the global configuration client's next run</td>
</tr>
<tr>
<td>Timestamping</td>
<td>Green/yellow/red</td>
<td>Status message</td>
<td>The time of the last timestamping operation</td>
<td>Not used</td>
</tr>
<tr>
<td>OCSP-responders</td>
<td>Green/yellow/red</td>
<td>Status message</td>
<td>The time of the last contact with the OCSP-responder</td>
<td>The latest possible time for the next OCSP-refresh</td>
</tr>
</tbody>
</table>
<p>To refresh the service statuses, refresh the page.</p>
<p>The status colors indicate the following:</p>
<ul>
<li>
<strong>Red indicator</strong> – service cannot be contacted or is not operational</li>
<li>
<strong>Yellow indicator</strong> – service has been contacted but is yet to have been used to verify its status</li>
<li>
<strong>Green indicator</strong> – service has been successfully contacted and used to verify it is operational</li>
</ul>
<p>The status message offers more detailed information on the current status.</p>
<p>If a section of the diagnostics view appears empty, it means that there either is no configured service available or that checking the service status has failed. If sections are empty, try refreshing the diagnostics view or check the service configuration.</p>
<div class="markdown-heading"><h3 class="heading-element">14.2 Examine Security Server Java version information</h3><a id="142-examine-security-server-java-version-information" class="anchor" aria-label="Permalink: 14.2 Examine Security Server Java version information" href="#142-examine-security-server-java-version-information"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Security server Java version information provides the following details:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Status</td>
<td>Green/red</td>
</tr>
<tr>
<td>Message</td>
<td>Status message</td>
</tr>
<tr>
<td>Vendor name</td>
<td>Vendor name of Java that the Security Server is using</td>
</tr>
<tr>
<td>Java version</td>
<td>Java version number that the Security Server is using</td>
</tr>
<tr>
<td>Earliest supported version</td>
<td>Earliest supported Java version number</td>
</tr>
<tr>
<td>Latest supported version</td>
<td>Latest supported Java version number</td>
</tr>
</tbody>
</table>
<p>To refresh the status, refresh the page.</p>
<p>The status colors indicate the following:</p>
<ul>
<li>
<strong>Red indicator</strong> – Security Server's java version number isn't supported</li>
<li>
<strong>Green indicator</strong> – Security Server's java version number is supported</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">14.3 Examine Security Server encryption status information</h3><a id="143-examine-security-server-encryption-status-information" class="anchor" aria-label="Permalink: 14.3 Examine Security Server encryption status information" href="#143-examine-security-server-encryption-status-information"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Backup encryption status</strong></p>
<p>The status shows is the backup encryption <code>enabled</code> or <code>disabled</code>. The Configured key ID list contains all the additional encryption keys that are present in the configuration. If the list is empty, only the system generated default encryption key is used. When the backup encryption is <code>disabled</code>, the list is always empty.</p>
<p>The status colors indicate the following:</p>
<ul>
<li>
<strong>Red indicator</strong> – there's an error with checking the backup encryption status</li>
<li>
<strong>Yellow indicator</strong> – backup encryption is disabled</li>
<li>
<strong>Green indicator</strong> – backup encryption is enabled</li>
</ul>
<p><strong>Message log archive encryption status</strong></p>
<p>The status shows is the message log archive encryption <code>enabled</code> or <code>disabled</code>. The Grouping rule shows the grouping level (<code>NONE</code>, <code>MEMBER</code>, <code>SUBSYSTEM</code>) of the message log archives.</p>
<p>The list of Member Identifier / Key ID pairs includes a list of members using the Security Server and the encryption key(s) associated with the member when the grouping level is <code>MEMBER</code> or <code>SUBSYSTEM</code>. When the grouping level is <code>NONE</code>, the list is always empty. If no member-specific key is associated with a member, there's a warning icon in the Key ID column. If the Key ID is missing and there's only the warning icon in the Key ID column, the member is using the system generated default encryption key. Instead, if the warning icon is after the Key ID, the member is using the user generated default encryption key (defined using the <code>archive-default-encryption-key</code> property). It's strongly recommended to use user generated member-specific encryption keys.</p>
<p>Each member can have multiple member-specific encryption keys configured. If multiple keys are configured for a single member, the key IDs are presented as a comma separated list.</p>
<p>The status colors indicate the following:</p>
<ul>
<li>
<strong>Red indicator</strong> – there's an error with checking the message log archive encryption status</li>
<li>
<strong>Yellow indicator</strong> – message log archive encryption is disabled</li>
<li>
<strong>Green indicator</strong> – message log archive encryption is enabled</li>
<li>
</li></ul>
<p><strong>Message log database encryption status</strong></p>
<p>The status shows is the message log database encryption <code>enabled</code> or <code>disabled</code>.</p>
<p>The status colors indicate the following:</p>
<ul>
<li>
<strong>Red indicator</strong> – there's an error with checking the message log database encryption status</li>
<li>
<strong>Yellow indicator</strong> – message log database encryption is disabled</li>
<li>
<strong>Green indicator</strong> – message log database encryption is enabled</li>
</ul>
<div class="markdown-heading"><h2 class="heading-element">15 Operational Monitoring</h2><a id="15-operational-monitoring" class="anchor" aria-label="Permalink: 15 Operational Monitoring" href="#15-operational-monitoring"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Operational monitoring data</strong> contains data about request exchange (such as the ID-s of the client and the service, various attributes of the message read from the message header, request and response timestamps, SOAP sizes etc.) of the X-Road Security Server(s).</p>
<p><strong>The operational monitoring daemon</strong> collects and shares operational monitoring data of the X-Road Security Server(s) as part of request exchange, shares this data, calculates and shares health statistics (the timestamps and number of successful/unsuccessful requests, various metrics of the duration and the SOAP message size of the requests, etc.). The data fields that are stored and shared are described in [<a href="#Ref_PR-OPMON">PR-OPMON</a>].</p>
<p>The Security Server caches operational monitoring data in the <strong>operational monitoring buffer</strong>. One operational data record is created for each request during the message exchange. Security server forwards operational data cached in the operational monitoring buffer to the operational monitoring daemon. Successfully forwarded records are removed from the operational monitoring buffer.</p>
<p>The operational monitoring daemon makes operational and health data available to the owner of the Security Server, regular clients and the central monitoring client via the Security Server. Local health data are available for external monitoring systems (e.g. Zabbix) over the JMXMP interface described in [<a href="#Ref_PR-OPMONJMX">PR-OPMONJMX</a>].</p>
<p>The owner of the Security Server and the central monitoring client are able to query the records of all clients. For a regular client, only the records associated with that client are available. The internal IP of the Security Server is included in the response only for the owner of the Security Server and central monitoring client.</p>
<p><strong>NOTE:</strong> All the commands in the following sections must be carried out using root permissions.</p>
<div class="markdown-heading"><h3 class="heading-element">15.1 Operational Monitoring Buffer</h3><a id="151-operational-monitoring-buffer" class="anchor" aria-label="Permalink: 15.1 Operational Monitoring Buffer" href="#151-operational-monitoring-buffer"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>In general, the operational monitoring buffer is an internal component of the Security Server and thus being not directly used by the end user.</p>
<p>The configuration parameters available for configuring the operational monitoring buffer have been documented in [<a href="#Ref_UG-OPMONSYSPAR">UG-OPMONSYSPAR</a>].</p>
<p>The default values of the parameters have been chosen to be sufficient under expected average load using the minimum hardware recommended.</p>
<p>All overrides to the default configuration values must be made in the file <code>/etc/xroad/conf.d/local.ini</code>, in the <code>[op-monitor-buffer]</code> section.</p>
<div class="markdown-heading"><h4 class="heading-element">15.1.1 Stopping the Collecting of Operational Data</h4><a id="1511-stopping-the-collecting-of-operational-data" class="anchor" aria-label="Permalink: 15.1.1 Stopping the Collecting of Operational Data" href="#1511-stopping-the-collecting-of-operational-data"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>If, for any reason, operational data should not be collected and forwarded to the operational monitoring daemon, the parameter size can be set to 0:</p>
<pre><code>[op-monitor-buffer]
size = 0
</code></pre>
<p>After the configuration change, the xroad-proxy service must be restarted:</p>
<pre><code>service xroad-proxy restart
</code></pre>
<p>In addition, the operational monitoring daemon should be stopped:</p>
<pre><code>service xroad-opmonitor stop
</code></pre>
<p>For the service to stay stopped after reboot the following command should be run:</p>
<pre><code>echo manual &gt; /etc/init/xroad-opmonitor.override
</code></pre>
<div class="markdown-heading"><h3 class="heading-element">15.2 Operational Monitoring Daemon</h3><a id="152-operational-monitoring-daemon" class="anchor" aria-label="Permalink: 15.2 Operational Monitoring Daemon" href="#152-operational-monitoring-daemon"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The configuration parameters available for configuring the operational monitoring daemon have been documented in [<a href="#Ref_UG-OPMONSYSPAR">UG-OPMONSYSPAR</a>].</p>
<p>Similarly to the operational monitoring buffer, the default values of the parameters have been chosen to be sufficient under expected average load using the minimum recommended hardware.</p>
<p>All overrides to the default configuration values must be made in the file <code>/etc/xroad/conf.d/local.ini</code>, in the <code>[op-monitor]</code> section.</p>
<p>In the following sections, some parameters are described which may be required to be changed more likely.</p>
<div class="markdown-heading"><h4 class="heading-element">15.2.1 Configuring the Health Statistics Period</h4><a id="1521-configuring-the-health-statistics-period" class="anchor" aria-label="Permalink: 15.2.1 Configuring the Health Statistics Period" href="#1521-configuring-the-health-statistics-period"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>By default, health statistics are provided for a period of 600 seconds (10 minutes). This means that if no request exchange has taken place for 10 minutes, all the statistical metrics are reset. Please refer to [<a href="#Ref_PR-OPMON">PR-OPMON</a>] for a detailed overview of the health metrics available.</p>
<p>To change the health statistics period, the value of the parameter health-statistics-period-seconds should be set or edited in the <code>[op-monitor]</code>
section of the file <code>/etc/xroad/conf.d/local.ini</code>.</p>
<div class="markdown-heading"><h4 class="heading-element">15.2.2 Configuring the Parameters Related to Database Cleanup</h4><a id="1522-configuring-the-parameters-related-to-database-cleanup" class="anchor" aria-label="Permalink: 15.2.2 Configuring the Parameters Related to Database Cleanup" href="#1522-configuring-the-parameters-related-to-database-cleanup"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Depending on the load and resources of the system, it may be necessary to change the interval of the removal of old database records.</p>
<p>The following parameters must be placed in the <code>[op-monitor]</code> section of the file <code>/etc/xroad/conf.d/local.ini</code>.</p>
<p>The parameter <code>keep-records-for-days</code> should be edited, for instance if the disk fills up before cleanup occurs, or alternatively, if the default period of 7 days is too short. The parameter <code>clean-interval</code> (a Cron expression [<a href="#Ref_CRON">CRON</a>]) defines how often the system checks whether cleanup should be done. If the default period of 12 hours is too long or short it should be edited according to your needs.</p>
<div class="markdown-heading"><h4 class="heading-element">15.2.3 Configuring the Parameters related to the HTTP Endpoint of the Operational Monitoring Daemon</h4><a id="1523-configuring-the-parameters-related-to-the-http-endpoint-of-the-operational-monitoring-daemon" class="anchor" aria-label="Permalink: 15.2.3 Configuring the Parameters related to the HTTP Endpoint of the Operational Monitoring Daemon" href="#1523-configuring-the-parameters-related-to-the-http-endpoint-of-the-operational-monitoring-daemon"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>For configuring the endpoint of the operational monitoring daemon, the following parameters are available in the <code>[op-monitor]</code> section of the configuration:</p>
<p><strong>host</strong> – listening host of the daemon (by default the value is set to <em>localhost</em>).</p>
<p><strong>port</strong> – listening port (by default the value is set to <em>2080</em>).</p>
<p><strong>scheme</strong> – connection type (by default the value is set to <em>HTTP</em>).</p>
<p>If any of these values are changed, both the proxy and the operational monitoring daemon services must be restarted:</p>
<pre><code>service xroad-proxy restart
service xroad-opmonitor restart
</code></pre>
<div class="markdown-heading"><h4 class="heading-element">15.2.4 Installing an External Operational Monitoring Daemon</h4><a id="1524-installing-an-external-operational-monitoring-daemon" class="anchor" aria-label="Permalink: 15.2.4 Installing an External Operational Monitoring Daemon" href="#1524-installing-an-external-operational-monitoring-daemon"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Technically, the operational monitoring daemon can be installed on a separate host from the Security Server. It is possible to configure several Security Servers to use that external operational monitoring daemon, but this setup is correct <em>only</em> if the Security Servers are identical clones installed behind a load balancer.</p>
<p><strong>NOTE:</strong> The setup of clustered Security Servers is not officially supported yet and has been implemented for future compatibility.</p>
<p><strong>NOTE:</strong> It is <strong>strongly advised</strong> to use HTTPS for requests between a Security Server and the associated external operational monitoring daemon.</p>
<p>For running a separate operational monitoring daemon, the xroad-opmonitor package must be installed. Please refer to [<a href="#Ref_IG-SS">IG-SS</a>] for general instructions on obtaining X-Road packages.</p>
<p>As a result of installation, the following services will be running:</p>
<pre><code>xroad-confclient
xroad-signer
xroad-opmonitor
</code></pre>
<div class="markdown-heading"><h4 class="heading-element">15.2.5 Configuring an External Operational Monitoring Daemon and the Corresponding Security Server</h4><a id="1525-configuring-an-external-operational-monitoring-daemon-and-the-corresponding-security-server" class="anchor" aria-label="Permalink: 15.2.5 Configuring an External Operational Monitoring Daemon and the Corresponding Security Server" href="#1525-configuring-an-external-operational-monitoring-daemon-and-the-corresponding-security-server"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>To make a Security Server communicate with an external operational monitoring daemon, it is necessary to configure both the daemon and the Security Server.</p>
<p>By default, the operational monitoring daemon listens on localhost. To make the daemon available to Security Servers on other hosts, the listening address must be set to the IP address that is relevant in the particular network, as described in the previous section.</p>
<p>As advised, the scheme parameter should be set to "https". For communication over HTTPS, the Security Server and the operational monitoring daemon must know each other's TLS certificates to enable the Security Server to authenticate to the monitoring daemon successfully.</p>
<p><strong>NOTE:</strong> If an external operational monitoring daemon is used, the host, scheme (and optionally, port) parameters must be changed at both hosts.</p>
<p>The internal TLS certificate of the Security Server is used for authenticating the Security Server to the operational monitoring daemon. This certificate has been generated beforehand, during the installation process of the Security Server, and is available in PEM format in the file <code>/etc/xroad/ssl/internal.crt</code>. Please refer to Section <a href="#104-changing-the-internal-tls-key-and-certificate">10.4</a> for the instructions on exporting the internal TLS certificate from UI. The file must be copied to the host running the operational monitoring daemon. The system user xroad must have permissions to read this file.</p>
<p>In the configuration of the external daemon, the corresponding path must be set in <code>/etc/xroad/conf.d/local.ini</code>:</p>
<pre><code>[op-monitor]
client-tls-certificate = &lt;path/to/security/server/internal/cert&gt;
</code></pre>
<p>Next, a TLS key and the corresponding certificate must be generated on the host of the external monitoring daemon as well, using the command</p>
<pre><code>generate-opmonitor-certificate
</code></pre>
<p>The script will prompt you for standard fields for input to TLS certificates and its output (key files and the certificate) will be generated to the directory <code>/etc/xroad/ssl</code>.</p>
<p>The generated certificate, in the file <code>opmonitor.crt</code>, must be copied to the corresponding Security Server. The system user <code>xroad</code> must have permissions to read this file. Its path at the Security Server must be written to the configuration (note the name of the section, although it is the proxy service that will read the configuration):</p>
<pre><code>[op-monitor]
tls-certificate = &lt;path/to/external/daemon/tls/cert&gt;
</code></pre>
<p>For the external operational daemon to be used, the proxy service at the Security Server must be restarted:</p>
<pre><code>service xroad-proxy restart
</code></pre>
<p>In addition, on the host running the corresponding Security Server, the operational monitoring daemon must be stopped:</p>
<pre><code>service xroad-opmonitor stop
</code></pre>
<p>For the service to stay stopped after reboot the following command should be run:</p>
<pre><code>echo manual &gt; /etc/init/xroad-opmonitor.override
</code></pre>
<p>The configuration anchor (renamed as <code>configuration-anchor.xml</code>) file must be manually copied into the directory <code>/etc/xroad</code> of the external monitoring daemon in order for configuration client to be able to download the global configuration (by default configuration download interval is 60 seconds). The system user xroad must have permissions to read this file.</p>
<div class="markdown-heading"><h4 class="heading-element">15.2.6 Monitoring Health Data over JMXMP</h4><a id="1526-monitoring-health-data-over-jmxmp" class="anchor" aria-label="Permalink: 15.2.6 Monitoring Health Data over JMXMP" href="#1526-monitoring-health-data-over-jmxmp"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The operational monitoring daemon makes health data available over the JMXMP protocol. The Zabbix monitoring software can be configured to gather that data periodically, using its built in JMX interface type.</p>
<p>By default, the operational monitoring daemon JMXMP is disabled. JMXMP must be enabled for external tools such as Zabbix to be able to access the data. Please refer to the documentation at [<a href="#Ref_JMX">JMX</a>] for instructions on configuring access to the JMX interface of the operational monitoring daemon.</p>
<p>For Zabbix to be able to gather data over JMX, the Zabbix Java gateway must be installed. See [<a href="#Ref_ZABBIX-GATEWAY">ZABBIX-GATEWAY</a>] for instructions.</p>
<p>The JMX interface must be configured to each host item in Zabbix, for which health data needs to be obtained. See [<a href="#Ref_ZABBIX-JMX">ZABBIX-JMX</a>] for instructions.</p>
<p>Please refer to [<a href="#Ref_PR-OPMONJMX">PR-OPMONJMX</a>] for a specification of the names and attributes of the JMX objects exposed by the operational monitoring daemon.</p>
<p>The xroad-opmonitor package comes with sample host data that can be imported to Zabbix, containing a JMX interface, applications related to sample services and health data items under these services. Also, a script is provided for importing health data related applications and items to several hosts using the Zabbix API. Please find the example files in the directory <code>/usr/share/doc/xroad-opmonitor/examples/zabbix/</code>. Please refer to [<a href="#Ref_ZABBIX-API">ZABBIX-API</a>] for information on the Zabbix API.</p>
<div class="markdown-heading"><h2 class="heading-element">16 Environmental Monitoring</h2><a id="16-environmental-monitoring" class="anchor" aria-label="Permalink: 16 Environmental Monitoring" href="#16-environmental-monitoring"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Environmental monitoring provides details of the Security Servers such as operating system, memory, disk space, CPU load, running processes and installed packages, etc.</p>
<div class="markdown-heading"><h3 class="heading-element">16.1 Usage via SOAP API</h3><a id="161-usage-via-soap-api" class="anchor" aria-label="Permalink: 16.1 Usage via SOAP API" href="#161-usage-via-soap-api"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Environmental monitoring provides SOAP API via X-Road message protocol extension. SOAP messages are described in [<a href="#Ref_PR-ENVMONMES">PR-ENVMONMES</a>].</p>
<p>Monitoring extension schema is defined in [<a href="#Ref_MONITORING_XSD">MONITORING_XSD</a>].</p>
<div class="markdown-heading"><h3 class="heading-element">16.2 Usage via JMX API</h3><a id="162-usage-via-jmx-api" class="anchor" aria-label="Permalink: 16.2 Usage via JMX API" href="#162-usage-via-jmx-api"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Environmental monitoring provides also a standard JMX endpoint which can be accessed with any JMX client (for example Java's jconsole application). See [<a href="#Ref_ARC-ENVMON">ARC-ENVMON</a>] for details.</p>
<p>JMX is disabled on default. JMX is enabled by adding standard JMX-related options to the executable java process as in example by [<a href="#Ref_ZABBIX-JMX">ZABBIX-JMX</a>].</p>
<div class="markdown-heading"><h3 class="heading-element">16.3 Limiting environmental monitoring remote data set</h3><a id="163-limiting-environmental-monitoring-remote-data-set" class="anchor" aria-label="Permalink: 16.3 Limiting environmental monitoring remote data set" href="#163-limiting-environmental-monitoring-remote-data-set"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>It is possibility to limit what allowed non-owners can request via environmental monotiring data request by changing monitor-env limit-remote-data-set parameter. By changing flag to be true non-owners who are allowed to query environmental monitoring data will get only certificate, operating system and xroad version information. This parameters is set by default false. Security server owner will always get full data set as requested.</p>
<div class="markdown-heading"><h2 class="heading-element">17 Logs and System Services</h2><a id="17-logs-and-system-services" class="anchor" aria-label="Permalink: 17 Logs and System Services" href="#17-logs-and-system-services"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>To read logs</strong>, a user must have root user's rights or belong to the <code>xroad</code> and/or <code>adm</code> system group.</p>
<div class="markdown-heading"><h3 class="heading-element">17.1 System Services</h3><a id="171-system-services" class="anchor" aria-label="Permalink: 17.1 System Services" href="#171-system-services"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The most important system services of a Security Server are as follows.</p>
<table>
<thead>
<tr>
<th><strong>Service</strong></th>
<th><strong>Purpose</strong></th>
<th><strong>Log</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>xroad-addon-messagelog</code></td>
<td>Message log archiving and cleaning of the message logs</td>
<td><code>/var/log/xroad/messagelog-archiver.log</code></td>
</tr>
<tr>
<td><code>xroad-confclient</code></td>
<td>Client process for the global configuration distributor</td>
<td><code>/var/log/xroad/configuration_client.log</code></td>
</tr>
<tr>
<td><code>xroad-proxy</code></td>
<td>Message exchanger</td>
<td><code>/var/log/xroad/proxy.log</code></td>
</tr>
<tr>
<td><code>xroad-signer</code></td>
<td>Manager process for key settings</td>
<td><code>/var/log/xroad/signer.log</code></td>
</tr>
<tr>
<td><code>xroad-proxy-ui-api</code></td>
<td>Management UI and REST API</td>
<td>
<code>/var/log/xroad/proxy_ui_api.log</code> and <br><code>/var/log/xroad/proxy_ui_api_access.log</code>
</td>
</tr>
<tr>
<td><code>xroad-monitor</code></td>
<td>Environmental monitoring</td>
<td><code>/var/log/xroad/monitor.log</code></td>
</tr>
<tr>
<td><code>xroad-opmonitor</code></td>
<td>Operational monitoring</td>
<td><code>/var/log/xroad/op-monitor.log</code></td>
</tr>
</tbody>
</table>
<p>System services are managed through the <em>systemd</em> facility.</p>
<p><strong>To start a service</strong>, issue the following command as a <code>root</code> user:</p>
<pre><code>service &lt;service&gt; start
</code></pre>
<p><strong>To stop a service</strong>, enter:</p>
<pre><code>service &lt;service&gt; stop
</code></pre>
<p>Services use the <a href="https://www.freedesktop.org/software/systemd/man/systemd-system.conf.html#DefaultStartLimitIntervalSec=" rel="nofollow">default unit start rate limits</a>.
An exception to this is <code>xroad-proxy-ui-api</code>, which uses a longer start rate limit (<a href="https://github.com/nordic-institute/X-Road/blob/master/src/packages/src/xroad/ubuntu/generic/xroad-proxy-ui-api.service#L5-6">5 starts / 40 seconds</a>)
to prevent infinite restart-loop in some specific error situations.</p>
<div class="markdown-heading"><h3 class="heading-element">17.2 Logging configuration</h3><a id="172-logging-configuration" class="anchor" aria-label="Permalink: 17.2 Logging configuration" href="#172-logging-configuration"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>For logging, the <strong>Logback</strong> system is used. Logback configuration files are stored in the directory <code>/etc/xroad/conf.d/</code>.</p>
<p>Default settings for logging are the following:</p>
<ul>
<li>
<p>logging level: INFO;</p>
</li>
<li>
<p>rolling policy: whenever the file size reaches 100 MB.</p>
</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">17.3 Fault Detail UUID</h3><a id="173-fault-detail-uuid" class="anchor" aria-label="Permalink: 17.3 Fault Detail UUID" href="#173-fault-detail-uuid"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>In case a Security Server encounters an error condition during the message exchange, the Security Server returns a SOAP Fault message [<a href="#Ref_PR-MESS">PR-MESS</a>] containing a UUID (a universally unique identifier, e.g. <code>1328e974-4fe5-412c-a4c4-f1ac36f20b14</code>) as the fault detail to the service client's information system. The UUID can be used to find the details of the occurred error from the <code>xroad-proxy</code> log.</p>
<div class="markdown-heading"><h2 class="heading-element">18 Federation</h2><a id="18-federation" class="anchor" aria-label="Permalink: 18 Federation" href="#18-federation"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Federation allows Security Servers of two different X-Road instances to exchange messages with each other. The instances
are federated at the Central Server level. After this, Security Servers can be configured to opt-in to the federation.
By default, federation is disabled and configuration data for other X-Road instances will not be downloaded.</p>
<p>The federation can be allowed for all X-Road instances that the Central Server offers, or a list of specific
(comma-separated) instances. The default is to allow none. The values are case-insensitive.</p>
<p>To override the default value, edit the file <code>/etc/xroad/conf.d/local.ini</code> and add or change the value of the system
parameter <code>allowed-federations</code> for the server component <code>configuration-client</code>. To restore the default, either remove
the system parameter entirely or set the value to <code>none</code>. X-Road services <code>xroad-confclient</code> and <code>xroad-proxy</code> need to
be restarted (in that order) for any setting changes to take effect.</p>
<p>Below are some examples for <code>/etc/xroad/conf.d/local.ini</code>.</p>
<p>To allow federation with all offered X-Road instances:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">allowed-federations</span>=all</pre></div>
<p>To allow federation with specific instances <code>xe-test</code> and <code>ee-test</code>:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">allowed-federations</span>=xe-test,ee-test</pre></div>
<p>To disable federation, just remove the <code>allowed-federations</code> system parameter entirely or use:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">allowed-federations</span>=none</pre></div>
<p>Please note that if the keyword <code>all</code> is present in the comma-separated list, it will override the single allowed
instances. The keyword <code>none</code> will override all other values. This means that the following setting will allow all
federations:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">allowed-federations</span>=xe-test, all, ee-test</pre></div>
<p>And the following will allow none:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[configuration-client]</span>
<span class="pl-k">allowed-federations</span>=xe-test, all, none, ee-test</pre></div>
<div class="markdown-heading"><h2 class="heading-element">19 Management REST API</h2><a id="19-management-rest-api" class="anchor" aria-label="Permalink: 19 Management REST API" href="#19-management-rest-api"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Security server has a REST API that can be used to do all the same server configuration operations that can be done
using the web UI.</p>
<p>Management REST API is protected with an API key based authentication. To execute REST calls, API keys need to be created.</p>
<p>REST API is protected by TLS. Since server uses self signed certificate, the caller needs to accept this (for example
with <code>curl</code> you might use <code>--insecure</code> or <code>-k</code> option).</p>
<p>Requests sent to REST API have a <em>limit for maximum size</em>. If a too large request is sent
to REST API, it will not be processed, and http status 413 Payload too large will be returned.
There is a different limit for binary file uploads, and for other requests.</p>
<p>Limits are</p>
<ul>
<li>10MB for file uploads</li>
<li>50KB for other requests</li>
</ul>
<p>REST API is also <em>rate limited</em>. Rate limits apply per each calling IP. If the number of calls
from one IP address exceeds the limit, endpoints return http status 429 Too Many Requests.</p>
<p>Limits are</p>
<ul>
<li>600 requests per minute</li>
<li>20 requests per second</li>
</ul>
<p>If the default limits are too restricting (or too loose), they can be overridden with <a href="ug-syspar_x-road_v6_system_parameters.html#39-management-rest-api-parameters-proxy-ui-api">proxy-ui-api</a> parameters:</p>
<ul>
<li><code>request-sizelimit-regular</code></li>
<li><code>request-sizelimit-binary-upload</code></li>
<li><code>rate-limit-requests-per-second</code></li>
<li><code>rate-limit-requests-per-minute</code></li>
</ul>
<p>Size limit parameters support formats from Formats from <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/unit/DataSize.html" rel="nofollow">DataSize</a>,
for example <code>5MB</code>.</p>
<div class="markdown-heading"><h3 class="heading-element">19.1 API key management operations</h3><a id="191-api-key-management-operations" class="anchor" aria-label="Permalink: 19.1 API key management operations" href="#191-api-key-management-operations"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> <a href="#xroad-system-administrator">System Administrator</a></p>
<p>An API key is linked to a role or roles, and grants access to the operations that are allowed for that role/roles.
Separate REST endpoints exist for API key management.
API key management endpoints are authenticated to with <a href="https://en.wikipedia.org/wiki/Basic_access_authentication" rel="nofollow">HTTP basic authentication</a> (username and password)
or with session authentication (for admin web application).
Basic authentication access is limited to localhost by default, but this can
be changed using System Parameters [<a href="#Ref_UG-SYSPAR">UG-SYSPAR</a>].</p>
<div class="markdown-heading"><h4 class="heading-element">19.1.1 Creating new API keys</h4><a id="1911-creating-new-api-keys" class="anchor" aria-label="Permalink: 19.1.1 Creating new API keys" href="#1911-creating-new-api-keys"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>A new API key is created with a <code>POST</code> request to <code>/api/v1/api-keys</code>. Message body must contain the roles to be
associated with the key. Server responds with data that contains the actual API key. After this point the key
cannot be retrieved, as it is not stored in plaintext.</p>
<div class="highlight highlight-source-shell"><pre>curl -X POST -u <span class="pl-k">&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>password<span class="pl-k">&gt;</span> https://localhost:4000/api/v1/api-keys --data <span class="pl-s"><span class="pl-pds">'</span>["XROAD_SECURITYSERVER_OBSERVER","XROAD_REGISTRATION_OFFICER"]<span class="pl-pds">'</span></span> --header <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/json<span class="pl-pds">"</span></span> -k
{
  <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>: [
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_REGISTRATION_OFFICER<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_SECURITYSERVER_OBSERVER<span class="pl-pds">"</span></span>
  ],
  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 61,
  <span class="pl-s"><span class="pl-pds">"</span>key<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>23bc57cd-b1ba-4702-9657-8d53e335c843<span class="pl-pds">"</span></span>
}
</pre></div>
<p>In this example the created key was <code>23bc57cd-b1ba-4702-9657-8d53e335c843</code>.</p>
<div class="markdown-heading"><h4 class="heading-element">19.1.2 Listing API keys</h4><a id="1912-listing-api-keys" class="anchor" aria-label="Permalink: 19.1.2 Listing API keys" href="#1912-listing-api-keys"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Existing API keys can be listed with a <code>GET</code> request to <code>/api/v1/api-keys</code>. This lists all keys, regardless of who has created them.</p>
<div class="highlight highlight-source-shell"><pre>curl -X GET -u <span class="pl-k">&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>password<span class="pl-k">&gt;</span> https://localhost:4000/api/v1/api-keys -k
[
  {
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 59,
    <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>: [
      <span class="pl-s"><span class="pl-pds">"</span>XROAD_REGISTRATION_OFFICER<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>XROAD_SECURITYSERVER_OBSERVER<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>XROAD_SERVICE_ADMINISTRATOR<span class="pl-pds">"</span></span>
    ]
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 60,
...
</pre></div>
<p>You can also retrieve a single API key with a <code>GET</code> request to <code>/api/v1/api-keys/{id}</code>.</p>
<div class="highlight highlight-source-shell"><pre>curl -X GET -u <span class="pl-k">&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>password<span class="pl-k">&gt;</span> https://localhost:4000/api/v1/api-keys/59 -k
{
  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 59,
  <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>: [
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_REGISTRATION_OFFICER<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_SECURITYSERVER_OBSERVER<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_SERVICE_ADMINISTRATOR<span class="pl-pds">"</span></span>
  ]
}
</pre></div>
<div class="markdown-heading"><h4 class="heading-element">19.1.3 Updating API keys</h4><a id="1913-updating-api-keys" class="anchor" aria-label="Permalink: 19.1.3 Updating API keys" href="#1913-updating-api-keys"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>An existing API key is updated with a <code>PUT</code> request to <code>/api/v1/api-keys/{id}</code>. Message body must contain the roles to be
associated with the key. Server responds with data that contains the key id and roles associated with the key.</p>
<div class="highlight highlight-source-shell"><pre>curl -X PUT -u <span class="pl-k">&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>password<span class="pl-k">&gt;</span> https://localhost:4000/api/v1/api-keys/60 --data <span class="pl-s"><span class="pl-pds">'</span>["XROAD_SECURITYSERVER_OBSERVER","XROAD_REGISTRATION_OFFICER"]<span class="pl-pds">'</span></span> --header <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/json<span class="pl-pds">"</span></span> -k
{
  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 60,
  <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>: [
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_REGISTRATION_OFFICER<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>XROAD_SECURITYSERVER_OBSERVER<span class="pl-pds">"</span></span>
  ]
}
</pre></div>
<div class="markdown-heading"><h4 class="heading-element">19.1.4 Revoking API keys</h4><a id="1914-revoking-api-keys" class="anchor" aria-label="Permalink: 19.1.4 Revoking API keys" href="#1914-revoking-api-keys"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>An API key can be revoked with a <code>DELETE</code> request to <code>/api/v1/api-keys/{id}</code>. Server responds with <code>HTTP 200</code> if
revocation was successful and <code>HTTP 404</code> if key did not exist.</p>
<div class="highlight highlight-source-shell"><pre>curl -X DELETE -u <span class="pl-k">&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>password<span class="pl-k">&gt;</span> https://localhost:4000/api/v1/api-keys/60  -k
</pre></div>
<div class="markdown-heading"><h4 class="heading-element">19.1.5 API key caching</h4><a id="1915-api-key-caching" class="anchor" aria-label="Permalink: 19.1.5 API key caching" href="#1915-api-key-caching"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>API keys are cached in memory, which is typically not a problem in standard Security Server configurations.
However, if you have multiple Security Servers configured to share the same <code>serverconf</code> database
and use multiple nodes to access the REST API and execute API key management operations, the caches of different nodes can become out of sync.</p>
<p>For instance, revoking an API key from <code>node 1</code> may not be recognized by <code>node 2</code>, which can still grant access to REST API endpoints with the revoked API key. To address this issue, there are a few potential solutions:</p>
<ul>
<li>
<strong>Option A:</strong> Consider decreasing <a href="ug-syspar_x-road_v6_system_parameters.html#39-management-rest-api-parameters-proxy-ui-api">time-to-live</a> value for API key cache from the default of <strong>60 seconds</strong> to a more lenient value. Doing so will reduce the risk of stale values being returned, thus improving security.</li>
<li>
<strong>Option B:</strong> Direct all REST API operations to the same Security Server node.</li>
<li>
<strong>Option C:</strong> Always restart REST API modules when API key operations are executed.</li>
<li>
<strong>Option D:</strong> Disable Api key cache. (See <a href="ug-syspar_x-road_v6_system_parameters.html#39-management-rest-api-parameters-proxy-ui-api">proxy-ui-api parameters</a> for more details). This option will degrade API throughput and should only be used when other options do not work.</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element">19.2 Executing REST calls</h3><a id="192-executing-rest-calls" class="anchor" aria-label="Permalink: 19.2 Executing REST calls" href="#192-executing-rest-calls"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><strong>Access rights:</strong> Depends on the API.</p>
<p>Once a valid API key has been created, it is used by providing an <code>Authorization: X-Road-ApiKey token=&lt;api key&gt;</code> HTTP
header in the REST calls. For example</p>
<div class="highlight highlight-source-shell"><pre>curl --header <span class="pl-s"><span class="pl-pds">"</span>Authorization: X-Road-ApiKey token=ff6f55a8-cc63-4e83-aa4c-55f99dc77bbf<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>https://localhost:4000/api/v1/clients<span class="pl-pds">"</span></span> -k
[
  {
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>XRD2:GOV:999:foobar<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>member_name<span class="pl-pds">"</span></span>: Foo Name,
    <span class="pl-s"><span class="pl-pds">"</span>member_class<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>GOV<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>member_code<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>999<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subsystem_code<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>SUBS_1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>saved</span>
<span class="pl-s">...</span></pre></div>
<p>The available APIs are documented in OpenAPI specification [<a href="#Ref_REST_UI-API">REST_UI-API</a>]. Access rights for different APIs follow the same rules
as the corresponding UI operations.
Access to regular APIs is allowed from all IP addresses by default, but this can
be changed using System Parameters [<a href="#Ref_UG-SYSPAR">UG-SYSPAR</a>].</p>
<div class="markdown-heading"><h3 class="heading-element">19.3 Correlation ID HTTP header</h3><a id="193-correlation-id-http-header" class="anchor" aria-label="Permalink: 19.3 Correlation ID HTTP header" href="#193-correlation-id-http-header"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>The REST API endpoints return an <strong>x-road-ui-correlation-id</strong> HTTP header. This header is also logged in <code>proxy_ui_api.log</code>, so it
can be used to find the log messages related to a specific API call.</p>
<p>The correlation ID header is returned for all requests, both successful and failed ones.</p>
<p>For example, these log messages are related to an API call with correlation ID <code>3d5f193102435242</code>:</p>
<pre><code>2019-08-26 13:16:23,611 [https-jsse-nio-4000-exec-10] correlation-id:[3d5f193102435242] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - The HttpSession is currently null, and the HttpSessionSecurityContextRepository is prohibited from creating an HttpSession (because the allowSessionCreation property is false) - SecurityContext thus not stored for next request
2019-08-26 13:16:23,611 [https-jsse-nio-4000-exec-10] correlation-id:[3d5f193102435242] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.niis.xroad.restapi.exceptions.ConflictException: local group with code koodi6 already added]
2019-08-26 13:16:23,611 [https-jsse-nio-4000-exec-10] correlation-id:[3d5f193102435242] DEBUG o.s.s.w.a.ExceptionTranslationFilter - Chain processed normally
</code></pre>
<div class="markdown-heading"><h3 class="heading-element">19.4 Validation errors</h3><a id="194-validation-errors" class="anchor" aria-label="Permalink: 19.4 Validation errors" href="#194-validation-errors"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>An error response from the REST API can include validation errors if an unsupported parameter was provided with the request.
When</p>
<p>Example request and response of adding a new subsystem with illegal characters:</p>
<pre><code>POST https://ss1:4100/api/v1/clients

Request body:
{
  "client": {
    "member_class": "ORG",
    "member_code": "0/1234",
    "subsystem_code": "Subsystem%Code"
  },
  "ignore_warnings": false
}

Response body:
{
  "error": {
    "code": "validation_failure",
    "validation_errors": {
      "clientAdd.client.memberCode": [
        "NoForwardslashes"
      ],
      "clientAdd.client.subsystemCode": [
        "NoPercents"
      ]
    }
  },
  "status": 400
}
</code></pre>
<p>In addition to the validation messages declared in <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html" rel="nofollow">Java Validation API</a>, the following validation errors are possible:</p>
<table>
<thead>
<tr>
<th>Error</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NoControlChars</code></td>
<td>The provided string contains <a href="https://en.wikipedia.org/wiki/Control_character" rel="nofollow">ISO control characters</a> or zero-width spaces</td>
</tr>
<tr>
<td><code>NoColons</code></td>
<td>The provided string contains colons <code>:</code>
</td>
</tr>
<tr>
<td><code>NoSemicolons</code></td>
<td>The provided string contains semicolons <code>;</code>
</td>
</tr>
<tr>
<td><code>NoForwardslashes</code></td>
<td>The provided string contains slashes <code>/</code>
</td>
</tr>
<tr>
<td><code>NoBackslashes</code></td>
<td>The provided string contains backslashes <code>\</code>
</td>
</tr>
<tr>
<td><code>NoPercents</code></td>
<td>The provided string contains percent symbol <code>%</code>
</td>
</tr>
</tbody>
</table>
<div class="markdown-heading"><h3 class="heading-element">19.5 Warning responses</h3><a id="195-warning-responses" class="anchor" aria-label="Permalink: 19.5 Warning responses" href="#195-warning-responses"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Error response from the Management API can include additional warnings that you can ignore if seen necessary. The warnings can be ignored by your decision, by executing the same operation with <code>ignore_warnings</code> boolean parameter set to <code>true</code>. <em>Always consider the warning before making the decision to ignore it.</em></p>
<p>An example case:</p>
<ol>
<li>Client executes a REST request, without <code>ignore_warnings</code> parameter, to backend.</li>
<li>Backend notices warnings and responds with error message that contains the warnings. Nothing is updated at this point.</li>
<li>Client determines if warnings can be ignored.</li>
<li>If the warnings can be ignored, client resends the REST request, but with <code>ignore_warnings</code> parameter set to <code>true</code>.</li>
<li>Backend ignores the warnings and executes the operation.</li>
</ol>
<p>Error response with warnings always contains the error code <code>warnings_detected</code>.</p>
<p>Like errors, warnings contain an identifier (code) and possibly some metadata.</p>
<p>Warning example when trying to register a WSDL that produces non-fatal validation warnings:</p>
<div class="highlight highlight-source-json"><pre>{
  <span class="pl-ent">"status"</span>: <span class="pl-c1">400</span>,
  <span class="pl-ent">"error"</span>: {
    <span class="pl-ent">"code"</span>: <span class="pl-s"><span class="pl-pds">"</span>warnings_detected<span class="pl-pds">"</span></span>
  },
  <span class="pl-ent">"warnings"</span>: [
    {
      <span class="pl-ent">"code"</span>: <span class="pl-s"><span class="pl-pds">"</span>wsdl_validation_warnings<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"metadata"</span>: [
        <span class="pl-s"><span class="pl-pds">"</span>WSDLValidator Error : Summary: Failures: 0, Warnings: 1 &lt;&lt;&lt; WARNING! Operation 'someService' in PortType: {http://test.x-road.global/some-service}someService.servicePortType has no output message<span class="pl-pds">"</span></span>
      ]
    }
  ]
}</pre></div>
<p>Note that when you are using the admin UI and you encounter warnings, you will always be provided with a popup window with a <code>CONTINUE</code> button in it. When you click the <code>CONTINUE</code> button in the popup, the request is sent again but this time warnings will be ignored.</p>
<div class="markdown-heading"><h2 class="heading-element">20 Migrating to Remote Database Host</h2><a id="20-migrating-to-remote-database-host" class="anchor" aria-label="Permalink: 20 Migrating to Remote Database Host" href="#20-migrating-to-remote-database-host"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Since version <code>6.22.0</code> Security Server supports using remote databases. In case you have an already running Security Server with local database, it is possible to migrate it to use remote database host instead. The instructions for this process are listed below.</p>
<ol>
<li>
<p>Shutdown X-Road processes.</p>
<div class="highlight highlight-source-shell"><pre>systemctl stop <span class="pl-s"><span class="pl-pds">"</span>xroad*<span class="pl-pds">"</span></span></pre></div>
</li>
<li>
<p>Dump the local databases to be migrated. You can find the passwords of users <code>serverconf_admin</code>, <code>messagelog_admin</code> and <code>opmonitor_admin</code> in <code>/etc/xroad.properties</code>.Notice that the versions of the local PostgreSQL client and remote PostgreSQL server must match. Also take into account that on a busy system the messagelog database can be quite large and therefore dump and restore can take considerable amount of time and disk space. Notice that the versions of the local PostgreSQL client and remote PostgreSQL server must match.</p>
<div class="highlight highlight-source-shell"><pre>pg_dump -F t -h 127.0.0.1 -p 5432 -U serverconf_admin -f serverconf.dat serverconf
pg_dump -F t -h 127.0.0.1 -p 5432 -U messagelog_admin -f messagelog.dat messagelog
pg_dump -F t -h 127.0.0.1 -p 5432 -U opmonitor_admin -f op-monitor.dat op-monitor</pre></div>
</li>
<li>
<p>Shut down and mask local <code>postgresql</code> so it won't start when <code>xroad-proxy</code> starts.</p>
<div class="highlight highlight-source-shell"><pre>systemctl stop postgresql
systemctl mask postgresql</pre></div>
</li>
<li>
<p>Connect to the remote database server as the superuser <code>postgres</code> and create roles, databases and access permissions as follows.</p>
<p><strong>serverconf</strong> (required)</p>
<div class="highlight highlight-source-shell"><pre>psql -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U postgres
CREATE DATABASE serverconf ENCODING <span class="pl-s"><span class="pl-pds">'</span>UTF8<span class="pl-pds">'</span></span><span class="pl-k">;</span>
REVOKE ALL ON DATABASE serverconf FROM PUBLIC<span class="pl-k">;</span>
CREATE ROLE serverconf_admin LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;serverconf_admin password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT serverconf_admin to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT CREATE,TEMPORARY,CONNECT ON DATABASE serverconf TO serverconf_admin<span class="pl-k">;</span>
<span class="pl-cce">\c</span> serverconf
CREATE EXTENSION hstore<span class="pl-k">;</span>
CREATE SCHEMA serverconf AUTHORIZATION serverconf_admin<span class="pl-k">;</span>
REVOKE ALL ON SCHEMA public FROM PUBLIC<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to serverconf_admin<span class="pl-k">;</span>
CREATE ROLE serverconf LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;serverconf password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT serverconf to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT TEMPORARY,CONNECT ON DATABASE serverconf TO serverconf<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to serverconf<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA serverconf TO serverconf<span class="pl-k">;</span>
GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA serverconf TO serverconf<span class="pl-k">;</span>
GRANT SELECT,UPDATE ON ALL SEQUENCES IN SCHEMA serverconf TO serverconf<span class="pl-k">;</span>
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA serverconf to serverconf<span class="pl-k">;</span></pre></div>
<p><strong>messagelog</strong> (required by xroad-addon-messagelog)</p>
<div class="highlight highlight-source-shell"><pre>psql -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U postgres
CREATE DATABASE messagelog ENCODING <span class="pl-s"><span class="pl-pds">'</span>UTF8<span class="pl-pds">'</span></span><span class="pl-k">;</span>
REVOKE ALL ON DATABASE messagelog FROM PUBLIC<span class="pl-k">;</span>
CREATE ROLE messagelog_admin LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;messagelog_admin password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT messagelog_admin to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT CREATE,TEMPORARY,CONNECT ON DATABASE messagelog TO messagelog_admin<span class="pl-k">;</span>
<span class="pl-cce">\c</span> messagelog
CREATE SCHEMA messagelog AUTHORIZATION messagelog_admin<span class="pl-k">;</span>
REVOKE ALL ON SCHEMA public FROM PUBLIC<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to messagelog_admin<span class="pl-k">;</span>
CREATE ROLE messagelog LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;messagelog password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT messagelog to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT TEMPORARY,CONNECT ON DATABASE messagelog TO messagelog<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to messagelog<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA messagelog TO messagelog<span class="pl-k">;</span>
GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA messagelog TO messagelog<span class="pl-k">;</span>
GRANT SELECT,UPDATE ON ALL SEQUENCES IN SCHEMA messagelog TO messagelog<span class="pl-k">;</span>
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA messagelog to messagelog<span class="pl-k">;</span></pre></div>
<p><strong>op-monitor</strong> (optional, required by xroad-opmonitor)</p>
<p>If operational monitoring is going to be installed, run additionally the following commands. Again, the database and role names can be customized to suit your environment.</p>
<div class="highlight highlight-source-shell"><pre>psql -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U postgres
CREATE DATABASE <span class="pl-s"><span class="pl-pds">"</span>op-monitor<span class="pl-pds">"</span></span> ENCODING <span class="pl-s"><span class="pl-pds">'</span>UTF8<span class="pl-pds">'</span></span><span class="pl-k">;</span>
REVOKE ALL ON DATABASE <span class="pl-s"><span class="pl-pds">"</span>op-monitor<span class="pl-pds">"</span></span> FROM PUBLIC<span class="pl-k">;</span>
CREATE ROLE opmonitor_admin LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;opmonitor_admin password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT opmonitor_admin to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT CREATE,TEMPORARY,CONNECT ON DATABASE <span class="pl-s"><span class="pl-pds">"</span>op-monitor<span class="pl-pds">"</span></span> TO opmonitor_admin<span class="pl-k">;</span>
<span class="pl-cce">\c</span> <span class="pl-s"><span class="pl-pds">"</span>op-monitor<span class="pl-pds">"</span></span>
CREATE SCHEMA opmonitor AUTHORIZATION opmonitor_admin<span class="pl-k">;</span>
REVOKE ALL ON SCHEMA public FROM PUBLIC<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to opmonitor_admin<span class="pl-k">;</span>
CREATE ROLE opmonitor LOGIN PASSWORD <span class="pl-s"><span class="pl-pds">'</span>&lt;opmonitor password&gt;<span class="pl-pds">'</span></span><span class="pl-k">;</span>
GRANT opmonitor to <span class="pl-k">&lt;</span>superuser<span class="pl-k">&gt;</span><span class="pl-k">;</span>
GRANT TEMPORARY,CONNECT ON DATABASE <span class="pl-s"><span class="pl-pds">"</span>op-monitor<span class="pl-pds">"</span></span> TO opmonitor<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA public to opmonitor<span class="pl-k">;</span>
GRANT USAGE ON SCHEMA opmonitor TO opmonitor<span class="pl-k">;</span>
GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA opmonitor TO opmonitor<span class="pl-k">;</span>
GRANT SELECT,UPDATE ON ALL SEQUENCES IN SCHEMA opmonitor TO opmonitor<span class="pl-k">;</span>
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA opmonitor to opmonitor<span class="pl-k">;</span></pre></div>
</li>
<li>
<p>Restore the database dumps on the remote database host.</p>
<div class="highlight highlight-source-shell"><pre>pg_restore -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U serverconf_admin -O -n serverconf -1 -d serverconf serverconf.dat
pg_restore -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U messagelog_admin -O -n messagelog -1 -d messagelog messagelog.dat
pg_restore -h <span class="pl-k">&lt;</span>remote-db-url<span class="pl-k">&gt;</span> -p <span class="pl-k">&lt;</span>remote-db-port<span class="pl-k">&gt;</span> -U opmonitor_admin -O -n opmonitor -1 -d op-monitor op-monitor.dat</pre></div>
</li>
<li>
<p>Create properties file <code>/etc/xroad.properties</code> containing the superuser password.</p>
<div class="highlight highlight-source-shell"><pre>sudo touch /etc/xroad.properties
sudo chown root:root /etc/xroad.properties
sudo chmod 600 /etc/xroad.properties</pre></div>
</li>
<li>
<p>Edit <code>/etc/xroad.properties</code>.</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-k">serverconf.database.admin_user</span> = serverconf_admin
<span class="pl-k">serverconf.database.admin_password</span> = &lt;serverconf_admin password&gt;
<span class="pl-k">messagelog.database.admin_user</span> = messagelog_admin
<span class="pl-k">messagelog.database.admin_password</span> = messagelog_admin password&gt;
<span class="pl-k">op-monitor.database.admin_user</span> = opmonitor_admin
<span class="pl-k">op-monitor.database.admin_password</span> = &lt;opmonitor_admin password&gt;</pre></div>
</li>
<li>
<p>Update <code>/etc/xroad/db.properties</code> contents with correct database host URLs and passwords.</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-k">serverconf.hibernate.connection.url</span> = jdbc:postgresql://&lt;database host&gt;:&lt;port&gt;/serverconf
<span class="pl-k">serverconf.hibernate.connection.username</span> = serverconf
<span class="pl-k">serverconf.hibernate.connection.password</span> = &lt;serverconf password&gt;
<span class="pl-k">serverconf.hibernate.hikari.dataSource.currentSchema</span> = serverconf,public

<span class="pl-k">messagelog.hibernate.connection.url</span> = jdbc:postgresql://&lt;database host&gt;:&lt;port&gt;/messagelog
<span class="pl-k">messagelog.hibernate.connection.username</span> = messagelog
<span class="pl-k">messagelog.hibernate.connection.password</span> = &lt;messagelog password&gt;
<span class="pl-k">messagelog.hibernate.hikari.dataSource.currentSchema</span> = messagelog,public

<span class="pl-k">op-monitor.hibernate.connection.url</span> = jdbc:postgresql://&lt;database host&gt;:&lt;port&gt;/op-monitor
<span class="pl-k">op-monitor.hibernate.connection.username</span> = opmonitor
<span class="pl-k">op-monitor.hibernate.connection.password</span> = &lt;opmonitor password&gt;
<span class="pl-k">op-monitor.hibernate.hikari.dataSource.currentSchema</span> = opmonitor,public</pre></div>
</li>
<li>
<p>Start again the X-Road services.</p>
<div class="highlight highlight-source-shell"><pre>systemctl start <span class="pl-s"><span class="pl-pds">"</span>xroad*<span class="pl-pds">"</span></span></pre></div>
</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">21 Adding command line arguments</h2><a id="21-adding-command-line-arguments" class="anchor" aria-label="Permalink: 21 Adding command line arguments" href="#21-adding-command-line-arguments"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>If you need to add command line arguments for the Security Server, for example if you wish to increase Java's maximum heap size, you can do it with the properties file <code>/etc/xroad/services/local.properties</code>. The file is also included in the backup archive file when taking a backup of the Security Server's configuration.</p>
<p>Example of <code>/etc/xroad/services/local.properties</code> with modifications that override the default Java memory parameters:</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-k">XROAD_PROXY_PARAMS</span>=-Xms150m -Xmx1024m</pre></div>
<p>All possible properties to adjust in this file are:</p>
<pre><code>XROAD_SIGNER_PARAMS
XROAD_ADDON_PARAMS
XROAD_CONFCLIENT_PARAMS
XROAD_CONFPROXY_PARAMS
XROAD_JETTY_PARAMS
XROAD_MESSAGELOG_ARCHIVER_PARAMS
XROAD_MONITOR_PARAMS
XROAD_OPMON_PARAMS
XROAD_PROXY_PARAMS
XROAD_PROXY_UI_API_PARAMS
XROAD_SIGNER_CONSOLE_PARAMS
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">22 Additional Security Hardening</h2><a id="22-additional-security-hardening" class="anchor" aria-label="Permalink: 22 Additional Security Hardening" href="#22-additional-security-hardening"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>For the guidelines on security hardening, please refer to <a href="ug-sec_x_road_security_hardening.html">UG-SEC</a>.</p>
<div class="markdown-heading"><h2 class="heading-element">23 Passing additional parameters to psql</h2><a id="23-passing-additional-parameters-to-psql" class="anchor" aria-label="Permalink: 23 Passing additional parameters to psql" href="#23-passing-additional-parameters-to-psql"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>By default any scripts(for example backup/restore) that uses <code>psql</code> utility tries to parse <code>/etc/xroad/db.properties</code> file for database related configurations like: database name, user, password, host, port. If the file is not found, the script may use default values which will point to local database. When such behaviour doesn't cover the requirements, it is possible to pass additional configurations to <code>psql</code> utility using environment variables from file.</p>
<p>First step to pass additional configurations is to create <code>db_libpq.env</code> file in <code>/etc/xroad/</code> folder if it isn't created yet. It may also require adjustments of access rights to file.</p>
<p>Example of file contents:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-k">export</span> PGSSLMODE=<span class="pl-s"><span class="pl-pds">"</span>verify-full<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> PGSSLCERT=<span class="pl-s"><span class="pl-pds">"</span>/etc/xroad/ssl/internal.crt<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> PGSSLKEY=<span class="pl-s"><span class="pl-pds">"</span>/etc/xroad/ssl/internal.key<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> PGSSLROOTCERT=<span class="pl-s"><span class="pl-pds">"</span>/etc/xroad/ssl/root.crt<span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span>export PGTARGETSESSIONATTRS="read-write"</span></pre></div>
<p>This example shows how SSL configurations for <em>psql</em> could look like. List of possible environment variables can be found in <a href="https://www.postgresql.org/docs/current/libpq-envars.html" rel="nofollow">Postgres documentation</a>.</p>
<p>Some of the variables like <code>PGOPTIONS</code>, <code>PGDATABASE</code>, <code>PGUSER</code>, <code>PGPASSWORD</code> are already used by scripts(created and initialized with values from <code>/etc/xroad/db.properties</code> file) so adding same variables to <code>db_libpq.env</code> won't have any effect on script behaviour.</p>
<p>In case it is needed to pass additional flags to internally initialized <code>PGOPTIONS</code> variable, then <code>PGOPTIONS_EXTRA</code> variable can be used. It will be appended to <code>PGOPTIONS</code> variable.</p>
<div class="markdown-heading"><h2 class="heading-element">24 Configuring ACME</h2><a id="24-configuring-acme" class="anchor" aria-label="Permalink: 24 Configuring ACME" href="#24-configuring-acme"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Automated Certificate Management Environment [<a href="#Ref_ACME">ACME</a>] protocol enables automated certificate management of the authentication and sign certificates on the Security Server. The Security Server supports automating the certificate request process, but the process has to be initiated manually when applying for a certificate for the first time. Also, activating the received certificates is a manual task.</p>
<p>The ACME protocol can be used only if the Certificate Authority (CA) issuing the certificates supports it and the X-Road operator has enabled the use of the protocol on the Central Server. Therefore, also the communication between the CA's ACME server and the Security Server is disabled by default. In addition, some member-specific configuration is required on the Security Server.</p>
<p><strong>Automatic certificate renewal</strong></p>
<p>Authentication and sign certificates issued by a CA that supports ACME can be automatically renewed. Automatic renewal is enabled by default, but the Security Server administrator can turn it off.</p>
<p>The Security Server runs an automatic renewal job periodically and tries to renew certificates ready for renewal. If the server supports the ACME ARI extension ([<a href="#Ref_ACME-ARI">ACME-ARI</a>]), the time when a certificate is ready for renewal is determined by the ACME server. Otherwise, the time is defined by the <code>proxy-ui-api.acme-renewal-time-before-expiration-date</code> system property. The default value of the property is 14 days, which means that the Security Server starts trying to renew a certificate 14 days before it expires. The renewal job configuration can be managed by the <code>proxy-ui-api.acme-renewal-*</code> configuration properties.</p>
<p>The renewal status of ACME supported certificates can be seen on the Keys and certificates page:</p>
<ul>
<li>
<strong>"N/A"</strong> - certificate is not <code>REGISTERED</code> or not issued by ACME supported CA and therefore, it is ignored by the automatic certificate renewal job.</li>
<li>
<strong>"Renewal in progress"</strong> - Renewal has started, but is not yet finished. Once the new certificate is registered and enabled, this certificate can be removed.</li>
<li>
<strong>"Renewal error:"</strong> followed by an error message - indicates that the last renewal attempt has failed, also showing the reason for the failure.</li>
<li>
<strong>"Next planned renewal on"</strong> followed by a date - indicates when the next renewal should happen. Note that this date might change in the future when the information is received from the ACME Server.</li>
</ul>
<p><strong>E-mail notifications</strong></p>
<p>The Security Server supports sending email notifications on ACME-related events. Notifications are sent in case of authentication and sign certificate renewal success and failure and authentication certificate registration success. The notifications can be turned on and off separately with <a href="ug-syspar_x-road_v6_system_parameters.html#39-management-rest-api-parameters-proxy-ui-api">system paramaters</a>.</p>
<p>The member's e-mail address defined in the <code>mail.yml</code> configuration file is used as the recipient. The same email address is also used as a member-specific contact information when a certificate is ordered from the ACME Server.</p>
<p>For the e-mail notifications to work, an external mail server needs to be configured beforehand in the <code>/etc/xroad/conf.d/mail.yml</code> configuration file. The configuration include:</p>
<ul>
<li>
<strong>host</strong> - host name used to connect to the mail server.</li>
<li>
<strong>port</strong> - port number used to connect to the mail server.</li>
<li>
<strong>username</strong> - used for authentication to the mail server.</li>
<li>
<strong>password</strong> - used for authentication to the mail server.</li>
<li>
<strong>use-ssl-tls</strong> - if "true", then full <code>ssl/tls</code> protocol is used for connection. If "false" or missing, then <code>starttls</code> protocol is used instead.</li>
</ul>
<p>The <strong>host</strong>, <strong>port</strong>, <strong>username</strong> and <strong>password</strong> properties are mandatory. The mail server configuration status can be viewed in the Diagnostics page. If the Diagnostics page shows that the configuration is incomplete, it means that at least one of required configuration properties is missing. Instead, if all the required configuration are in-place, a test email can be sent from the Diagnostics page.</p>
<p><strong>Enable connections from the ACME server</strong></p>
<p>The Security Server has a <code>[proxy-ui-api]</code> parameter <a href="ug-syspar_x-road_v6_system_parameters.md#39-management-rest-api-parameters-proxy-ui-api">acme-challenge-port-enabled</a> that defines whether the Security Server listens to incoming ACME challenge requests on port 80. The default value for this parameter is <code>false</code> which means that  the Security Server does not listen on port 80. The parameter can be changed by following the <a href="ug-syspar_x-road_v6_system_parameters.html#21-changing-the-system-parameter-values-in-configuration-files">System Parameters guide</a>.</p>
<p><strong>Member-specific configuration</strong></p>
<p>Although the main ACME-related configuration is managed on the Central Server and distributed to the Security Servers over the Global Configuration, in order to use the ACME standard, some of the member-specific configurations have to be set on the Security Server side as well. These configurations go in the file <code>acme.yml</code>, that is in the configurations folder on the file system (default <code>/etc/xroad/conf.d</code>). An example file is added by the installer when installing or upgrading X-Road to version 7.5. The configurations to be added are:</p>
<ol>
<li>Credentials (kid and hmac secret) for external account binding. Some CAs require these for added security. They tie the X-Road member to an external account on the Certificate Authority's side and so need to be acquired externally from the CA.</li>
<li>
<code>account-keystore-password</code> -  a password of the ACME Server account PKCS #12 keystore that is populated automatically by the Security Server, when communicating with the ACME Server.</li>
</ol>
<p>There are currently two ways to let the ACME server know which type of certificate to return (the chosen CA also needs to support them). The first one, which sends profile ids for authentication and signing certificates in http header, does not require any further configuration on the Security Server side. The second one uses certificate type specific external account credentials. For the authentication certificate add "<strong>auth-</strong>" prefix to the external account binding credentials property names in the <code>/etc/xroad/conf.d/acme.yml</code> file. For the signing certificate add the prefix "<strong>sign-</strong>".</p>
<p>Example of the <code>/etc/xroad/conf.d/acme.yml</code> file contents (can be found from <code>/etc/xroad/conf.d/acme.example.yml</code>):</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-c"><span class="pl-c">#</span> Example acme.yml file that has properties related to Automatic Certificate Management Environment (ACME)</span>
<span class="pl-c"><span class="pl-c">#</span> that is used to automate acquiring certificates from Certificate Authorities. To use this file</span>
<span class="pl-c"><span class="pl-c">#</span> remove '.example' form the file name and replace with correct values as needed or create a new file named 'acme.yml'.</span>

<span class="pl-c"><span class="pl-c">#</span> ACME external account binding credentials grouped by Certification Authorities(CA-s) and Members,</span>
<span class="pl-c"><span class="pl-c">#</span> where CAs have their name as key and should be surrounded by quotation marks to allow spaces.</span>
<span class="pl-c"><span class="pl-c">#</span> For Members the key is the Member ID in the form &lt;instance_id&gt;:&lt;member_class&gt;:&lt;member_code&gt; and</span>
<span class="pl-c"><span class="pl-c">#</span> should also be surrounded by quotation marks to allow for ':'. They have two properties: kid and mac-key, which should be</span>
<span class="pl-c"><span class="pl-c">#</span> acquired externally from the CA. If the CA supports kid-based certificate type selection, then credentials starting</span>
<span class="pl-c"><span class="pl-c">#</span> with the prefix "auth-" can be used to order authentication certificate and credentials starting with "sign-" can</span>
<span class="pl-c"><span class="pl-c">#</span> be used to order signing certificates.</span>
<span class="pl-c"><span class="pl-c">#</span> Property mac-key-base64-encoded should be true if the provided mac-keys are encoded in base64.</span>
<span class="pl-ent">eab-credentials</span>:
  <span class="pl-ent">certificate-authorities</span>:
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-ent">Example Root CA</span><span class="pl-pds">'</span></span>:
      <span class="pl-ent">mac-key-base64-encoded</span>: <span class="pl-c1">true</span>
      <span class="pl-ent">members</span>:
        <span class="pl-s"><span class="pl-pds">'</span><span class="pl-ent">EU:COM:1234567-8</span><span class="pl-pds">'</span></span>:
          <span class="pl-ent">auth-kid</span>: <span class="pl-s">key_2</span>
          <span class="pl-ent">auth-mac-key</span>: <span class="pl-s">YXV0aGVudGljYXRpb25zZWNyZXRtYWNrZXk=</span>
          <span class="pl-ent">sign-kid</span>: <span class="pl-s">key_3</span>
          <span class="pl-ent">sign-mac-key</span>: <span class="pl-s">c2VjcmV0X21hY19rZXlfZm9yX3NpZ25pbmc=</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-ent">Some Other CA</span><span class="pl-pds">'</span></span>:
      <span class="pl-ent">mac-key-base64-encoded</span>: <span class="pl-c1">false</span>
      <span class="pl-ent">members</span>:
        <span class="pl-s"><span class="pl-pds">'</span><span class="pl-ent">EU:GOV:9090909-1</span><span class="pl-pds">'</span></span>:
          <span class="pl-ent">kid</span>: <span class="pl-s">kid123</span>
          <span class="pl-ent">mac-key</span>: <span class="pl-s">goodlongsecretwordthatisnotshort</span>

<span class="pl-c"><span class="pl-c">#</span> This is a password of the ACME Server account PKCS #12 keystore that is populated automatically by the Security Server.</span>
<span class="pl-c"><span class="pl-c">#</span> Keystore is at /etc/xroad/ssl/acme.p12</span>
<span class="pl-ent">account-keystore-password</span>: <span class="pl-s">acmep12Password1234</span>
</pre></div>
<div class="markdown-heading"><h2 class="heading-element">25 Migrating to EC Based Authentication and Signing Certificates</h2><a id="25-migrating-to-ec-based-authentication-and-signing-certificates" class="anchor" aria-label="Permalink: 25 Migrating to EC Based Authentication and Signing Certificates" href="#25-migrating-to-ec-based-authentication-and-signing-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h3 class="heading-element">25.1 Steps to Enable EC Based Certificates</h3><a id="251-steps-to-enable-ec-based-certificates" class="anchor" aria-label="Permalink: 25.1 Steps to Enable EC Based Certificates" href="#251-steps-to-enable-ec-based-certificates"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Since version 7.6.0 Security Server supports ECDSA based authentication and signing keys. By default, both authentication and signing keys use the RSA algorithm as in previous versions. The EC algorithm can be enabled separately for authentication and/or signing keys so migration can be done in a gradual way. The instructions on how to start using EC based keys are listed below.</p>
<ol>
<li>Update the configuration to use EC based keys. This can be done by updating the configuration file <code>/etc/xroad/conf.d/local.ini</code> and adding the following lines:</li>
</ol>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[proxy-ui-api]</span>
<span class="pl-k">authentication-key-algorithm</span> = EC
<span class="pl-k">signing-key-algorithm</span> = EC</pre></div>
<ol start="2">
<li>Restart the <code>xroad-proxy-ui-api</code> service to apply the changes made to the configuration file.</li>
<li>
<ul>
<li>Follow the instructions in Section <a href="#31-configuring-the-signing-key-and-certificate-for-the-security-server-owner">3.1</a> to create new Signing certificate, which will be using EC algorithm now.</li>
<li>Follow the instructions in Section <a href="#32-configuring-the-authentication-key-and-certificate-for-the-security-server">3.2</a> to create new Authentication certificate, which will be using EC algorithm now.</li>
</ul>
</li>
</ol>
<div class="markdown-heading"><h3 class="heading-element">25.2 Backwards Compatibility</h3><a id="252-backwards-compatibility" class="anchor" aria-label="Permalink: 25.2 Backwards Compatibility" href="#252-backwards-compatibility"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>EC based keys are supported starting from X-Road version 7.6.0 (=&gt; 7.6.0). If an X-Road instance contains Security Servers prior to version 7.6.0 (&lt; 7.6.0), then:
A Security Server prior to version 7.6.0 (&lt; 7.6.0) is able to verify requests signed with EC keys from a Security Server version 7.6.0 or later (=&gt; 7.6.0).
If a Security Server prior to version 7.6.0 (ug-syspar_x-road_v6_system_parameters.html).</p>
    </article>
  </body>
</html>
